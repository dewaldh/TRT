#<AdxTL>@(#)0.0.0.0 $Revision$
######################################################################################################
# FILE NAME   : SPEGTE
# DESCRIPTION : Document Entry Type customisation
######################################################################################################
# DATE        : 11-10-2018
# AUTHOR      : Dewald Henning
# COMPANY     : Leverage Technologies
#-----------------------------------------------------------------------------------------------------
# Epics Code  : DFCX1-23
#-----------------------------------------------------------------------------------------------------
######################################################################################################

$ACTION
Case ACTION
  When "OUVRE"   :  Gosub OUVRE
  When "LIENS"   :  Gosub LIENS
  When "STYLE"  :   Gosub STYLE
Endcase
Return

#If no data exists, LIENS and STYLE will not be invoked
$OUVRE
  #Check Business Batch checked
  If [M:GTE1]YBUSBAT = 1
    Chgfmt[M:GTE1]YBUSBATTYP With "-LM:6250"
  Elsif [M:GTE1]YBUSBAT  = 2
    Chgfmt[M:GTE1]YBUSBATTYP With "+LM:6250"
  Endif
  Affzo [M:GTE1]YBUSBATTYP

Return

#If screen is entered from a "Jump to" action, Style will not be invoked
$LIENS
  #Check Business Batch checked
  If [M:GTE1]YBUSBAT = 1
    Chgfmt[M:GTE1]YBUSBATTYP With "-LM:6250"
  Elsif [M:GTE1]YBUSBAT  = 2
    Chgfmt[M:GTE1]YBUSBATTYP With "+LM:6250"
  Endif
  Affzo [M:GTE1]YBUSBATTYP

Return

$STYLE
  #Check Business Batch checked
  If [M:GTE1]YBUSBAT = 1
    Chgfmt[M:GTE1]YBUSBATTYP With "-LM:6250"
  Elsif [M:GTE1]YBUSBAT  = 2
    Chgfmt[M:GTE1]YBUSBATTYP With "+LM:6250"
  Endif
  Affzo [M:GTE1]YBUSBATTYP

Return

Subprog AP_YBUSBAT(VALEUR)
Variable Integer VALEUR
  #Check if default journal is a business batch
  If [M]DEFJOU <> "" Then
    Call C_YJOU([M]DEFJOU) From YBBSELJOU
  Endif

End

Subprog C_YBUSBAT(VALEUR)
Variable Integer VALEUR
  #Check Business Batch checked
  If VALEUR = 1 Then
    Chgfmt[M:GTE1]YBUSBATTYP With "-LM:6250"
  Elsif VALEUR = 2
    Chgfmt[M:GTE1]YBUSBATTYP With "+LM:6250"
  Endif
  Affzo [M:GTE1]YBUSBATTYP

End

Subprog AM_DEFJOU(VALEUR)
Variable Char    VALEUR()
  #Check if Flag as Business batch, if yes, then check if default journal is also a business batch and has the same business batch type
  If [M:GTE1]YBUSBAT = 2 Then
    #Infbox "DEFJOU: "+VALEUR
    #Call VAL_BBENTJOU([M]DEFJOU, [M]YBUSBATTYP) From YBBSELGTE
    If clalev([F:JOU]) = 0 : Local File GJOURNAL [JOU] : Endif
    Read [F:JOU]JOU0 = VALEUR
    If [F:JOU]YBUSBATTYP <> [M:GTE1]YBUSBATTYP Then
      GMESSAGE = mess(12,6254,1)
      GERR = 1
      mkstat = 2
      zonsui = "[M:GTE1]DEFJOU"
    Endif
    If clalev([F:JOU]) = 0 : Close Local File [F:JOU] : Endif

  Endif

End

