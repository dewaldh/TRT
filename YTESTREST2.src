#<AdxTL>@(#)0.0.0.0 $Revision$ 
Infbox "REST"
Local Char PCOD(100)(1..10),PVAL(100)(1..10),HCOD(100)(1..10),HVAL(100)(1..10)

Local Clbfile RESH2
Local Clbfile RESB2
Local Char varticket(255)

Gosub GETUATHTOKEN
infbox varticket

HVAL(1)='"'+varticket+'"'
INFBOX HVAL(1)

RETVAL=func ASYRRESTCLI.EXEC_REST_WS("YCSNodeInfo","GET","",PCOD,PVAL,HCOD,HVAL,"{}",0,"",RESH2, RESB2)
infbox num$(RETVAL)
Infbox RESH2
Infbox RESB2
openo filpath('tmp','ytestrest','') using [YYY]
wrseq RESB2 using [YYY]
openo using  [YYY]


End

#------------------------------------------------------#


$GETUATHTOKEN

Local Clbfile ARGS
Local Clbfile RESH
Local Clbfile RESB
Local Integer SCODE

#Infbox ARGUMENTS
#call the external API
SCODE= func ASYRWEBSER.EXEC_JS("bundles/ycontent-server/lib/index","authenticate","wait",ARGS, "0", 0, "", "0", RESH, RESB)

If SCODE<>200 Then
  Infbox num$(SCODE),RESH,RESB
Else
  RESB=unescJson(RESB)
  Infbox num$(SCODE),RESH,RESB
  INFBOX NUM$(func FINDVAL(RESB,'ticket'))
Endif
varticket=NUM$(func FINDVAL(RESB,'ticket'))

Return

####################################################################################################
Funprog FINDVAL(RESP,K)
Value    Clbfile  RESP
Value    Char     K
Local Integer X
X = instr(1,RESP,K+'":"')
If !X : End "" : Endif
X += len(K)+3
End seg$(RESP,X,instr(X,RESP,'"')-1)

####################################################################################################








