#<AdxTL>@(#)0.0.0.0 $Revision$
# Supervisor
# Mask management WE3FTIST9 

$_AFF
If GIMPORT
 Gosub AFF From GSAISIE
Else
 If GMESSAGE <>""
  Gosub ERR From GSAISIE
 Else
  Raz GERR , GZNUM
 Endif
Endif
Return

$HORODAT
Local Date    A_DATE
Local Char    A_HEURE(10) , A_USER(10)
Local Char    A_STAMP(15)
A_DATE  = [28/08/2018]
A_HEURE = "00:18:47"
A_USER  = "ADMIN"
A_STAMP = "20180828001847"
Return

$TITRES
Return

$CHG_FMT
Case zoncou
 When "NBAXE"
  If [M]NBAXE=0
  Endif
 When "NBLIG"
  If [M]NBLIG=0
   If GFMTCOA(1)<>""
    Chgfmt LINACC1 With GFMTCOA(1)
   Else
    Chgfmt LINACC1 With "-K:1X"
   Endif
   If GFMTCOA(2)<>""
    Chgfmt LINACC2 With GFMTCOA(2)
   Else
    Chgfmt LINACC2 With "-K:1X"
   Endif
   If GFMTCOA(3)<>""
    Chgfmt LINACC3 With GFMTCOA(3)
   Else
    Chgfmt LINACC3 With "-K:1X"
   Endif
   If GFMTCOA(4)<>""
    Chgfmt LINACC4 With GFMTCOA(4)
   Else
    Chgfmt LINACC4 With "-K:1X"
   Endif
   If GFMTCOA(5)<>""
    Chgfmt LINACC5 With GFMTCOA(5)
   Else
    Chgfmt LINACC5 With "-K:1X"
   Endif
   If GFMTCOA(6)<>""
    Chgfmt LINACC6 With GFMTCOA(6)
   Else
    Chgfmt LINACC6 With "-K:1X"
   Endif
   If GFMTCOA(7)<>""
    Chgfmt LINACC7 With GFMTCOA(7)
   Else
    Chgfmt LINACC7 With "-K:1X"
   Endif
   If GFMTCOA(8)<>""
    Chgfmt LINACC8 With GFMTCOA(8)
   Else
    Chgfmt LINACC8 With "-K:1X"
   Endif
   If GFMTCOA(9)<>""
    Chgfmt LINACC9 With GFMTCOA(9)
   Else
    Chgfmt LINACC9 With "-K:1X"
   Endif
   If GFMTCOA(10)<>""
    Chgfmt LINACC10 With GFMTCOA(10)
   Else
    Chgfmt LINACC10 With "-K:1X"
   Endif
   If GFMTDIE(1)<>""
    Chgfmt CCE1 With GFMTDIE(1)
   Else
    Chgfmt CCE1 With "-K:1X"
   Endif
   If GFMTDIE(2)<>""
    Chgfmt CCE2 With GFMTDIE(2)
   Else
    Chgfmt CCE2 With "-K:1X"
   Endif
   If GFMTDIE(3)<>""
    Chgfmt CCE3 With GFMTDIE(3)
   Else
    Chgfmt CCE3 With "-K:1X"
   Endif
   If GFMTDIE(4)<>""
    Chgfmt CCE4 With GFMTDIE(4)
   Else
    Chgfmt CCE4 With "-K:1X"
   Endif
   If GFMTDIE(5)<>""
    Chgfmt CCE5 With GFMTDIE(5)
   Else
    Chgfmt CCE5 With "-K:1X"
   Endif
   If GFMTDIE(6)<>""
    Chgfmt CCE6 With GFMTDIE(6)
   Else
    Chgfmt CCE6 With "-K:1X"
   Endif
   If GFMTDIE(7)<>""
    Chgfmt CCE7 With GFMTDIE(7)
   Else
    Chgfmt CCE7 With "-K:1X"
   Endif
   If GFMTDIE(8)<>""
    Chgfmt CCE8 With GFMTDIE(8)
   Else
    Chgfmt CCE8 With "-K:1X"
   Endif
   If GFMTDIE(9)<>""
    Chgfmt CCE9 With GFMTDIE(9)
   Else
    Chgfmt CCE9 With "-K:1X"
   Endif
   If GFMTDIE(10)<>""
    Chgfmt CCE10 With GFMTDIE(10)
   Else
    Chgfmt CCE10 With "-K:1X"
   Endif
   If GFMTDIE(11)<>""
    Chgfmt CCE11 With GFMTDIE(11)
   Else
    Chgfmt CCE11 With "-K:1X"
   Endif
   If GFMTDIE(12)<>""
    Chgfmt CCE12 With GFMTDIE(12)
   Else
    Chgfmt CCE12 With "-K:1X"
   Endif
   If GFMTDIE(13)<>""
    Chgfmt CCE13 With GFMTDIE(13)
   Else
    Chgfmt CCE13 With "-K:1X"
   Endif
   If GFMTDIE(14)<>""
    Chgfmt CCE14 With GFMTDIE(14)
   Else
    Chgfmt CCE14 With "-K:1X"
   Endif
   If GFMTDIE(15)<>""
    Chgfmt CCE15 With GFMTDIE(15)
   Else
    Chgfmt CCE15 With "-K:1X"
   Endif
   If GFMTDIE(16)<>""
    Chgfmt CCE16 With GFMTDIE(16)
   Else
    Chgfmt CCE16 With "-K:1X"
   Endif
   If GFMTDIE(17)<>""
    Chgfmt CCE17 With GFMTDIE(17)
   Else
    Chgfmt CCE17 With "-K:1X"
   Endif
   If GFMTDIE(18)<>""
    Chgfmt CCE18 With GFMTDIE(18)
   Else
    Chgfmt CCE18 With "-K:1X"
   Endif
   If GFMTDIE(19)<>""
    Chgfmt CCE19 With GFMTDIE(19)
   Else
    Chgfmt CCE19 With "-K:1X"
   Endif
   If GFMTDIE(20)<>""
    Chgfmt CCE20 With GFMTDIE(20)
   Else
    Chgfmt CCE20 With "-K:1X"
   Endif
  Endif
Endcase
Return

$VISU
Local Integer A_REPONSE
Global Integer GPRE_VIEW
If dim(A_WINDPREV)<=0 : Local Char A_WINDPREV(30) : Endif
Local Mask WE3FTIST9 [POI1]
Gosub HORODAT
Local Inpbox "WE3FTIST9" From GFONCTION At A_STAMP With A_WINDPREV Mask [POI1] As [SIM_]
Grizo [POI1]5
Grizo [POI1]10
Grizo [POI1]15
Grizo [POI1]19
Grizo [POI1]20
Boxact [SIM_]
Gosub TITRES
Boxinp [SIM_] Using A_REPONSE
Close Local Inpbox [SIM_]
Close Local Mask [POI1]
Kill GPRE_VIEW
Return

$HARDCOP
Local Integer X1(0..14),X2(0..14),Y1(0..14),Y2(0..14)
X1(0)=1 : X2(0)=47 : Y1(0)=1 : Y2(0)=7
X1(1)=48 : X2(1)=47 : Y1(1)=1 : Y2(1)=0
X1(2)=48 : X2(2)=94 : Y1(2)=1 : Y2(2)=7
X1(6)=95 : X2(6)=129 : Y1(6)=1 : Y2(6)=7
X1(7)=1 : X2(7)=94 : Y1(7)=8 : Y2(7)=28
Return

$ON_POHFCY
Onevent CONTROL Call C_POHFCY(zc) From W1WE3FTIST9
Onevent AFTER_CHANGE Gosub AMM_POHFCY From W1WE3FTIST9
Onevent BEFORE_INPUT Call AS_POHFCY(zc) From W1WE3FTIST9
Return

Subprog AS_POHFCY(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Onkey   2 Titled GBOUTS Call S_POHFCY(zc) From W1WE3FTIST9
Onkey 144 Titled GBOUTP Call P_POHFCY(zc) From W1WE3FTIST9
Onkey 146 Titled GBOUTA Call SA_POHFCY(zc) From W1WE3FTIST9
Gosub _AFF
End

Subprog C_POHFCY(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "POHFCY" : GZNUM = 2550 : Endif
If !mkstat
 ## Action ACONTFCY
 Call CONTSITE(VALEUR) From SUBAGF
 If mkstat : GERR = 1 : GZONE = "POHFCY" : GZNUM = 2550 : Endif
 If !mkstat
  ## Action %CNTOBJ
  Call CONTSEL("FCY","G",VALEUR,"",mkstat) From CONTOBJ
  If mkstat : GERR = 1 : GZONE = "POHFCY" : GZNUM = 2550 : Endif
  If !mkstat
   ## Action CONTFCY
   Call CONTFCY(VALEUR) From EXEFNC
   If mkstat : GERR = 1 : GZONE = "POHFCY" : GZNUM = 2550 : Endif
   If !mkstat
    ## Action STD
    Call C_POHFCY(VALEUR) From SUBPOI
    If mkstat : GERR = 1 : GZONE = "POHFCY" : GZNUM = 2550 : Endif
   Endif
  Endif
 Endif
Endif
Gosub _AFF
End

$AMM_POHFCY
Call AM_POHFCY(zc)
If !mkstat & GOBJET
 zoncou = "POHFCY" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_POHFCY(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_POHFCY(VALEUR) From SUBPOI
If mkstat : GERR = 1 : GZONE = "POHFCY" : GZNUM = 2550 : Endif
If !mkstat & evalue("dim("+clanam([M])+"ZPOHFCY)")>indice
 [M]POHFCY(indice) = VALEUR
 Affzo ZPOHFCY(indice)
Endif
Gosub _AFF
End

Subprog S_POHFCY(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16)
PARMSK(1) = "FCY"
PARMSK(2) = "G"
Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJ","SELOBJ","") From GACTION
Gosub _AFF
End

Subprog SA_POHFCY(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "FCY"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_POHFCY(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("FCY",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZPOHFCY
Onevent BEFORE_AREA Gosub AV_ZPOHFCY From W1WE3FTIST9
Return

$AV_ZPOHFCY
If clalev([F:FCY])=0 : Local File FACILITY [FCY] : Endif
Call LECTURE("FCY",num$([M]POHFCY(indice)),"") From CONTOBJ
zc = [F:FCY]FCYNAM
Gosub _AFF
Return

$ON_USR
Return

$ON_ORDDAT
Onevent CONTROL Call C_ORDDAT(zc) From W1WE3FTIST9
Onevent AFTER_CHANGE Gosub AMM_ORDDAT From W1WE3FTIST9
Onevent BEFORE_AREA Gosub AV_ORDDAT From W1WE3FTIST9
Return

$AV_ORDDAT
Chgfmt [M]ORDDAT(indice) With "DZ:"+GFMDAT
Gosub _AFF
Return

Subprog C_ORDDAT(VALEUR)
Variable Date    VALEUR
## Action STD
Call C_ORDDAT(VALEUR) From SUBPOI
If mkstat : GERR = 1 : GZONE = "ORDDAT" : GZNUM = 2566 : Endif
Gosub _AFF
End

$AMM_ORDDAT
Call AM_ORDDAT(zc)
If !mkstat & GOBJET
 zoncou = "ORDDAT" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_ORDDAT(VALEUR)
Variable Date    VALEUR
## Action PAMPLIFLG
Call PAMPLIFLG([M:POI1]NBLIG,"ORDDAT") From TRTACHPRI1
If mkstat : GERR = 1 : GZONE = "ORDDAT" : GZNUM = 2566 : Endif
Gosub _AFF
End

$ON_BUY
Return

$ON_TARGRP
Onevent INIT_AREA Call D_TARGRP(zc) From W1WE3FTIST9
Onevent BEFORE_INPUT Call AS_TARGRP(zc) From W1WE3FTIST9
Return

Subprog D_TARGRP(VALEUR)
Variable Integer VALEUR
If varinit([M]TARGRP,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

Subprog AS_TARGRP(VALEUR)
Variable Integer VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
If VALEUR<1
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_HBPSNUM
Onevent CONTROL Call C_HBPSNUM(zc) From W1WE3FTIST9
Onevent AFTER_CHANGE Gosub AMM_HBPSNUM From W1WE3FTIST9
Onevent BEFORE_INPUT Call AS_HBPSNUM(zc) From W1WE3FTIST9
Return

Subprog AS_HBPSNUM(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(1515,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Onkey 129 Titled GBOUT1 Call B1_HBPSNUM(zc) From W1WE3FTIST9
Onkey   2 Titled GBOUTS Call S_HBPSNUM(zc) From W1WE3FTIST9
Onkey 144 Titled GBOUTP Call P_HBPSNUM(zc) From W1WE3FTIST9
Onkey 146 Titled GBOUTA Call SA_HBPSNUM(zc) From W1WE3FTIST9
Gosub _AFF
End

Subprog C_HBPSNUM(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action BPSCHOICE
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "BPSCHOICE"
 Call S_TAB_CHAR(VALEUR,PARMSK,"BPSCHOICE","TRTSEL","") From GACTION
 GACTION = SAVACT
 If mkstat : GERR = 1 : GZONE = "HBPSNUM" : GZNUM = 3680 : Endif
Endif
If !mkstat
 ## Action %CNTOBJ
 Call CONTSEL("BPS","!A",VALEUR,"",mkstat) From CONTOBJ
 If mkstat : GERR = 1 : GZONE = "HBPSNUM" : GZNUM = 3680 : Endif
Endif
Gosub _AFF
End

$AMM_HBPSNUM
Call AM_HBPSNUM(zc)
If !mkstat & GOBJET
 zoncou = "HBPSNUM" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_HBPSNUM(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_HBPSNUM(VALEUR) From SUBPOI
If mkstat : GERR = 1 : GZONE = "HBPSNUM" : GZNUM = 3680 : Endif
If !mkstat & evalue("dim("+clanam([M])+"ZHBPSNUM)")>indice
 [M]HBPSNUM(indice) = VALEUR
 Affzo ZHBPSNUM(indice)
Endif
Gosub _AFF
End

Subprog S_HBPSNUM(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16)
PARMSK(1) = "BPS"
PARMSK(2) = "!A"
Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJ","SELOBJ","") From GACTION
Gosub _AFF
End

Subprog B1_HBPSNUM(VALEUR)
Variable Char    VALEUR()
Call OBJET("BPS",VALEUR,"") From GOBJET
Gosub _AFF
End

Subprog SA_HBPSNUM(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "BPS"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_HBPSNUM(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("BPS",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZHBPSNUM
Onevent BEFORE_AREA Gosub AV_ZHBPSNUM From W1WE3FTIST9
Return

$AV_ZHBPSNUM
If clalev([F:BPS])=0 : Local File BPSUPPLIER [BPS] : Endif
Call LECTURE("BPS",num$([M]HBPSNUM(indice)),"") From CONTOBJ
zc = [F:BPS]BPSNAM
Gosub _AFF
Return

$ON_PJTH
Return

$ON_PCLFLG
Onevent INIT_AREA Call D_PCLFLG(zc) From W1WE3FTIST9
Return

Subprog D_PCLFLG(VALEUR)
Variable Integer VALEUR
If varinit([M]PCLFLG,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_WORDFCY
Return

$ON_WBPSNUM
Return

$ON_WCUR
Return

$ON_NBAXE
Onevent INIT_AREA Call D_NBAXE From W1WE3FTIST9
Onevent CONTROL Call C_NBAXE From W1WE3FTIST9
Return

Subprog D_NBAXE
Local Decimal BASPAG
If varinit([M]NBAXE)=0
 ## Action INICCEH
 Call INIT_CCEH("POI1","NBAXE","POI") From TRTX3CPT
Endif
Gosub _AFF
End

Subprog C_NBAXE
Local Decimal BASPAG
## Action STD
Call C_NBAXE From SUBPOI
If mkstat : GERR = 1 : GZONE = "NBAXE" : GZNUM = 0 : Endif
Gosub _AFF
End

$ON_DIE
Return

$ON_NAMDIE
Onevent BEFORE_AREA Gosub AV_NAMDIE From W1WE3FTIST9
Return

$AV_NAMDIE
zc = GCOLDIE(nolign)
Gosub _AFF
Return

$ON_CCE
Onevent BEFORE_AREA Gosub AV_CCE From W1WE3FTIST9
Return

$AV_CCE
## Action INICCEFMT
Call INICCEFMT(num$(GDIE(nolign))) From SETGLBDIE
Gosub _AFF
Return

$ON_PRTFLG
Onevent AFTER_CHANGE Gosub AMM_PRTFLG From W1WE3FTIST9
Onevent INIT_AREA Call D_PRTFLG(zc) From W1WE3FTIST9
Onevent BEFORE_INPUT Call AS_PRTFLG(zc) From W1WE3FTIST9
Return

Subprog D_PRTFLG(VALEUR)
Variable Integer VALEUR
If varinit([M]PRTFLG,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

Subprog AS_PRTFLG(VALEUR)
Variable Integer VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
If VALEUR<1
 VALEUR = 1
Endif
Gosub _AFF
End

$AMM_PRTFLG
Call AM_PRTFLG(zc)
If !mkstat & GOBJET
 zoncou = "PRTFLG" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_PRTFLG(VALEUR)
Variable Integer VALEUR
## Action STD
Call AM_PRTFLG(VALEUR) From SUBPOI
If mkstat : GERR = 1 : GZONE = "PRTFLG" : GZNUM = 32969 : Endif
Gosub _AFF
End

$ON_DOCNAM
Onevent CONTROL Call C_DOCNAM(zc) From W1WE3FTIST9
Onevent AFTER_CHANGE Gosub AMM_DOCNAM From W1WE3FTIST9
Onevent BEFORE_INPUT Call AS_DOCNAM(zc) From W1WE3FTIST9
Return

Subprog AS_DOCNAM(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(11937,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Onkey 129 Titled GBOUT1 Call B1_DOCNAM(zc) From W1WE3FTIST9
Onkey   2 Titled GBOUTS Call S_DOCNAM(zc) From W1WE3FTIST9
Onkey 144 Titled GBOUTP Call P_DOCNAM(zc) From W1WE3FTIST9
Onkey 146 Titled GBOUTA Call SA_DOCNAM(zc) From W1WE3FTIST9
Gosub _AFF
End

Subprog C_DOCNAM(VALEUR)
Variable Char    VALEUR()
## Action %CNTOBJ
Call CONTSEL("ARP","!ALP",VALEUR,"",mkstat) From CONTOBJ
If mkstat : GERR = 1 : GZONE = "DOCNAM" : GZNUM = 5169 : Endif
If !mkstat
 ## Action STD
 Call C_DOCNAM(VALEUR) From SUBPOI
 If mkstat : GERR = 1 : GZONE = "DOCNAM" : GZNUM = 5169 : Endif
Endif
Gosub _AFF
End

$AMM_DOCNAM
Call AM_DOCNAM(zc)
If !mkstat & GOBJET
 zoncou = "DOCNAM" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_DOCNAM(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_DOCNAM(VALEUR) From SUBPOI
If mkstat : GERR = 1 : GZONE = "DOCNAM" : GZNUM = 5169 : Endif
If !mkstat & evalue("dim("+clanam([M])+"ZDOCNAM)")>indice
 [M]DOCNAM(indice) = VALEUR
 Affzo ZDOCNAM(indice)
Endif
Gosub _AFF
End

Subprog S_DOCNAM(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16)
PARMSK(1) = "ARP"
PARMSK(2) = "!ALP"
Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJ","SELOBJ","") From GACTION
Gosub _AFF
End

Subprog B1_DOCNAM(VALEUR)
Variable Char    VALEUR()
Call OBJET("ARP",VALEUR,"") From GOBJET
Gosub _AFF
End

Subprog SA_DOCNAM(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "ARP"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_DOCNAM(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("ARP",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZDOCNAM
Onevent BEFORE_AREA Gosub AV_ZDOCNAM From W1WE3FTIST9
Return

$AV_ZDOCNAM
If clalev([F:ARP])=0 : Local File AREPORT [ARP] : Endif
Call LECTURE("ARP",[M]DOCNAM(indice),"") From CONTOBJ
Call TEXTE([F:ARP]RPTDES,zc) From OBJDIV
Gosub _AFF
Return

$ON_PRTCOD
Onevent INIT_AREA Call D_PRTCOD(zc) From W1WE3FTIST9
Onevent CONTROL Call C_PRTCOD(zc) From W1WE3FTIST9
Onevent AFTER_CHANGE Gosub AMM_PRTCOD From W1WE3FTIST9
Onevent BEFORE_INPUT Call AS_PRTCOD(zc) From W1WE3FTIST9
Return

Subprog D_PRTCOD(VALEUR)
Variable Char    VALEUR()
If varinit([M]PRTCOD,indice)=0
 ## Action AIMDEF
 Call AIMDEF(VALEUR,[M:POI1]DOCNAM,GBIDC1,GBIDC2) From IMPRIME
Endif
Gosub _AFF
End

Subprog AS_PRTCOD(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(24851,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Onkey 129 Titled GBOUT1 Call B1_PRTCOD(zc) From W1WE3FTIST9
Onkey   2 Titled GBOUTS Call S_PRTCOD(zc) From W1WE3FTIST9
Onkey 144 Titled GBOUTP Call P_PRTCOD(zc) From W1WE3FTIST9
Onkey 146 Titled GBOUTA Call SA_PRTCOD(zc) From W1WE3FTIST9
Gosub _AFF
End

Subprog C_PRTCOD(VALEUR)
Variable Char    VALEUR()
## Action %CNTOBJ
Call CONTSEL("AIM","!A",VALEUR,"",mkstat) From CONTOBJ
If mkstat : GERR = 1 : GZONE = "PRTCOD" : GZNUM = 5231 : Endif
If !mkstat
 ## Action STD
 Call C_PRTCOD(VALEUR) From SUBPOI
 If mkstat : GERR = 1 : GZONE = "PRTCOD" : GZNUM = 5231 : Endif
 If !mkstat
  ## Action AIMCONT
  Call AIMCONT(VALEUR,[M:POI1]DOCNAM,0) From IMPRIME
  If mkstat : GERR = 1 : GZONE = "PRTCOD" : GZNUM = 5231 : Endif
 Endif
Endif
Gosub _AFF
End

$AMM_PRTCOD
Call AM_PRTCOD(zc)
If !mkstat & GOBJET
 zoncou = "PRTCOD" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_PRTCOD(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_PRTCOD(VALEUR) From SUBPOI
If mkstat : GERR = 1 : GZONE = "PRTCOD" : GZNUM = 5231 : Endif
If !mkstat & evalue("dim("+clanam([M])+"ZPRTCOD)")>indice
 [M]PRTCOD(indice) = VALEUR
 Affzo ZPRTCOD(indice)
Endif
Gosub _AFF
End

Subprog S_PRTCOD(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action ASELAIM
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "ASELAIM"
 Call S_TAB_CHAR(VALEUR,PARMSK,"ASELAIM","SUBAIM","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B1_PRTCOD(VALEUR)
Variable Char    VALEUR()
Call OBJET("AIM",VALEUR,"") From GOBJET
Gosub _AFF
End

Subprog SA_PRTCOD(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "AIM"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_PRTCOD(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("AIM",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZPRTCOD
Onevent BEFORE_AREA Gosub AV_ZPRTCOD From W1WE3FTIST9
Return

$AV_ZPRTCOD
If clalev([F:AIM])=0 : Local File APRINTER [AIM] : Endif
Call LECTURE("AIM",num$([M]PRTCOD(indice)),"") From CONTOBJ
zc = [F:AIM]SHO
Gosub _AFF
Return

$ON_TCTRNUM
Return

$ON_WEICAP
Onevent BEFORE_AREA Gosub AV_WEICAP From W1WE3FTIST9
Return

$AV_WEICAP
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]TCTRWEU,GUNITE(1..GNBUNT)),1))
Endif
Gosub _AFF
Return

$ON_TCTRQTY
Return

$ON_VOLCAP
Onevent BEFORE_AREA Gosub AV_VOLCAP From W1WE3FTIST9
Return

$AV_VOLCAP
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]TCTRVOU,GUNITE(1..GNBUNT)),1))
Endif
Gosub _AFF
Return

$ON_WEITOT
Onevent BEFORE_AREA Gosub AV_WEITOT From W1WE3FTIST9
Return

$AV_WEITOT
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]TCTRWEU,GUNITE(1..GNBUNT)),1))
Endif
Gosub _AFF
Return

$ON_VOLTOT
Onevent BEFORE_AREA Gosub AV_VOLTOT From W1WE3FTIST9
Return

$AV_VOLTOT
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]TCTRVOU,GUNITE(1..GNBUNT)),1))
Endif
Gosub _AFF
Return

$ON_WEIAVL
Onevent BEFORE_AREA Gosub AV_WEIAVL From W1WE3FTIST9
Return

$AV_WEIAVL
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]TCTRWEU,GUNITE(1..GNBUNT)),1))
Endif
Gosub _AFF
Return

$ON_TCTRWEU
Return

$ON_VOLAVL
Onevent BEFORE_AREA Gosub AV_VOLAVL From W1WE3FTIST9
Return

$AV_VOLAVL
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]TCTRVOU,GUNITE(1..GNBUNT)),1))
Endif
Gosub _AFF
Return

$ON_TCTRVOU
Return

$ON_ORDMINAMT
Onevent BEFORE_AREA Gosub AV_ORDMINAMT From W1WE3FTIST9
Onevent CONTROL Call C_ORDMINAMT(zc) From W1WE3FTIST9
Return

$AV_ORDMINAMT
## Action INIDEV
GDEVFMT="11.2" : GDEVFMT = GDEVFMT1(max(find(GLOCALDEV,GDEVISE(1..GNBDEV)),1))
Chgfmt [M]ORDMINAMT(indice) With "N+z3:"+GDEVFMT
Gosub _AFF
Return

Subprog C_ORDMINAMT(VALEUR)
Variable Decimal VALEUR
Gosub _AFF
End

$ON_ORDMAXAMT
Onevent BEFORE_AREA Gosub AV_ORDMAXAMT From W1WE3FTIST9
Return

$AV_ORDMAXAMT
## Action INIDEV
GDEVFMT="11.2" : GDEVFMT = GDEVFMT1(max(find(GLOCALDEV,GDEVISE(1..GNBDEV)),1))
Gosub _AFF
Return

$ON_ORDFREFRT
Onevent BEFORE_AREA Gosub AV_ORDFREFRT From W1WE3FTIST9
Return

$AV_ORDFREFRT
## Action INIDEV
GDEVFMT="11.2" : GDEVFMT = GDEVFMT1(max(find(GLOCALDEV,GDEVISE(1..GNBDEV)),1))
Gosub _AFF
Return

$ON_TOTCOST
Onevent BEFORE_AREA Gosub AV_TOTCOST From W1WE3FTIST9
Return

$AV_TOTCOST
## Action INIDEV
GDEVFMT="11.2" : GDEVFMT = GDEVFMT1(max(find(GLOCALDEV,GDEVISE(1..GNBDEV)),1))
Chgfmt [M]TOTCOST(indice) With "NPz3:"+GDEVFMT
Gosub _AFF
Return

$ON_TOTCUR
Return

$ON_NBLIG
Onevent BEFORE_INPUT Call AS_NBLIG From W1WE3FTIST9
Onevent CONTROL Call C_NBLIG From W1WE3FTIST9
Onevent BEFORE_LINE Call AVANT_NBLIG From W1WE3FTIST9
Onevent AFTER_LINE Call APRES_NBLIG From W1WE3FTIST9
Onevent BEFORE_AREA Call AV_NBLIG From W1WE3FTIST9
Return

Subprog IB_NBLIG
Local Decimal BASPAG
If !GWEBSERV
 ## Action STD
 Call IB_NBLIG From SUBPOI
Endif
Gosub _AFF
End

Subprog AV_NBLIG
Local Decimal BASPAG
If adxgtb=1 & !GORITITCOL & nolign=1
 Local Char BASPAG(10)
 BASPAG = "NBLIG" : Gosub TIT_COL From W3WE3FTIST9
Endif
Gosub _AFF
End

Subprog AS_NBLIG
Local Decimal BASPAG
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(8046,GBOUT2) From OBJDIV
Call TEXTE(15405,GBOUT3) From OBJDIV
Call IB_NBLIG
## Action STD
Call AS_NBLIG From SUBPOI
Onkey 130 Titled GBOUT2 Call B2_NBLIG From W1WE3FTIST9
Onkey 131 Titled GBOUT3 Call B3_NBLIG From W1WE3FTIST9
Gosub _AFF
End

Subprog C_NBLIG
Local Decimal BASPAG
## Action STD
Call C_NBLIG From SUBPOI
If mkstat : GERR = 1 : GZONE = "NBLIG" : GZNUM = 0 : Endif
Gosub _AFF
End

Subprog B2_NBLIG
Local Decimal BASPAG
If !GWEBSERV
 ## Action SAIPECB2
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SAIPECB2"
 PARMSK(1) = num$([M:POI1]PRONUM)
 PARMSK(2) = "POI"
 PARMSK(3) = [M:POI1]REFART
 PARMSK(4) = [M:POI1]BUY
 PARMSK(5) = "3"
 Call SAISIE_NUM(BASPAG,PARMSK,"IPPICORD2","SUBPOIA","SPEPOI") From GSAISIE
 [M:POI1]REFART = PARMSK(3)
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B3_NBLIG
Local Decimal BASPAG
If !GWEBSERV
 ## Action VISUCLCPRI
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "VISUCLCPRI"
 PARMSK(1) = "POI"
 PARMSK(2) = [M:POI1]CUR(nolign-1)
 PARMSK(3) = num$(nolign-1)
 PARMSK(4) = "2"
 Call SAISIE_NUM(BASPAG,PARMSK,"IDETPRI","TRTPRICE","XWIDETPRI") From GSAISIE
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog AVANT_NBLIG
Local Decimal BASPAG
## Action STD
Call AVANT_NBLIG From SUBPOI
If mkstat : End : Endif
Gosub _AFF
End

Subprog APRES_NBLIG
Local Decimal BASPAG
## Action DIVLINNUM
Call LINNUM("SRTLIN") From TABLEAUX
If mkstat : End : Endif
## Action STD
Call APRES_NBLIG From SUBPOI
If mkstat : End : Endif
Gosub _AFF
End

$ON_NOLIG
Onevent BEFORE_AREA Gosub AV_NOLIG From W1WE3FTIST9
Return

$AV_NOLIG
zc = nolign
Gosub _AFF
Return

$ON_ITMREF
Onevent CONTROL Call C_ITMREF(zc) From W1WE3FTIST9
Onevent BEFORE_INPUT Call AS_ITMREF(zc) From W1WE3FTIST9
Onevent AFTER_CHANGE Gosub AMM_ITMREF From W1WE3FTIST9
Return

Subprog IB_ITMREF(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action IBPRDINF
 Call IBPRDINF(VALEUR) From PRDINFLIB
Endif
If !GWEBSERV
 ## Action STD
 Call IB_ITMREF From SUBPOI
Endif
Gosub _AFF
End

Subprog AS_ITMREF(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(2061,GBOUT1) From OBJDIV
Call TEXTE(8046,GBOUT2) From OBJDIV
Call TEXTE(12837,GBOUT13) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_ITMREF(VALEUR)
## Action STD
Call AS_ITMREF(VALEUR) From SUBPOI
If mkstat=2
 [M]ITMREF(INDIC) = VALEUR
 Affzo ITMREF(INDIC) : mkstat = 2
Endif
Onkey 129 Titled GBOUT1 Call B1_ITMREF(zc) From W1WE3FTIST9
Onkey 130 Titled GBOUT2 Call B2_ITMREF(zc) From W1WE3FTIST9
Onkey 170 Titled GBOUT13 Call B13_ITMREF(zc) From W1WE3FTIST9
Onkey   2 Titled GBOUTS Call S_ITMREF(zc) From W1WE3FTIST9
Onkey 144 Titled GBOUTP Call P_ITMREF(zc) From W1WE3FTIST9
Onkey 146 Titled GBOUTA Call SA_ITMREF(zc) From W1WE3FTIST9
Gosub _AFF
End

Subprog C_ITMREF(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
If !GWEBSERV
 If !mkstat
  ## Action ITMCHOICE
  Local Char    PARMSK(250)(1..20) , SAVACT(20)
  SAVACT = GACTION : GACTION = "ITMCHOICE"
  Call S_TAB_CHAR(VALEUR,PARMSK,"ITMCHOICE","TRTSEL","") From GACTION
  GACTION = SAVACT
  If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
 Endif
Endif
If !mkstat
 ## Action VXADCUPC
 Call ADCCTRUPC(VALEUR) From VXADCUPC
 If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
 If !mkstat
  ## Action %CNTOBJ
  Call CONTSEL("ITM","B",VALEUR,"",mkstat) From CONTOBJ
  If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
  If !mkstat
   ## Action STD
   Call C_ITMREF(VALEUR) From SUBPOI
   If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
  Endif
 Endif
Endif
Gosub _AFF
End

$AMM_ITMREF
Call AM_ITMREF(zc)
If !mkstat & GOBJET
 zoncou = "ITMREF" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_ITMREF(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_ITMREF(VALEUR) From SUBPOI
If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
If !mkstat
 ## Action INIECCSTA
 Call INIECCSTA(VALEUR,"POI1",nolign-1) From STKECR
 If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
Endif
Gosub _AFF
End

Subprog S_ITMREF(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16)
PARMSK(1) = "ITM"
PARMSK(2) = "B"
Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJ","SELOBJ","") From GACTION
Gosub _AFF
End

Subprog B1_ITMREF(VALEUR)
Variable Char    VALEUR()
Call OBJET("ITM",VALEUR,"") From GOBJET
Gosub _AFF
End

Subprog B2_ITMREF(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SAIPECB2
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SAIPECB2"
 PARMSK(1) = num$([M:POI1]PRONUM)
 PARMSK(2) = "POI"
 PARMSK(3) = VALEUR
 PARMSK(4) = [M:POI1]BUY
 PARMSK(5) = "3"
 Call SAISIE_CHAR(VALEUR,PARMSK,"IPPICORD2","SUBPOIA","SPEPOI") From GSAISIE
 VALEUR = PARMSK(3)
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B13_ITMREF(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PRDINFA
 Call PRDINF(VALEUR) From PRDINFLIB
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog SA_ITMREF(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "ITM"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_ITMREF(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("ITM",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ITMDES
Onevent BEFORE_INPUT Call AS_ITMDES(zc) From W1WE3FTIST9
Onevent CONTROL Call C_ITMDES(zc) From W1WE3FTIST9
Return

Subprog IB_ITMDES(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action STD
 Call IB_ITMDES From SUBPOI
Endif
Gosub _AFF
End

Subprog AS_ITMDES(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(735,GBOUT1) From OBJDIV
Call IB_ITMDES(VALEUR)
## Action PASLIN
If GMODIF<>2 mkstat=2 : Endif
If mkstat=2
 [M]ITMDES(INDIC) = VALEUR
 Affzo ITMDES(INDIC) : mkstat = 2
Endif
Onkey 129 Titled GBOUT1 Call B1_ITMDES(zc) From W1WE3FTIST9
Gosub _AFF
End

Subprog C_ITMDES(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "ITMDES" : GZNUM = 282 : Endif
Gosub _AFF
End

Subprog B1_ITMDES(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action GOBJETC0A
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "GOBJETC0A"
 Local Char ACTION(20), PROGSUB(GLONADC), PROGSPE(GLONADC), PROGSPV(GLONADC)
 ACTION = "AB1_ITMDES" : PROGSUB = "SUBPOI" : PROGSPE = "SPEPOI" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 Local Char    OBJCLE(30)
 OBJCLE = [M:POI1]ITMREF(nolign-1)
 Call OBJET_CHAR(OBJCLE,"ITM","") From GOBJET
 ACTION = "BB1_ITMDES" : PROGSUB = "SUBPOI" : PROGSPE = "SPEPOI" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

$ON_ITMDES1
Return

$ON_PRHFCY
Onevent CONTROL Call C_PRHFCY(zc) From W1WE3FTIST9
Onevent BEFORE_INPUT Call AS_PRHFCY(zc) From W1WE3FTIST9
Onevent AFTER_CHANGE Gosub AMM_PRHFCY From W1WE3FTIST9
Return

Subprog IB_PRHFCY(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action STD
 Call IB_PRHFCY From SUBPOI
Endif
Gosub _AFF
End

Subprog AS_PRHFCY(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(12817,GBOUT3) From OBJDIV
Call TEXTE(16776,GBOUT4) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_PRHFCY(VALEUR)
## Action PASLIN
If GMODIF<>2 mkstat=2 : Endif
If mkstat=2
 [M]PRHFCY(INDIC) = VALEUR
 Affzo PRHFCY(INDIC) : mkstat = 2
Endif
If !mkstat
 ## Action STD
 Call AS_PRHFCY(VALEUR) From SUBPOI
 If mkstat=2
  [M]PRHFCY(INDIC) = VALEUR
  Affzo PRHFCY(INDIC) : mkstat = 2
 Endif
 Onkey 131 Titled GBOUT3 Call B3_PRHFCY(zc) From W1WE3FTIST9
 Onkey 132 Titled GBOUT4 Call B4_PRHFCY(zc) From W1WE3FTIST9
 Onkey   2 Titled GBOUTS Call S_PRHFCY(zc) From W1WE3FTIST9
 Onkey 144 Titled GBOUTP Call P_PRHFCY(zc) From W1WE3FTIST9
 Onkey 146 Titled GBOUTA Call SA_PRHFCY(zc) From W1WE3FTIST9
Endif
Gosub _AFF
End

Subprog C_PRHFCY(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "PRHFCY" : GZNUM = 1344 : Endif
If !mkstat
 ## Action ACONTFCY
 Call CONTSITE(VALEUR) From SUBAGF
 If mkstat : GERR = 1 : GZONE = "PRHFCY" : GZNUM = 1344 : Endif
 If !mkstat
  ## Action %CNTOBJ
  Call CONTSEL("FCY","",VALEUR,"",mkstat) From CONTOBJ
  If mkstat : GERR = 1 : GZONE = "PRHFCY" : GZNUM = 1344 : Endif
  If !mkstat
   ## Action STD
   Call C_PRHFCY(VALEUR) From SUBPOI
   If mkstat : GERR = 1 : GZONE = "PRHFCY" : GZNUM = 1344 : Endif
  Endif
 Endif
Endif
Gosub _AFF
End

$AMM_PRHFCY
Call AM_PRHFCY(zc)
If !mkstat & GOBJET
 zoncou = "PRHFCY" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_PRHFCY(VALEUR)
Variable Char    VALEUR()
## Action TRTPRHFCY
Local Char    PARMSK(250)(1..20) , SAVACT(20)
SAVACT = GACTION : GACTION = "TRTPRHFCY"
PARMSK(1) = [M:POI1]ITMREF(nolign-1)
Call TRAITE_CHAR(VALEUR,PARMSK,"","TRTACHCTL1","",1,"XYTRTACHCTL1") From GTRAITE
GACTION = SAVACT
If mkstat : GERR = 1 : GZONE = "PRHFCY" : GZNUM = 1344 : Endif
If !mkstat
 ## Action GOBJETC0A
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "GOBJETC0A"
 Local Char ACTION(20), PROGSUB(GLONADC), PROGSPE(GLONADC), PROGSPV(GLONADC)
 ACTION = "AAM_PRHFCY" : PROGSUB = "SUBPOI" : PROGSPE = "SPEPOI" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 Local Char    OBJCLE(30)
 OBJCLE = VALEUR
 Call OBJET_CHAR(OBJCLE,WOBJET,[M:POI1]ITMREF(nolign-1)) From GOBJET
 ACTION = "BAM_PRHFCY" : PROGSUB = "SUBPOI" : PROGSPE = "SPEPOI" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 GACTION = SAVACT
 If mkstat : GERR = 1 : GZONE = "PRHFCY" : GZNUM = 1344 : Endif
 If !mkstat
  ## Action STD
  Call AM_PRHFCY(VALEUR) From SUBPOI
  If mkstat : GERR = 1 : GZONE = "PRHFCY" : GZNUM = 1344 : Endif
 Endif
Endif
Gosub _AFF
End

Subprog S_PRHFCY(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELPRHFCY
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELPRHFCY"
 PARMSK(1) = num$([M:POI1]STOMGTCOD(nolign-1))
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPRHFCY","TRTACHSEL1","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B3_PRHFCY(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action CONSSFC
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "CONSSFC"
 Local Char ACTION(20), PROGSUB(GLONADC), PROGSPE(GLONADC), PROGSPV(GLONADC)
 ACTION = "AB3_PRHFCY" : PROGSUB = "SUBPOI" : PROGSPE = "SPEPOI" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 PARMSK(1) = "0"
 PARMSK(2) = VALEUR
 PARMSK(3) = [M:POI1]ITMREF(nolign-1)
 PARMSK(4) = ""
 Call CONSULT_CHAR(VALEUR,"SFC",PARMSK) From GCONSULT
 ACTION = "BB3_PRHFCY" : PROGSUB = "SUBPOI" : PROGSPE = "SPEPOI" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B4_PRHFCY(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELITMFCY
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELITMFCY"
 PARMSK(1) = "ITMREF=[M:POI1]ITMREF(nolign-1)"
 PARMSK(2) = ""
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELITMFCY","TRTACHSEL1","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog SA_PRHFCY(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "FCY"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_PRHFCY(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("FCY",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_FCYADD
Return

$ON_USEPLC
Return

$ON_UOM
Onevent BEFORE_INPUT Call AS_UOM(zc) From W1WE3FTIST9
Onevent CONTROL Call C_UOM(zc) From W1WE3FTIST9
Onevent AFTER_CHANGE Gosub AMM_UOM From W1WE3FTIST9
Return

Subprog AS_UOM(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
## Action PASLIN
If GMODIF<>2 mkstat=2 : Endif
If mkstat=2
 [M]UOM(INDIC) = VALEUR
 Affzo UOM(INDIC) : mkstat = 2
Endif
Onkey   2 Titled GBOUTS Call S_UOM(zc) From W1WE3FTIST9
Onkey 144 Titled GBOUTP Call P_UOM(zc) From W1WE3FTIST9
Onkey 146 Titled GBOUTA Call SA_UOM(zc) From W1WE3FTIST9
Gosub _AFF
End

Subprog C_UOM(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "UOM" : GZNUM = 2192 : Endif
If !mkstat
 ## Action %CNTOBJ
 Call CONTSEL("TUN","",VALEUR,"",mkstat) From CONTOBJ
 If mkstat : GERR = 1 : GZONE = "UOM" : GZNUM = 2192 : Endif
 If !mkstat
  ## Action PCOUOM
  Call PCOUOM(VALEUR,[M:POI1]BPSNUM(nolign-1),[M:POI1]ITMREF(nolign-1),3,5) From TRTACHCTL1
  If mkstat : GERR = 1 : GZONE = "UOM" : GZNUM = 2192 : Endif
  If !mkstat
   ## Action STD
   Call C_UOM(VALEUR) From SUBPOI
   If mkstat : GERR = 1 : GZONE = "UOM" : GZNUM = 2192 : Endif
  Endif
 Endif
Endif
Gosub _AFF
End

$AMM_UOM
Call AM_UOM(zc)
If !mkstat & GOBJET
 zoncou = "UOM" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_UOM(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_UOM(VALEUR) From SUBPOI
If mkstat : GERR = 1 : GZONE = "UOM" : GZNUM = 2192 : Endif
Gosub _AFF
End

Subprog S_UOM(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELPUOM
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELPUOM"
 PARMSK(1) = [M:POI1]BPSNUM(nolign-1)
 PARMSK(2) = [M:POI1]ITMREF(nolign-1)
 PARMSK(3) = "3"
 PARMSK(4) = "5"
 Call S_LIS_CHAR(VALEUR,PARMSK,"SELPUOM","TRTACHSEL1","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog SA_UOM(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "TUN"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_UOM(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("TUN",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_UOMFLG
Onevent INIT_AREA Call D_UOMFLG(zc) From W1WE3FTIST9
Return

Subprog D_UOMFLG(VALEUR)
Variable Integer VALEUR
If varinit([M]UOMFLG,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_QTYUOM
Onevent BEFORE_AREA Gosub AV_QTYUOM From W1WE3FTIST9
Onevent BEFORE_INPUT Call AS_QTYUOM(zc) From W1WE3FTIST9
Onevent CONTROL Call C_QTYUOM(zc) From W1WE3FTIST9
Onevent AFTER_CHANGE Gosub AMM_QTYUOM From W1WE3FTIST9
Return

Subprog IB_QTYUOM(VALEUR)
Variable Decimal VALEUR
If !GWEBSERV
 ## Action STD
 Call IB_QTYUOM From SUBPOI
Endif
Gosub _AFF
End

$AV_QTYUOM
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M:POI1]UOM(nolign-1),GUNITE(1..GNBUNT)),1))
Endif
Chgfmt [M]QTYUOM(indice) With "N+z:"+GUNTFMT
Gosub _AFF
Return

Subprog AS_QTYUOM(VALEUR)
Variable Decimal VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(12817,GBOUT3) From OBJDIV
Call TEXTE(53893,GBOUT6) From OBJDIV
Call IB_QTYUOM(VALEUR)
## Action PASLIN
If GMODIF<>2 mkstat=2 : Endif
If mkstat=2
 [M]QTYUOM(INDIC) = VALEUR
 Affzo QTYUOM(INDIC) : mkstat = 2
Endif
Onkey 131 Titled GBOUT3 Call B3_QTYUOM(zc) From W1WE3FTIST9
Onkey 134 Titled GBOUT6 Call B6_QTYUOM(zc) From W1WE3FTIST9
Gosub _AFF
End

Subprog C_QTYUOM(VALEUR)
Variable Decimal VALEUR
## Action %OBLIG
If VALEUR=0
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "QTYUOM" : GZNUM = 4620 : Endif
If !mkstat
 ## Action STD
 Call C_QTYUOM(VALEUR) From SUBPOI
 If mkstat : GERR = 1 : GZONE = "QTYUOM" : GZNUM = 4620 : Endif
Endif
Gosub _AFF
End

$AMM_QTYUOM
Call AM_QTYUOM(zc)
If !mkstat & GOBJET
 zoncou = "QTYUOM" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_QTYUOM(VALEUR)
Variable Decimal VALEUR
## Action STD
Call AM_QTYUOM(VALEUR) From SUBPOI
If mkstat : GERR = 1 : GZONE = "QTYUOM" : GZNUM = 4620 : Endif
Gosub _AFF
End

Subprog B3_QTYUOM(VALEUR)
Variable Decimal VALEUR
If !GWEBSERV
 ## Action CONSSFC
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "CONSSFC"
 Local Char ACTION(20), PROGSUB(GLONADC), PROGSPE(GLONADC), PROGSPV(GLONADC)
 ACTION = "AB3_QTYUOM" : PROGSUB = "SUBPOI" : PROGSPE = "SPEPOI" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 PARMSK(1) = "0"
 PARMSK(2) = [M:POI1]PRHFCY(nolign-1)
 PARMSK(3) = [M:POI1]ITMREF(nolign-1)
 PARMSK(4) = ""
 Call CONSULT_NUM(VALEUR,"SFC",PARMSK) From GCONSULT
 ACTION = "BB3_QTYUOM" : PROGSUB = "SUBPOI" : PROGSPE = "SPEPOI" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B6_QTYUOM(VALEUR)
Variable Decimal VALEUR
If !GWEBSERV
 ## Action ITMHIS
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "ITMHIS"
 PARMSK(1) = [M:POI1]ITMREF(nolign-1)
 PARMSK(2) = [M:POI1]PRHFCY(nolign-1)
 Call TRAITE_NUM(VALEUR,PARMSK,"ITMHIS","TRTITH","",1,"SPEITH") From GTRAITE
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

$ON_UOMPUUCOE
Onevent BEFORE_INPUT Call AS_UOMPUUCOE(zc) From W1WE3FTIST9
Onevent AFTER_CHANGE Gosub AMM_UOMPUUCOE From W1WE3FTIST9
Return

Subprog AS_UOMPUUCOE(VALEUR)
Variable Decimal VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
## Action STD
Call AS_UOMPUUCOE(VALEUR) From SUBPOI
If mkstat=2
 [M]UOMPUUCOE(INDIC) = VALEUR
 Affzo UOMPUUCOE(INDIC) : mkstat = 2
Endif
If !mkstat
 ## Action PASLIN
 If GMODIF<>2 mkstat=2 : Endif
 If mkstat=2
  [M]UOMPUUCOE(INDIC) = VALEUR
  Affzo UOMPUUCOE(INDIC) : mkstat = 2
 Endif
Endif
Gosub _AFF
End

$AMM_UOMPUUCOE
Call AM_UOMPUUCOE(zc)
If !mkstat & GOBJET
 zoncou = "UOMPUUCOE" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_UOMPUUCOE(VALEUR)
Variable Decimal VALEUR
## Action STD
Call AM_UOMPUUCOE(VALEUR) From SUBPOI
If mkstat : GERR = 1 : GZONE = "UOMPUUCOE" : GZNUM = 3377 : Endif
Gosub _AFF
End

$ON_PUU
Return

$ON_QTYPUU
Onevent BEFORE_AREA Gosub AV_QTYPUU From W1WE3FTIST9
Return

$AV_QTYPUU
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M:POI1]PUU(nolign-1),GUNITE(1..GNBUNT)),1))
Endif
Gosub _AFF
Return

$ON_STU
Return

$ON_QTYSTU
Onevent BEFORE_AREA Gosub AV_QTYSTU From W1WE3FTIST9
Return

$AV_QTYSTU
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M:POI1]STU(nolign-1),GUNITE(1..GNBUNT)),1))
Endif
Chgfmt [M]QTYSTU(indice) With "NP+z:"+GUNTFMT
Gosub _AFF
Return

$ON_ITMWEI
Onevent BEFORE_AREA Gosub AV_ITMWEI From W1WE3FTIST9
Return

$AV_ITMWEI
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]LINWEU(nolign-1),GUNITE(1..GNBUNT)),1))
Endif
Gosub _AFF
Return

$ON_LINWEI
Onevent BEFORE_AREA Gosub AV_LINWEI From W1WE3FTIST9
Return

$AV_LINWEI
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]LINWEU(nolign-1),GUNITE(1..GNBUNT)),1))
Endif
Gosub _AFF
Return

$ON_LINTCTRWEI
Onevent BEFORE_AREA Gosub AV_LINTCTRWEI From W1WE3FTIST9
Return

$AV_LINTCTRWEI
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]TCTRWEU,GUNITE(1..GNBUNT)),1))
Endif
Gosub _AFF
Return

$ON_LINWEU
Return

$ON_ITMVOL
Onevent BEFORE_AREA Gosub AV_ITMVOL From W1WE3FTIST9
Return

$AV_ITMVOL
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]LINVOU(nolign-1),GUNITE(1..GNBUNT)),1))
Endif
Gosub _AFF
Return

$ON_LINVOL
Onevent BEFORE_AREA Gosub AV_LINVOL From W1WE3FTIST9
Return

$AV_LINVOL
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]LINVOU(nolign-1),GUNITE(1..GNBUNT)),1))
Endif
Gosub _AFF
Return

$ON_LINTCTRVOL
Onevent BEFORE_AREA Gosub AV_LINTCTRVOL From W1WE3FTIST9
Return

$AV_LINTCTRVOL
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]TCTRVOU,GUNITE(1..GNBUNT)),1))
Endif
Gosub _AFF
Return

$ON_LINVOU
Return

$ON_UPDPSDFLG
Onevent INIT_AREA Call D_UPDPSDFLG(zc) From W1WE3FTIST9
Return

Subprog D_UPDPSDFLG(VALEUR)
Variable Integer VALEUR
If varinit([M]UPDPSDFLG,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_PJT
Onevent BEFORE_INPUT Call AS_PJT(zc) From W1WE3FTIST9
Onevent CONTROL Call C_PJT(zc) From W1WE3FTIST9
Onevent AFTER_CHANGE Gosub AMM_PJT From W1WE3FTIST9
Return

Subprog IB_PJT(VALEUR)
Variable Char    VALEUR()
## Action PJTINIBUT
Call PJT_INIT_BUTTON(VALEUR,"POI1","PJT",nolign-1,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
&,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:POI1]POHFCY,""
&,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)) From TRTPJT
Gosub _AFF
End

Subprog AS_PJT(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(43841,GBOUT1) From OBJDIV
Call TEXTE(14667,GBOUT2) From OBJDIV
Call TEXTE(54273,GBOUT3) From OBJDIV
Call TEXTE(43844,GBOUT4) From OBJDIV
Call TEXTE(43868,GBOUT15) From OBJDIV
Call TEXTE(17676,GBOUT16) From OBJDIV
Call TEXTE(54274,GBOUT17) From OBJDIV
Call TEXTE(54275,GBOUT18) From OBJDIV
Call TEXTE(11781,GBOUT19) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_PJT(VALEUR)
## Action PJTBEFZON
Call PJT_BEFORE_ZONE(VALEUR,"POI1","PJT",nolign-1,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
&,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:POI1]POHFCY,""
&,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)) From TRTPJT
If mkstat=2
 [M]PJT(INDIC) = VALEUR
 Affzo PJT(INDIC) : mkstat = 2
Endif
If !mkstat
 ## Action PASLIN
 If GMODIF<>2 mkstat=2 : Endif
 If mkstat=2
  [M]PJT(INDIC) = VALEUR
  Affzo PJT(INDIC) : mkstat = 2
 Endif
 Onkey 129 Titled GBOUT1 Call B1_PJT(zc) From W1WE3FTIST9
 Onkey 130 Titled GBOUT2 Call B2_PJT(zc) From W1WE3FTIST9
 Onkey 131 Titled GBOUT3 Call B3_PJT(zc) From W1WE3FTIST9
 Onkey 132 Titled GBOUT4 Call B4_PJT(zc) From W1WE3FTIST9
 Onkey 172 Titled GBOUT15 Call B15_PJT(zc) From W1WE3FTIST9
 Onkey 173 Titled GBOUT16 Call B16_PJT(zc) From W1WE3FTIST9
 Onkey 174 Titled GBOUT17 Call B17_PJT(zc) From W1WE3FTIST9
 Onkey 175 Titled GBOUT18 Call B18_PJT(zc) From W1WE3FTIST9
 Onkey 176 Titled GBOUT19 Call B19_PJT(zc) From W1WE3FTIST9
 Onkey   2 Titled GBOUTS Call S_PJT(zc) From W1WE3FTIST9
 Onkey 144 Titled GBOUTP Call P_PJT(zc) From W1WE3FTIST9
 Onkey 146 Titled GBOUTA Call SA_PJT(zc) From W1WE3FTIST9
Endif
Gosub _AFF
End

Subprog C_PJT(VALEUR)
Variable Char    VALEUR()
## Action PJTCTL
Call PJT_CONTROL(VALEUR,"POI1","PJT",nolign-1,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
&,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:POI1]POHFCY,""
&,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)) From TRTPJT
If mkstat : GERR = 1 : GZONE = "PJT" : GZNUM = 1886 : Endif
If !mkstat
 ## Action CONTOBJN
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "CONTOBJN"
 Call S_AFF_CHAR(VALEUR,PARMSK,"CONTOBJN","CONTOBJ","") From GACTION
 GACTION = SAVACT
 If mkstat : GERR = 1 : GZONE = "PJT" : GZNUM = 1886 : Endif
Endif
Gosub _AFF
End

$AMM_PJT
Call AM_PJT(zc)
If !mkstat & GOBJET
 zoncou = "PJT" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_PJT(VALEUR)
Variable Char    VALEUR()
## Action PJTAFTMOD
Call PJT_AFTER_MODIFY(VALEUR,"POI1","PJT",nolign-1,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
&,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:POI1]POHFCY,""
&,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)) From TRTPJT
If mkstat : GERR = 1 : GZONE = "PJT" : GZNUM = 1886 : Endif
If !mkstat
 ## Action STD
 Call AM_PJT(VALEUR) From SUBPOI
 If mkstat : GERR = 1 : GZONE = "PJT" : GZNUM = 1886 : Endif
Endif
Gosub _AFF
End

Subprog S_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBUT
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBUT"
 PARMSK(1) = "POI1"
 PARMSK(2) = "PJT"
 PARMSK(3) = num$(nolign-1)
 PARMSK(4) = "6"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:POI1]POHFCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJT","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B1_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTBU1CRM
 Call PJT_BUT1_CRM(VALEUR,"POI1","PJT",nolign-1,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
& ,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:POI1]POHFCY,""
& ,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)) From TRTPJT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B2_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTBU2PRP
 Call PJT_BUT2_PRP(VALEUR,"POI1","PJT",nolign-1,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
& ,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:POI1]POHFCY,""
& ,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)) From TRTPJT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B3_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTBU3BUD
 Call PJT_BUT3_PRPBUD(VALEUR,"POI1","PJT",nolign-1,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
& ,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:POI1]POHFCY,""
& ,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)) From TRTPJT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B4_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTBU4TAC
 Call PJT_BUT4_PRPTAC(VALEUR,"POI1","PJT",nolign-1,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
& ,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:POI1]POHFCY,""
& ,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)) From TRTPJT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B15_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBCRM
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBCRM"
 PARMSK(1) = "POI1"
 PARMSK(2) = "PJT"
 PARMSK(3) = num$(nolign-1)
 PARMSK(4) = "6"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:POI1]POHFCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTCRM","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B16_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBPRP
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBPRP"
 PARMSK(1) = "POI1"
 PARMSK(2) = "PJT"
 PARMSK(3) = num$(nolign-1)
 PARMSK(4) = "6"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:POI1]POHFCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTPRP","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B17_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBBUD
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBBUD"
 PARMSK(1) = "POI1"
 PARMSK(2) = "PJT"
 PARMSK(3) = num$(nolign-1)
 PARMSK(4) = "6"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:POI1]POHFCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTBUD","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B18_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBTAC
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBTAC"
 PARMSK(1) = "POI1"
 PARMSK(2) = "PJT"
 PARMSK(3) = num$(nolign-1)
 PARMSK(4) = "6"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:POI1]POHFCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTTAC","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B19_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBBPR
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBBPR"
 PARMSK(1) = "POI1"
 PARMSK(2) = "PJT"
 PARMSK(3) = num$(nolign-1)
 PARMSK(4) = "6"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:POI1]POHFCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTBPR","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog SA_PJT(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "PIM"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_PJT(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("PIM",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_BPSNUM
Onevent CONTROL Call C_BPSNUM(zc) From W1WE3FTIST9
Onevent BEFORE_INPUT Call AS_BPSNUM(zc) From W1WE3FTIST9
Onevent AFTER_AREA Call AP_BPSNUM(zc) From W1WE3FTIST9
Onevent AFTER_CHANGE Gosub AMM_BPSNUM From W1WE3FTIST9
Return

Subprog IB_BPSNUM(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action STD
 Call IB_BPSNUM From SUBPOI
Endif
Gosub _AFF
End

Subprog AS_BPSNUM(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(454,GBOUT1) From OBJDIV
Call TEXTE(16086,GBOUT2) From OBJDIV
Call TEXTE(1515,GBOUT3) From OBJDIV
Call TEXTE(16098,GBOUT4) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_BPSNUM(VALEUR)
## Action PASLIN
If GMODIF<>2 mkstat=2 : Endif
If mkstat=2
 [M]BPSNUM(INDIC) = VALEUR
 Affzo BPSNUM(INDIC) : mkstat = 2
Endif
Onkey 129 Titled GBOUT1 Call B1_BPSNUM(zc) From W1WE3FTIST9
Onkey 130 Titled GBOUT2 Call B2_BPSNUM(zc) From W1WE3FTIST9
Onkey 131 Titled GBOUT3 Call B3_BPSNUM(zc) From W1WE3FTIST9
Onkey 132 Titled GBOUT4 Call B4_BPSNUM(zc) From W1WE3FTIST9
Onkey   2 Titled GBOUTS Call S_BPSNUM(zc) From W1WE3FTIST9
Onkey 144 Titled GBOUTP Call P_BPSNUM(zc) From W1WE3FTIST9
Onkey 146 Titled GBOUTA Call SA_BPSNUM(zc) From W1WE3FTIST9
Gosub _AFF
End

Subprog C_BPSNUM(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
If !GWEBSERV
 If !mkstat
  ## Action BPSCHOICE
  Local Char    PARMSK(250)(1..20) , SAVACT(20)
  SAVACT = GACTION : GACTION = "BPSCHOICE"
  Call S_TAB_CHAR(VALEUR,PARMSK,"BPSCHOICE","TRTSEL","") From GACTION
  GACTION = SAVACT
  If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
 Endif
Endif
If !mkstat
 ## Action %CNTOBJ
 Call CONTSEL("BPS","AB",VALEUR,"",mkstat) From CONTOBJ
 If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
 If !mkstat
  ## Action CTLBPRCPY
  Call CTLBPRCPY(VALEUR,[M:POI1]POHFCY) From CONTX3
  If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
  If !mkstat
   ## Action STD
   Call C_BPSNUM(VALEUR) From SUBPOI
   If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
  Endif
 Endif
Endif
Gosub _AFF
End

Subprog AP_BPSNUM(VALEUR)
Variable Char    VALEUR()
## Action STKINIECC
Call STKINIECC([M:POI1]ITMREF(nolign-1),"","POI1",1,2,nolign-1,2,func TRTX3FNC.VALFLD_C("[M]ECCVALMAJ(nolign-1)")
&,"ECCVALMAJ","ECCVALMIN","","",1,VALEUR) From STKACT
If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
Gosub _AFF
End

$AMM_BPSNUM
Call AM_BPSNUM(zc)
If !mkstat & GOBJET
 zoncou = "BPSNUM" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_BPSNUM(VALEUR)
Variable Char    VALEUR()
## Action PAMBPSNUM
Call AM_BPSNUM(VALEUR) From TRTACHCTL1
If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
If !mkstat
 ## Action STD
 Call AM_BPSNUM(VALEUR) From SUBPOI
 If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
 If !mkstat
  ## Action SELPUOMPOI
  Local Char    PARMSK(250)(1..20) , SAVACT(20)
  SAVACT = GACTION : GACTION = "SELPUOMPOI"
  PARMSK(1) = [M:POI1]ITMREF(nolign-1)
  PARMSK(2) = "3"
  PARMSK(3) = "4"
  PARMSK(4) = [M:POI1]UOM(nolign-1)
  Call S_LIS_CHAR(VALEUR,PARMSK,"SELPUOMPOI","TRTACHSEL1","") From GACTION
  GACTION = SAVACT
  If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
 Endif
Endif
Gosub _AFF
End

Subprog S_BPSNUM(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16)
PARMSK(1) = "BPS"
PARMSK(2) = "AB"
Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJ","SELOBJ","") From GACTION
Gosub _AFF
End

Subprog B1_BPSNUM(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELBPSITM1
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELBPSITM1"
 PARMSK(1) = [M:POI1]ITMREF(nolign-1)
 PARMSK(2) = "DOUFLG<3"
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELBPSITM1","TRTACHSEL1","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B2_BPSNUM(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELBPSITM2
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELBPSITM2"
 PARMSK(1) = [M:POI1]ITMREF(nolign-1)
 PARMSK(2) = "CTMBPSFLG=2 & DOUFLG<3"
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELBPSITM2","TRTACHSEL1","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B3_BPSNUM(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action GOBJET1
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "GOBJET1"
 Call OBJET_CHAR(VALEUR,"BPS","AB") From GOBJET
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B4_BPSNUM(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action VISUPLP2
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "VISUPLP2"
 PARMSK(1) = VALEUR
 PARMSK(2) = [M:POI1]ITMREF(nolign-1)
 Call SAISIE_CHAR(VALEUR,PARMSK,"IPLP2","TRTACHFEN1","XWIPLP2") From GSAISIE
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog SA_BPSNUM(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "BPS"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_BPSNUM(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("BPS",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$CHG_STY
Gosub CHG_STY From W3WE3FTIST9
Return

$TIT_COL
Gosub TIT_COL From W3WE3FTIST9
Return


