#<AdxTL>@(#)0.0.0.0 $Revision$
#------------------------------------------------------------------------------------#
#Action
#------------------------------------------------------------------------------------#
$ACTION
Case ACTION
  When Default
Endcase

Case GACTION
  When "YDIESEL"    : Gosub SEL_LISTE
Endcase

Return

$SEL_LISTE

#PARAM(1) - FUNCTION
#PARAM(2) - DIMENSION
#PARAM(3) - SITE
#PARAM(4) - ACCOUNT

Local Integer I
Local Char TEXTE(255)(1..2000,1..4)
Local Char TEX(255)(2000)
Local Char REQUEST(255)(10)
Local Char REQUEST2(255)(10)

I=0
TIT(1)="Dimension Value"
TIT(2)="Description"
TIT(3)="Dimension Code"
TIT(4)="Ledger"
CRITERE = "1=1"

REQUEST = "EXEC DIMACCSEL '"+FCYLIN+"','"+ACC1+"','"+PARAM(2)+"'"

For (Char YLED(50), Char YDIMTYP, Char YDIM, Char YDES(255)) From "5" Sql REQUEST As [YLNK]
  I += 1
  TEX(I)     = [F:YLNK]YDIM
  TEXTE(I,1) = [F:YLNK]YDIM
  TEXTE(I,2) = [F:YLNK]YDES
  TEXTE(I,3) = [F:YLNK]YLED
  TEXTE(I,4) = [F:YLNK]YDIMTYP
  If YDIM = "" : I = 0 : End : Endif
Next
NBTEX=I

If I = 0
  GMESSAGE = mess(6,6201,1)
  GERR = 1
  mkstat = 2
Endif

##Jose work in progress - DFCX1-234 - START
#REQUEST(0) = "SELECT t3.LED_0, t3.DIE_0, t6.CCE_0, t6.DES_0"
#REQUEST(1) -= "FROM FACILITY t0"
#REQUEST(2) -= "JOIN COMPANY t1 ON t0.LEGCPY_0 = t1.CPY_0"
#REQUEST(3) -= "JOIN GACM t2 ON t1.ACM_0 = t2.GCM_0"
#REQUEST(4) -= "JOIN GLED t3 ON t2.LED_0 = t3.LED_0"
#REQUEST(5) -= "JOIN GCOA t4 ON t3.COA_0 = t4.COA_0"
#REQUEST(6) -= "JOIN YPCCACC t5 ON t4.COA_0 = t5.YCOA_0 AND t3.LED_0 = t5.YLED_0"
#REQUEST(7) -= "JOIN CACCE t6 ON t6.DIE_0 = t5.YDIE_0 AND t6.CCE_0 = t5.YCCE_0"
#REQUEST(8) -= "WHERE t0.FCY_0 = '" + PARAM(3) + "' AND t5.YDIE_0 = '" + PARAM(2) +"' AND t5.YACC_0 = '" + PARAM(4) + "'"
#REQUEST(9) -= "ORDER BY t3.LED_0, t3.DIE_0, t6.CCE_0, t6.DES_0"
#
#For (Char YLED(50), Char YDIMTYP, Char YDIM, Char YDES(255)) From "5" Sql REQUEST As [YLNK]
#  I += 1
#  TEX(I)     = [F:YLNK]YDIM
#  TEXTE(I,1) = [F:YLNK]YDIM
#  TEXTE(I,2) = [F:YLNK]YDES
#  TEXTE(I,3) = [F:YLNK]YDIMTYP
#  TEXTE(I,4) = [F:YLNK]YLED
#Next
#NBTEX=I
#
#If I = 0
#  #No accounts specified, so return complete list
#  REQUEST2(0) = "SELECT t3.LED_0, t3.DIE_0, t6.CCE_0, t6.DES_0"
#  REQUEST2(1) -= "FROM FACILITY t0"
#  REQUEST2(2) -= "JOIN COMPANY t1 ON t0.LEGCPY_0 = t1.CPY_0"
#  REQUEST2(3) -= "JOIN GACM t2 ON t1.ACM_0 = t2.GCM_0"
#  REQUEST2(4) -= "JOIN GLED t3 ON t2.LED_0 = t3.LED_0"
#  REQUEST2(5) -= "JOIN GCOA t4 ON t3.COA_0 = t4.COA_0"
#  REQUEST2(6) -= " "
#  REQUEST2(7) -= "JOIN CACCE t6 ON t6.DIE_0 = t3.DIE_0"
#  REQUEST2(8) -= "WHERE t0.FCY_0 = '" + PARAM(3) + "' AND t3.DIE_0 = '" + PARAM(2) +"'"
#  REQUEST2(9) -= "ORDER BY t3.LED_0, t3.DIE_0, t6.CCE_0, t6.DES_0"
#
#  For (Char YLED(50), Char YDIMTYP, Char YDIM, Char YDES(255)) From "5" Sql REQUEST2 As [YLNK]
#    I += 1
#    TEX(I)     = [F:YLNK]YDIM
#    TEXTE(I,1) = [F:YLNK]YDIM
#    TEXTE(I,2) = [F:YLNK]YDES
#    TEXTE(I,3) = [F:YLNK]YDIMTYP
#    TEXTE(I,4) = [F:YLNK]YLED
#  Next
#  NBTEX=I
#
#Endif
##Jose work in progress - DFCX1-234 - END

Return

Subprog VAL_CCE(VALEUR)
Variable Char    VALEUR()
Local Integer I
Local Char TEXTE(255)(1..2000,1..4)

REQUEST = "EXEC DIMACCENT '"+FCYLIN+"','"+ACC1+"','"+PARAM(2)+"','"+VALEUR+"'"
I = 0

For (Char YDIM) From "5" Sql REQUEST As [YLNK]
  I += 1
  TEXTE(I,1) = [F:YLNK]YDIM
  If YDIM = "" : I = 0 : End : Endif
Next
NBTEX=I

If I = 0
  GMESSAGE = mess(6,6201,1)
  GERR = 1
  mkstat = 2
Endif

End

