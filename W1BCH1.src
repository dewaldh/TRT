#<AdxTL>@(#)0.0.0.0 $Revision$
# Supervisor
# Mask management BCH1 

$_AFF
If GIMPORT
 Gosub AFF From GSAISIE
Else
 If GMESSAGE <>""
  Gosub ERR From GSAISIE
 Else
  Raz GERR , GZNUM
 Endif
Endif
Return

$HORODAT
Local Date    A_DATE
Local Char    A_HEURE(10) , A_USER(10)
Local Char    A_STAMP(15)
A_DATE  = [27/08/2018]
A_HEURE = "23:51:59"
A_USER  = "ADMIN"
A_STAMP = "20180827235159"
Return

$TITRES
Return

$CHG_FMT
Case zoncou
 When "NBCRI"
  If [M]NBCRI=0
  Endif
 When "NBTYPF"
  If [M]NBTYPF=0
  Endif
 When "NBTYPC"
  If [M]NBTYPC=0
  Endif
 When "NBCOR"
  If [M]NBCOR=0
  Endif
Endcase
Return

$VISU
Local Integer A_REPONSE
Global Integer GPRE_VIEW
If dim(A_WINDPREV)<=0 : Local Char A_WINDPREV(30) : Endif
Local Mask BCH1 [BCH1]
Gosub HORODAT
Local Inpbox "BCH1" From GFONCTION At A_STAMP With A_WINDPREV Mask [BCH1] As [SIM_]
Grizo [BCH1]5
Grizo [BCH1]20
Grizo [BCH1]25
Grizo [BCH1]10
Grizo [BCH1]15
Boxact [SIM_]
Gosub TITRES
Boxinp [SIM_] Using A_REPONSE
Close Local Inpbox [SIM_]
Close Local Mask [BCH1]
Kill GPRE_VIEW
Return

$HARDCOP
Local Integer X1(0..14),X2(0..14),Y1(0..14),Y2(0..14)
X1(0)=1 : X2(0)=112 : Y1(0)=1 : Y2(0)=13
X1(1)=57 : X2(1)=112 : Y1(1)=14 : Y2(1)=19
X1(2)=57 : X2(2)=112 : Y1(2)=20 : Y2(2)=28
X1(4)=1 : X2(4)=56 : Y1(4)=14 : Y2(4)=25
X1(5)=1 : X2(5)=56 : Y1(5)=26 : Y2(5)=28
Return

$ON_NBCRI
Onevent AFTER_LINE Call APRES_NBCRI From W1BCH1
Return

Subprog APRES_NBCRI
Local Decimal BASPAG
## Action STD
Call APRES_NBCRI From FUNBCH
If mkstat : End : Endif
Gosub _AFF
End

$ON_TYPBET
Onevent AFTER_CHANGE Gosub AMM_TYPBET From W1BCH1
Onevent INIT_AREA Call D_TYPBET(zc) From W1BCH1
Onevent BEFORE_INPUT Call AS_TYPBET(zc) From W1BCH1
Return

Subprog D_TYPBET(VALEUR)
Variable Integer VALEUR
If varinit([M]TYPBET,indice)=0
 VALEUR = 2
Endif
Gosub _AFF
End

Subprog AS_TYPBET(VALEUR)
Variable Integer VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
If VALEUR<1
 VALEUR = 1
Endif
Gosub _AFF
End

$AMM_TYPBET
Call AM_TYPBET(zc)
If !mkstat & GOBJET
 zoncou = "TYPBET" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_TYPBET(VALEUR)
Variable Integer VALEUR
## Action STD
Call AM_TYPBET(VALEUR) From FUNBCH
If mkstat : GERR = 1 : GZONE = "TYPBET" : GZNUM = 680 : Endif
Gosub _AFF
End

$ON_GRPCPYORI
Onevent BEFORE_INPUT Call AS_GRPCPYORI(zc) From W1BCH1
Onevent CONTROL Call C_GRPCPYORI(zc) From W1BCH1
Onevent AFTER_CHANGE Gosub AMM_GRPCPYORI From W1BCH1
Return

Subprog IB_GRPCPYORI(VALEUR)
Variable Char    VALEUR()
## Action STD
Call IB_GRPCPYORI From FUNBCH
Gosub _AFF
End

Subprog AS_GRPCPYORI(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(8582,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_GRPCPYORI(VALEUR)
## Action STD
Call AS_GRPCPYORI(VALEUR) From FUNBCH
If mkstat=2
 [M]GRPCPYORI(INDIC) = VALEUR
 Affzo GRPCPYORI(INDIC) : mkstat = 2
Endif
Onkey 129 Titled GBOUT1 Call B1_GRPCPYORI(zc) From W1BCH1
Onkey   2 Titled GBOUTS Call S_GRPCPYORI(zc) From W1BCH1
Onkey 144 Titled GBOUTP Call P_GRPCPYORI(zc) From W1BCH1
Onkey 146 Titled GBOUTA Call SA_GRPCPYORI(zc) From W1BCH1
Gosub _AFF
End

Subprog C_GRPCPYORI(VALEUR)
Variable Char    VALEUR()
## Action %CNTOBJ
Call CONTSEL("AGF","!A",VALEUR,"",mkstat) From CONTOBJ
If mkstat : GERR = 1 : GZONE = "GRPCPYORI" : GZNUM = 29844 : Endif
If !mkstat
 ## Action STD
 Call C_GRPCPYORI(VALEUR) From FUNBCH
 If mkstat : GERR = 1 : GZONE = "GRPCPYORI" : GZNUM = 29844 : Endif
Endif
Gosub _AFF
End

$AMM_GRPCPYORI
Call AM_GRPCPYORI(zc)
If !mkstat & GOBJET
 zoncou = "GRPCPYORI" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_GRPCPYORI(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_GRPCPYORI(VALEUR) From FUNBCH
If mkstat : GERR = 1 : GZONE = "GRPCPYORI" : GZNUM = 29844 : Endif
Gosub _AFF
End

Subprog S_GRPCPYORI(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELOBJCRI1
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELOBJCRI1"
 PARMSK(1) = "AGF"
 PARMSK(2) = ""
 PARMSK(3) = ""
 PARMSK(4) = [M]FILTRE_AGF
 PARMSK(5) = ""
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJCRIT","TRTX3","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B1_GRPCPYORI(VALEUR)
Variable Char    VALEUR()
Call OBJET("AGF",VALEUR,"") From GOBJET
Gosub _AFF
End

Subprog SA_GRPCPYORI(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "AGF"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_GRPCPYORI(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("AGF",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_GRPFCYORI
Onevent BEFORE_INPUT Call AS_GRPFCYORI(zc) From W1BCH1
Onevent CONTROL Call C_GRPFCYORI(zc) From W1BCH1
Return

Subprog IB_GRPFCYORI(VALEUR)
Variable Char    VALEUR()
## Action STD
Call IB_GRPFCYORI From FUNBCH
Gosub _AFF
End

Subprog AS_GRPFCYORI(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(16745,GBOUT2) From OBJDIV
Call TEXTE(28103,GBOUT3) From OBJDIV
Call TEXTE(1427,GBOUT4) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call IB_GRPFCYORI(VALEUR)
## Action STD
Call AS_GRPFCYORI(VALEUR) From FUNBCH
If mkstat=2
 [M]GRPFCYORI(INDIC) = VALEUR
 Affzo GRPFCYORI(INDIC) : mkstat = 2
Endif
Onkey 130 Titled GBOUT2 Call B2_GRPFCYORI(zc) From W1BCH1
Onkey 131 Titled GBOUT3 Call B3_GRPFCYORI(zc) From W1BCH1
Onkey 132 Titled GBOUT4 Call B4_GRPFCYORI(zc) From W1BCH1
Onkey   2 Titled GBOUTS Call S_GRPFCYORI(zc) From W1BCH1
Gosub _AFF
End

Subprog C_GRPFCYORI(VALEUR)
Variable Char    VALEUR()
## Action STD
Call C_GRPFCYORI(VALEUR) From FUNBCH
If mkstat : GERR = 1 : GZONE = "GRPFCYORI" : GZNUM = 29870 : Endif
Gosub _AFF
End

Subprog S_GRPFCYORI(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELOBJCRI1
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELOBJCRI1"
 PARMSK(1) = "AGF"
 PARMSK(2) = ""
 PARMSK(3) = ""
 PARMSK(4) = [M]FILTRE_AGF
 PARMSK(5) = ""
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJCRIT","TRTX3","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B2_GRPFCYORI(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELGRPFCY
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELGRPFCY"
 PARMSK(1) = [M]FILTRE_CPY
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELGRPFCY","TRTVENSEL","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B3_GRPFCYORI(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action GOBJET1
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "GOBJET1"
 Call OBJET_CHAR(VALEUR,"AGF","") From GOBJET
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B4_GRPFCYORI(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELFCY
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELFCY"
 PARMSK(1) = [M]FILTRE_CPY
 PARMSK(2) = ""
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELFCY","SUBFCY","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

$ON_VCRTYP
Onevent BEFORE_INPUT Call AS_VCRTYP(zc) From W1BCH1
Onevent CONTROL Call C_VCRTYP(zc) From W1BCH1
Onevent AFTER_AREA Call AP_VCRTYP(zc) From W1BCH1
Onevent INIT_AREA Call D_VCRTYP(zc) From W1BCH1
Return

Subprog D_VCRTYP(VALEUR)
Variable Integer VALEUR
If varinit([M]VCRTYP,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

Subprog AS_VCRTYP(VALEUR)
Variable Integer VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
Call INICOMBO(701) From COMBOS
## Action STD
Call AS_VCRTYP(VALEUR) From FUNBCH
If mkstat=2
 [M]VCRTYP(INDIC) = VALEUR
 Affzo VCRTYP(INDIC) : mkstat = 2
Endif
If VALEUR<1 | GMENLOC(VALEUR)=1
 VALEUR = find(0,GMENLOC(1..len(mess(0,701,1))))
Endif
If !mkstat
 Discombo 0 From VCRTYP(INDIC)
 If sum(GMENLOC)<>0
  Gosub COMBOS From COMBOS
  For WI=1 to WN : Discombo WCOMBO(WI) From VCRTYP(INDIC) : Next WI
 Endif
Endif
Gosub _AFF
End

Subprog C_VCRTYP(VALEUR)
Variable Integer VALEUR
If VALEUR>0 & VALEUR<dim(GMENLOC) & GMENLOC(VALEUR)<>0
 mkstat = 1 : End
Endif
## Action STD
Call C_VCRTYP(VALEUR) From FUNBCH
If mkstat : GERR = 1 : GZONE = "VCRTYP" : GZNUM = 5169 : Endif
Gosub _AFF
End

Subprog AP_VCRTYP(VALEUR)
Variable Integer VALEUR
## Action STD
Call AP_VCRTYP(VALEUR) From FUNBCH
If mkstat : GERR = 1 : GZONE = "VCRTYP" : GZNUM = 5169 : Endif
Gosub _AFF
End

$ON_GRPCPYDES
Onevent BEFORE_INPUT Call AS_GRPCPYDES(zc) From W1BCH1
Onevent CONTROL Call C_GRPCPYDES(zc) From W1BCH1
Return

Subprog IB_GRPCPYDES(VALEUR)
Variable Char    VALEUR()
## Action STD
Call IB_GRPCPYDES From FUNBCH
Gosub _AFF
End

Subprog AS_GRPCPYDES(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(8582,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_GRPCPYDES(VALEUR)
## Action STD
Call AS_GRPCPYDES(VALEUR) From FUNBCH
If mkstat=2
 [M]GRPCPYDES(INDIC) = VALEUR
 Affzo GRPCPYDES(INDIC) : mkstat = 2
Endif
Onkey 129 Titled GBOUT1 Call B1_GRPCPYDES(zc) From W1BCH1
Onkey   2 Titled GBOUTS Call S_GRPCPYDES(zc) From W1BCH1
Onkey 144 Titled GBOUTP Call P_GRPCPYDES(zc) From W1BCH1
Onkey 146 Titled GBOUTA Call SA_GRPCPYDES(zc) From W1BCH1
Gosub _AFF
End

Subprog C_GRPCPYDES(VALEUR)
Variable Char    VALEUR()
## Action %CNTOBJ
Call CONTSEL("AGF","!A",VALEUR,"",mkstat) From CONTOBJ
If mkstat : GERR = 1 : GZONE = "GRPCPYDES" : GZNUM = 53201 : Endif
If !mkstat
 ## Action STD
 Call C_GRPCPYDES(VALEUR) From FUNBCH
 If mkstat : GERR = 1 : GZONE = "GRPCPYDES" : GZNUM = 53201 : Endif
Endif
Gosub _AFF
End

Subprog S_GRPCPYDES(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELOBJCRI1
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELOBJCRI1"
 PARMSK(1) = "AGF"
 PARMSK(2) = ""
 PARMSK(3) = ""
 PARMSK(4) = [M]FILTRE_AGF
 PARMSK(5) = ""
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJCRIT","TRTX3","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B1_GRPCPYDES(VALEUR)
Variable Char    VALEUR()
Call OBJET("AGF",VALEUR,"") From GOBJET
Gosub _AFF
End

Subprog SA_GRPCPYDES(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "AGF"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_GRPCPYDES(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("AGF",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_GRPFCYDES
Onevent BEFORE_INPUT Call AS_GRPFCYDES(zc) From W1BCH1
Onevent CONTROL Call C_GRPFCYDES(zc) From W1BCH1
Return

Subprog IB_GRPFCYDES(VALEUR)
Variable Char    VALEUR()
## Action STD
Call IB_GRPFCYDES From FUNBCH
Gosub _AFF
End

Subprog AS_GRPFCYDES(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(16745,GBOUT2) From OBJDIV
Call TEXTE(28103,GBOUT3) From OBJDIV
Call TEXTE(1427,GBOUT4) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call IB_GRPFCYDES(VALEUR)
## Action STD
Call AS_GRPFCYDES(VALEUR) From FUNBCH
If mkstat=2
 [M]GRPFCYDES(INDIC) = VALEUR
 Affzo GRPFCYDES(INDIC) : mkstat = 2
Endif
Onkey 130 Titled GBOUT2 Call B2_GRPFCYDES(zc) From W1BCH1
Onkey 131 Titled GBOUT3 Call B3_GRPFCYDES(zc) From W1BCH1
Onkey 132 Titled GBOUT4 Call B4_GRPFCYDES(zc) From W1BCH1
Onkey   2 Titled GBOUTS Call S_GRPFCYDES(zc) From W1BCH1
Gosub _AFF
End

Subprog C_GRPFCYDES(VALEUR)
Variable Char    VALEUR()
## Action STD
Call C_GRPFCYDES(VALEUR) From FUNBCH
If mkstat : GERR = 1 : GZONE = "GRPFCYDES" : GZNUM = 53202 : Endif
Gosub _AFF
End

Subprog S_GRPFCYDES(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELOBJCRI1
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELOBJCRI1"
 PARMSK(1) = "AGF"
 PARMSK(2) = ""
 PARMSK(3) = ""
 PARMSK(4) = [M]FILTRE_AGF
 PARMSK(5) = ""
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJCRIT","TRTX3","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B2_GRPFCYDES(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELGRPFCY
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELGRPFCY"
 PARMSK(1) = [M]FILTRE_CPY
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELGRPFCY","TRTVENSEL","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B3_GRPFCYDES(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action GOBJET1
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "GOBJET1"
 Call OBJET_CHAR(VALEUR,"AGF","") From GOBJET
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B4_GRPFCYDES(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELFCY
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELFCY"
 PARMSK(1) = [M]FILTRE_CPY
 PARMSK(2) = ""
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELFCY","SUBFCY","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

$ON_VCRTYPDES
Onevent INIT_AREA Call D_VCRTYPDES(zc) From W1BCH1
Return

Subprog D_VCRTYPDES(VALEUR)
Variable Integer VALEUR
If varinit([M]VCRTYPDES,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_AUZBETFLG
Onevent CONTROL Call C_AUZBETFLG(zc) From W1BCH1
Onevent INIT_AREA Call D_AUZBETFLG(zc) From W1BCH1
Onevent BEFORE_INPUT Call AS_AUZBETFLG(zc) From W1BCH1
Return

Subprog D_AUZBETFLG(VALEUR)
Variable Integer VALEUR
If varinit([M]AUZBETFLG,indice)=0
 VALEUR = 2
Endif
Gosub _AFF
End

Subprog AS_AUZBETFLG(VALEUR)
Variable Integer VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
If VALEUR<1
 VALEUR = 1
Endif
Gosub _AFF
End

Subprog C_AUZBETFLG(VALEUR)
Variable Integer VALEUR
## Action %OBLIG
If VALEUR=0
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "AUZBETFLG" : GZNUM = 4672 : Endif
If !mkstat
 ## Action STD
 Call C_AUZBETFLG(VALEUR) From FUNBCH
 If mkstat : GERR = 1 : GZONE = "AUZBETFLG" : GZNUM = 4672 : Endif
Endif
Gosub _AFF
End

$ON_TRFPRI
Onevent INIT_AREA Call D_TRFPRI(zc) From W1BCH1
Onevent BEFORE_INPUT Call AS_TRFPRI(zc) From W1BCH1
Return

Subprog D_TRFPRI(VALEUR)
Variable Integer VALEUR
If varinit([M]TRFPRI,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

Subprog AS_TRFPRI(VALEUR)
Variable Integer VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
If VALEUR<1
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_VLTFOOINV
Onevent BEFORE_INPUT Call AS_VLTFOOINV(zc) From W1BCH1
Onevent INIT_AREA Call D_VLTFOOINV(zc) From W1BCH1
Onevent CONTROL Call C_VLTFOOINV(zc) From W1BCH1
Return

Subprog D_VLTFOOINV(VALEUR)
Variable Integer VALEUR
If varinit([M]VLTFOOINV,indice)=0
 VALEUR = 2
Endif
Gosub _AFF
End

Subprog AS_VLTFOOINV(VALEUR)
Variable Integer VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
Call INICOMBO(298) From COMBOS
## Action STD
Call AS_VLTFOOINV(VALEUR) From FUNBCH
If mkstat=2
 [M]VLTFOOINV(INDIC) = VALEUR
 Affzo VLTFOOINV(INDIC) : mkstat = 2
Endif
If VALEUR<1 | GMENLOC(VALEUR)=1
 VALEUR = find(0,GMENLOC(1..len(mess(0,298,1))))
Endif
If !mkstat
 Discombo 0 From VLTFOOINV(INDIC)
 If sum(GMENLOC)<>0
  Gosub COMBOS From COMBOS
  For WI=1 to WN : Discombo WCOMBO(WI) From VLTFOOINV(INDIC) : Next WI
 Endif
Endif
Gosub _AFF
End

Subprog C_VLTFOOINV(VALEUR)
Variable Integer VALEUR
If VALEUR>0 & VALEUR<dim(GMENLOC) & GMENLOC(VALEUR)<>0
 mkstat = 1 : End
Endif
Gosub _AFF
End

$ON_NBTYPF
Onevent AFTER_LINE Call APRES_NBTYPF From W1BCH1
Return

Subprog APRES_NBTYPF
Local Decimal BASPAG
## Action STD
Call APRES_NBTYPF From FUNBCH
If mkstat : End : Endif
Gosub _AFF
End

$ON_GRPCPYTSV
Onevent BEFORE_INPUT Call AS_GRPCPYTSV(zc) From W1BCH1
Onevent CONTROL Call C_GRPCPYTSV(zc) From W1BCH1
Onevent AFTER_CHANGE Gosub AMM_GRPCPYTSV From W1BCH1
Return

Subprog IB_GRPCPYTSV(VALEUR)
Variable Char    VALEUR()
## Action STD
Call IB_GRPCPYTSV From FUNBCH
Gosub _AFF
End

Subprog AS_GRPCPYTSV(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(8582,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_GRPCPYTSV(VALEUR)
## Action STD
Call AS_GRPCPYTSV(VALEUR) From FUNBCH
If mkstat=2
 [M]GRPCPYTSV(INDIC) = VALEUR
 Affzo GRPCPYTSV(INDIC) : mkstat = 2
Endif
Onkey 129 Titled GBOUT1 Call B1_GRPCPYTSV(zc) From W1BCH1
Onkey   2 Titled GBOUTS Call S_GRPCPYTSV(zc) From W1BCH1
Onkey 144 Titled GBOUTP Call P_GRPCPYTSV(zc) From W1BCH1
Onkey 146 Titled GBOUTA Call SA_GRPCPYTSV(zc) From W1BCH1
Gosub _AFF
End

Subprog C_GRPCPYTSV(VALEUR)
Variable Char    VALEUR()
## Action %CNTOBJ
Call CONTSEL("AGF","!C",VALEUR,"",mkstat) From CONTOBJ
If mkstat : GERR = 1 : GZONE = "GRPCPYTSV" : GZNUM = 53203 : Endif
If !mkstat
 ## Action STD
 Call C_GRPCPYTSV(VALEUR) From FUNBCH
 If mkstat : GERR = 1 : GZONE = "GRPCPYTSV" : GZNUM = 53203 : Endif
Endif
Gosub _AFF
End

$AMM_GRPCPYTSV
Call AM_GRPCPYTSV(zc)
If !mkstat & GOBJET
 zoncou = "GRPCPYTSV" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_GRPCPYTSV(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_GRPCPYTSV(VALEUR) From FUNBCH
If mkstat : GERR = 1 : GZONE = "GRPCPYTSV" : GZNUM = 53203 : Endif
Gosub _AFF
End

Subprog S_GRPCPYTSV(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELOBJCRI1
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELOBJCRI1"
 PARMSK(1) = "AGF"
 PARMSK(2) = ""
 PARMSK(3) = ""
 PARMSK(4) = [M]FILTRE_AGF
 PARMSK(5) = ""
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJCRIT","TRTX3","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B1_GRPCPYTSV(VALEUR)
Variable Char    VALEUR()
Call OBJET("AGF",VALEUR,"") From GOBJET
Gosub _AFF
End

Subprog SA_GRPCPYTSV(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "AGF"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_GRPCPYTSV(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("AGF",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_LEGGRPTSV
Onevent INIT_AREA Call D_LEGGRPTSV(zc) From W1BCH1
Return

Subprog D_LEGGRPTSV(VALEUR)
Variable Char    VALEUR()
If varinit([M]LEGGRPTSV,indice)=0
 ## Action INILEG
 Call INILEG(VALEUR,"909","") From SUBADI
Endif
Gosub _AFF
End

$ON_SIVTYP
Onevent CONTROL Call C_SIVTYP(zc) From W1BCH1
Onevent BEFORE_AREA Gosub AV_SIVTYP From W1BCH1
Onevent AFTER_CHANGE Gosub AMM_SIVTYP From W1BCH1
Onevent BEFORE_INPUT Call AS_SIVTYP(zc) From W1BCH1
Return

Subprog IB_SIVTYP(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action IBTUNLEG
 Call IBTUNLEG("") From TRTVENCTL
Endif
Gosub _AFF
End

$AV_SIVTYP
## Action STD
Call AV_SIVTYP(zc) From FUNBCH
Gosub _AFF
Return

Subprog AS_SIVTYP(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(13024,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_SIVTYP(VALEUR)
Onkey 129 Titled GBOUT1 Call B1_SIVTYP(zc) From W1BCH1
Onkey   2 Titled GBOUTS Call S_SIVTYP(zc) From W1BCH1
Onkey 144 Titled GBOUTP Call P_SIVTYP(zc) From W1BCH1
Onkey 146 Titled GBOUTA Call SA_SIVTYP(zc) From W1BCH1
Gosub _AFF
End

Subprog C_SIVTYP(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "SIVTYP" : GZNUM = 3821 : Endif
If !mkstat
 ## Action CONTTSV
 Call CONTTSV(VALEUR,[M:BCH1]LEGGRPTSV(nolign-1),"BCH1","SIVTYP","",[M:BCH1]GRPCPYTSV(nolign-1),"") From SUBTSV
 If mkstat : GERR = 1 : GZONE = "SIVTYP" : GZNUM = 3821 : Endif
 If !mkstat
  ## Action CONTOBJN
  Local Char    PARMSK(250)(1..20) , SAVACT(20)
  SAVACT = GACTION : GACTION = "CONTOBJN"
  Call S_AFF_CHAR(VALEUR,PARMSK,"CONTOBJN","CONTOBJ","") From GACTION
  GACTION = SAVACT
  If mkstat : GERR = 1 : GZONE = "SIVTYP" : GZNUM = 3821 : Endif
  If !mkstat
   ## Action STD
   Call C_SIVTYP(VALEUR) From FUNBCH
   If mkstat : GERR = 1 : GZONE = "SIVTYP" : GZNUM = 3821 : Endif
  Endif
 Endif
Endif
Gosub _AFF
End

$AMM_SIVTYP
Call AM_SIVTYP(zc)
If !mkstat & GOBJET
 zoncou = "SIVTYP" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_SIVTYP(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_SIVTYP(VALEUR) From FUNBCH
If mkstat : GERR = 1 : GZONE = "SIVTYP" : GZNUM = 3821 : Endif
If !mkstat & evalue("dim("+clanam([M])+"ZSIVTYP)")>indice
 [M]SIVTYP(indice) = VALEUR
 Affzo ZSIVTYP(indice)
Endif
Gosub _AFF
End

Subprog S_SIVTYP(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELTSVLEG
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELTSVLEG"
 PARMSK(1) = [M:BCH1]LEGGRPTSV(nolign-1)
 PARMSK(2) = ""
 PARMSK(3) = ""
 PARMSK(4) = [M:BCH1]GRPCPYTSV(nolign-1)
 PARMSK(5) = ""
 PARMSK(6) = "BCH1"
 PARMSK(7) = "SIVTYP"
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELTSV","SUBTSV","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B1_SIVTYP(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action TUNTSV
 Call TUNTSV(VALEUR,[M:BCH1]LEGGRPTSV(nolign-1)) From SUBTSV
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog SA_SIVTYP(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "TSV"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_SIVTYP(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("TSV",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZSIVTYP
Onevent BEFORE_AREA Gosub AV_ZSIVTYP From W1BCH1
Return

$AV_ZSIVTYP
Call LECTEXTRA(zc,"TABSIVTYP","SHOAXX",num$([M]SIVTYP(indice)),"") From ATEXTRA
Gosub _AFF
Return

$ON_GRPCPYTPV
Onevent BEFORE_INPUT Call AS_GRPCPYTPV(zc) From W1BCH1
Onevent CONTROL Call C_GRPCPYTPV(zc) From W1BCH1
Onevent AFTER_CHANGE Gosub AMM_GRPCPYTPV From W1BCH1
Return

Subprog IB_GRPCPYTPV(VALEUR)
Variable Char    VALEUR()
## Action STD
Call IB_GRPCPYTPV From FUNBCH
Gosub _AFF
End

Subprog AS_GRPCPYTPV(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(8582,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_GRPCPYTPV(VALEUR)
## Action STD
Call AS_GRPCPYTPV(VALEUR) From FUNBCH
If mkstat=2
 [M]GRPCPYTPV(INDIC) = VALEUR
 Affzo GRPCPYTPV(INDIC) : mkstat = 2
Endif
Onkey 129 Titled GBOUT1 Call B1_GRPCPYTPV(zc) From W1BCH1
Onkey   2 Titled GBOUTS Call S_GRPCPYTPV(zc) From W1BCH1
Onkey 144 Titled GBOUTP Call P_GRPCPYTPV(zc) From W1BCH1
Onkey 146 Titled GBOUTA Call SA_GRPCPYTPV(zc) From W1BCH1
Gosub _AFF
End

Subprog C_GRPCPYTPV(VALEUR)
Variable Char    VALEUR()
## Action %CNTOBJ
Call CONTSEL("AGF","!C",VALEUR,"",mkstat) From CONTOBJ
If mkstat : GERR = 1 : GZONE = "GRPCPYTPV" : GZNUM = 53204 : Endif
If !mkstat
 ## Action STD
 Call C_GRPCPYTPV(VALEUR) From FUNBCH
 If mkstat : GERR = 1 : GZONE = "GRPCPYTPV" : GZNUM = 53204 : Endif
Endif
Gosub _AFF
End

$AMM_GRPCPYTPV
Call AM_GRPCPYTPV(zc)
If !mkstat & GOBJET
 zoncou = "GRPCPYTPV" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_GRPCPYTPV(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_GRPCPYTPV(VALEUR) From FUNBCH
If mkstat : GERR = 1 : GZONE = "GRPCPYTPV" : GZNUM = 53204 : Endif
Gosub _AFF
End

Subprog S_GRPCPYTPV(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELOBJCRI1
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELOBJCRI1"
 PARMSK(1) = "AGF"
 PARMSK(2) = ""
 PARMSK(3) = ""
 PARMSK(4) = [M]FILTRE_AGF
 PARMSK(5) = ""
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJCRIT","TRTX3","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B1_GRPCPYTPV(VALEUR)
Variable Char    VALEUR()
Call OBJET("AGF",VALEUR,"") From GOBJET
Gosub _AFF
End

Subprog SA_GRPCPYTPV(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "AGF"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_GRPCPYTPV(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("AGF",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_LEGGRPTPV
Onevent INIT_AREA Call D_LEGGRPTPV(zc) From W1BCH1
Return

Subprog D_LEGGRPTPV(VALEUR)
Variable Char    VALEUR()
If varinit([M]LEGGRPTPV,indice)=0
 ## Action INILEG
 Call INILEG(VALEUR,"909","") From SUBADI
Endif
Gosub _AFF
End

$ON_PIVTYP
Onevent CONTROL Call C_PIVTYP(zc) From W1BCH1
Onevent BEFORE_AREA Gosub AV_PIVTYP From W1BCH1
Onevent BEFORE_INPUT Call AS_PIVTYP(zc) From W1BCH1
Onevent AFTER_CHANGE Gosub AMM_PIVTYP From W1BCH1
Return

Subprog IB_PIVTYP(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action IBTUNLEG
 Call IBTUNLEG("") From TRTVENCTL
Endif
Gosub _AFF
End

$AV_PIVTYP
## Action STD
Call AV_PIVTYP(zc) From FUNBCH
Gosub _AFF
Return

Subprog AS_PIVTYP(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(44071,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_PIVTYP(VALEUR)
## Action STD
Call AS_PIVTYP(VALEUR) From FUNBCH
If mkstat=2
 [M]PIVTYP(INDIC) = VALEUR
 Affzo PIVTYP(INDIC) : mkstat = 2
Endif
Onkey 129 Titled GBOUT1 Call B1_PIVTYP(zc) From W1BCH1
Onkey   2 Titled GBOUTS Call S_PIVTYP(zc) From W1BCH1
Onkey 144 Titled GBOUTP Call P_PIVTYP(zc) From W1BCH1
Onkey 146 Titled GBOUTA Call SA_PIVTYP(zc) From W1BCH1
Gosub _AFF
End

Subprog C_PIVTYP(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "PIVTYP" : GZNUM = 3820 : Endif
If !mkstat
 ## Action CONTTPV
 Call CONTTPV(VALEUR,[M:BCH1]LEGGRPTPV(nolign-1),"BCH1","PIVTYP","",[M:BCH1]GRPCPYTPV(nolign-1),"") From SUBTPV
 If mkstat : GERR = 1 : GZONE = "PIVTYP" : GZNUM = 3820 : Endif
 If !mkstat
  ## Action CONTOBJN
  Local Char    PARMSK(250)(1..20) , SAVACT(20)
  SAVACT = GACTION : GACTION = "CONTOBJN"
  Call S_AFF_CHAR(VALEUR,PARMSK,"CONTOBJN","CONTOBJ","") From GACTION
  GACTION = SAVACT
  If mkstat : GERR = 1 : GZONE = "PIVTYP" : GZNUM = 3820 : Endif
  If !mkstat
   ## Action STD
   Call C_PIVTYP(VALEUR) From FUNBCH
   If mkstat : GERR = 1 : GZONE = "PIVTYP" : GZNUM = 3820 : Endif
  Endif
 Endif
Endif
Gosub _AFF
End

$AMM_PIVTYP
Call AM_PIVTYP(zc)
If !mkstat & GOBJET
 zoncou = "PIVTYP" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_PIVTYP(VALEUR)
Variable Char    VALEUR()
If !mkstat & evalue("dim("+clanam([M])+"ZPIVTYP)")>indice
 [M]PIVTYP(indice) = VALEUR
 Affzo ZPIVTYP(indice)
Endif
Gosub _AFF
End

Subprog S_PIVTYP(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELTPVLEG
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELTPVLEG"
 PARMSK(1) = [M:BCH1]LEGGRPTPV(nolign-1)
 PARMSK(2) = ""
 PARMSK(3) = [M:BCH1]GRPCPYTPV(nolign-1)
 PARMSK(4) = ""
 PARMSK(5) = ""
 PARMSK(6) = "BCH1"
 PARMSK(7) = "PIVTYP"
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELTPVLEG","SUBTPV","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B1_PIVTYP(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action TUNTPV
 Call TUNTPV(VALEUR,[M:BCH1]LEGGRPTPV(nolign-1)) From SUBTPV
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog SA_PIVTYP(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "TPV"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_PIVTYP(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("TPV",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZPIVTYP
Onevent BEFORE_AREA Gosub AV_ZPIVTYP From W1BCH1
Return

$AV_ZPIVTYP
Call LECTEXTRA(zc,"TABPIVTYP","SHOAXX",num$([M]PIVTYP(indice)),"") From ATEXTRA
Gosub _AFF
Return

$ON_NBTYPC
Onevent AFTER_LINE Call APRES_NBTYPC From W1BCH1
Return

Subprog APRES_NBTYPC
Local Decimal BASPAG
## Action STD
Call APRES_NBTYPC From FUNBCH
If mkstat : End : Endif
Gosub _AFF
End

$ON_SOHCAT
Onevent BEFORE_INPUT Call AS_SOHCAT(zc) From W1BCH1
Onevent AFTER_AREA Call AP_SOHCAT(zc) From W1BCH1
Onevent INIT_AREA Call D_SOHCAT(zc) From W1BCH1
Onevent CONTROL Call C_SOHCAT(zc) From W1BCH1
Return

Subprog D_SOHCAT(VALEUR)
Variable Integer VALEUR
If varinit([M]SOHCAT,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

Subprog AS_SOHCAT(VALEUR)
Variable Integer VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
Call INICOMBO(412) From COMBOS
## Action STD
Call AS_SOHCAT(VALEUR) From FUNBCH
If mkstat=2
 [M]SOHCAT(INDIC) = VALEUR
 Affzo SOHCAT(INDIC) : mkstat = 2
Endif
If VALEUR<1 | GMENLOC(VALEUR)=1
 VALEUR = find(0,GMENLOC(1..len(mess(0,412,1))))
Endif
If !mkstat
 Discombo 0 From SOHCAT(INDIC)
 If sum(GMENLOC)<>0
  Gosub COMBOS From COMBOS
  For WI=1 to WN : Discombo WCOMBO(WI) From SOHCAT(INDIC) : Next WI
 Endif
Endif
Gosub _AFF
End

Subprog C_SOHCAT(VALEUR)
Variable Integer VALEUR
## Action %OBLIG
If VALEUR=0
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "SOHCAT" : GZNUM = 707 : Endif
If VALEUR>0 & VALEUR<dim(GMENLOC) & GMENLOC(VALEUR)<>0
 mkstat = 1 : End
Endif
Gosub _AFF
End

Subprog AP_SOHCAT(VALEUR)
Variable Integer VALEUR
## Action STD
Call AP_SOHCAT(VALEUR) From FUNBCH
If mkstat : GERR = 1 : GZONE = "SOHCAT" : GZNUM = 707 : Endif
Gosub _AFF
End

$ON_GRPCPYTSO
Onevent BEFORE_INPUT Call AS_GRPCPYTSO(zc) From W1BCH1
Onevent CONTROL Call C_GRPCPYTSO(zc) From W1BCH1
Onevent AFTER_CHANGE Gosub AMM_GRPCPYTSO From W1BCH1
Return

Subprog IB_GRPCPYTSO(VALEUR)
Variable Char    VALEUR()
## Action STD
Call IB_GRPCPYTSO From FUNBCH
Gosub _AFF
End

Subprog AS_GRPCPYTSO(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(8582,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_GRPCPYTSO(VALEUR)
## Action STD
Call AS_GRPCPYTSO(VALEUR) From FUNBCH
If mkstat=2
 [M]GRPCPYTSO(INDIC) = VALEUR
 Affzo GRPCPYTSO(INDIC) : mkstat = 2
Endif
Onkey 129 Titled GBOUT1 Call B1_GRPCPYTSO(zc) From W1BCH1
Onkey   2 Titled GBOUTS Call S_GRPCPYTSO(zc) From W1BCH1
Onkey 144 Titled GBOUTP Call P_GRPCPYTSO(zc) From W1BCH1
Onkey 146 Titled GBOUTA Call SA_GRPCPYTSO(zc) From W1BCH1
Gosub _AFF
End

Subprog C_GRPCPYTSO(VALEUR)
Variable Char    VALEUR()
## Action %CNTOBJ
Call CONTSEL("AGF","!",VALEUR,"",mkstat) From CONTOBJ
If mkstat : GERR = 1 : GZONE = "GRPCPYTSO" : GZNUM = 53203 : Endif
If !mkstat
 ## Action STD
 Call C_GRPCPYTSO(VALEUR) From FUNBCH
 If mkstat : GERR = 1 : GZONE = "GRPCPYTSO" : GZNUM = 53203 : Endif
Endif
Gosub _AFF
End

$AMM_GRPCPYTSO
Call AM_GRPCPYTSO(zc)
If !mkstat & GOBJET
 zoncou = "GRPCPYTSO" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_GRPCPYTSO(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_GRPCPYTSO(VALEUR) From FUNBCH
If mkstat : GERR = 1 : GZONE = "GRPCPYTSO" : GZNUM = 53203 : Endif
Gosub _AFF
End

Subprog S_GRPCPYTSO(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELOBJCRI1
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELOBJCRI1"
 PARMSK(1) = "AGF"
 PARMSK(2) = ""
 PARMSK(3) = ""
 PARMSK(4) = [M]FILTRE_AGF
 PARMSK(5) = ""
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJCRIT","TRTX3","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B1_GRPCPYTSO(VALEUR)
Variable Char    VALEUR()
Call OBJET("AGF",VALEUR,"") From GOBJET
Gosub _AFF
End

Subprog SA_GRPCPYTSO(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "AGF"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_GRPCPYTSO(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("AGF",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_LEGGRPTSO
Onevent INIT_AREA Call D_LEGGRPTSO(zc) From W1BCH1
Return

Subprog D_LEGGRPTSO(VALEUR)
Variable Char    VALEUR()
If varinit([M]LEGGRPTSO,indice)=0
 ## Action INILEG
 Call INILEG(VALEUR,"909","") From SUBADI
Endif
Gosub _AFF
End

$ON_SOHTYP
Onevent CONTROL Call C_SOHTYP(zc) From W1BCH1
Onevent BEFORE_AREA Gosub AV_SOHTYP From W1BCH1
Onevent BEFORE_INPUT Call AS_SOHTYP(zc) From W1BCH1
Onevent AFTER_CHANGE Gosub AMM_SOHTYP From W1BCH1
Return

Subprog IB_SOHTYP(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action IBTUNLEG
 Call IBTUNLEG("") From TRTVENCTL
Endif
Gosub _AFF
End

$AV_SOHTYP
## Action STD
Call AV_SOHTYP(zc) From FUNBCH
Gosub _AFF
Return

Subprog AS_SOHTYP(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(24700,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_SOHTYP(VALEUR)
Onkey 129 Titled GBOUT1 Call B1_SOHTYP(zc) From W1BCH1
Onkey   2 Titled GBOUTS Call S_SOHTYP(zc) From W1BCH1
Onkey 144 Titled GBOUTP Call P_SOHTYP(zc) From W1BCH1
Onkey 146 Titled GBOUTA Call SA_SOHTYP(zc) From W1BCH1
Gosub _AFF
End

Subprog C_SOHTYP(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "SOHTYP" : GZNUM = 2562 : Endif
If !mkstat
 ## Action CONTTSO
 Call CONTTSO(VALEUR,[M:BCH1]LEGGRPTSO(nolign-1),"BCH1","SOHTYP","",[M:BCH1]GRPCPYTSO(nolign-1),"") From SUBTSO
 If mkstat : GERR = 1 : GZONE = "SOHTYP" : GZNUM = 2562 : Endif
 If !mkstat
  ## Action CONTOBJN
  Local Char    PARMSK(250)(1..20) , SAVACT(20)
  SAVACT = GACTION : GACTION = "CONTOBJN"
  Call S_AFF_CHAR(VALEUR,PARMSK,"CONTOBJN","CONTOBJ","") From GACTION
  GACTION = SAVACT
  If mkstat : GERR = 1 : GZONE = "SOHTYP" : GZNUM = 2562 : Endif
  If !mkstat
   ## Action STD
   Call C_SOHTYP(VALEUR) From FUNBCH
   If mkstat : GERR = 1 : GZONE = "SOHTYP" : GZNUM = 2562 : Endif
  Endif
 Endif
Endif
Gosub _AFF
End

$AMM_SOHTYP
Call AM_SOHTYP(zc)
If !mkstat & GOBJET
 zoncou = "SOHTYP" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_SOHTYP(VALEUR)
Variable Char    VALEUR()
If !mkstat & evalue("dim("+clanam([M])+"ZSOHTYP)")>indice
 [M]SOHTYP(indice) = VALEUR
 Affzo ZSOHTYP(indice)
Endif
Gosub _AFF
End

Subprog S_SOHTYP(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELTSOLEG2
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELTSOLEG2"
 PARMSK(1) = [M:BCH1]LEGGRPTSO(nolign-1)
 PARMSK(2) = ""
 PARMSK(3) = [M:BCH1]GRPCPYTSO(nolign-1)
 PARMSK(4) = ""
 PARMSK(5) = "a"+num$([M:BCH1]SOHCAT(nolign-1))
 PARMSK(6) = "BCH1"
 PARMSK(7) = "SOHTYP"
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELTSOLEG2","SUBTSO","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B1_SOHTYP(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action TUNTSO
 Call TUNTSO(VALEUR,[M:BCH1]LEGGRPTSO(nolign-1)) From SUBTSO
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog SA_SOHTYP(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "TSO"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_SOHTYP(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("TSO",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZSOHTYP
Onevent BEFORE_AREA Gosub AV_ZSOHTYP From W1BCH1
Return

$AV_ZSOHTYP
Call LECTEXTRA(zc,"TABSOHTYP","SHOAXX",num$([M]SOHTYP(indice)),"") From ATEXTRA
Gosub _AFF
Return

$ON_NBCOR
Onevent AFTER_LINE Call APRES_NBCOR From W1BCH1
Return

Subprog APRES_NBCOR
Local Decimal BASPAG
## Action STD
Call APRES_NBCOR From FUNBCH
If mkstat : End : Endif
Gosub _AFF
End

$ON_SFINUM
Onevent AFTER_CHANGE Gosub AMM_SFINUM From W1BCH1
Onevent CONTROL Call C_SFINUM(zc) From W1BCH1
Onevent BEFORE_INPUT Call AS_SFINUM(zc) From W1BCH1
Return

Subprog AS_SFINUM(VALEUR)
Variable Decimal VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(11496,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Onkey 129 Titled GBOUT1 Call B1_SFINUM(zc) From W1BCH1
Onkey   2 Titled GBOUTS Call S_SFINUM(zc) From W1BCH1
Onkey 144 Titled GBOUTP Call P_SFINUM(zc) From W1BCH1
Gosub _AFF
End

Subprog C_SFINUM(VALEUR)
Variable Decimal VALEUR
## Action %OBLIG
If VALEUR=0
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "SFINUM" : GZNUM = 3821 : Endif
If !mkstat
 ## Action %CNTOBJ
 Call CONTNUM("SFI","",VALEUR,"",mkstat) From CONTOBJ
 If mkstat : GERR = 1 : GZONE = "SFINUM" : GZNUM = 3821 : Endif
Endif
Gosub _AFF
End

$AMM_SFINUM
Call AM_SFINUM(zc)
If !mkstat & GOBJET
 zoncou = "SFINUM" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_SFINUM(VALEUR)
Variable Decimal VALEUR
## Action STD
Call AM_SFINUM(VALEUR) From FUNBCH
If mkstat : GERR = 1 : GZONE = "SFINUM" : GZNUM = 3821 : Endif
If !mkstat & evalue("dim("+clanam([M])+"ZSFINUM)")>indice
 [M]SFINUM(indice) = VALEUR
 Affzo ZSFINUM(indice)
Endif
Gosub _AFF
End

Subprog S_SFINUM(VALEUR)
Variable Decimal VALEUR
Local Char PARMSK(250)(1..16)
PARMSK(1) = "SFI"
PARMSK(2) = ""
Call S_TAB_NUM(VALEUR,PARMSK,"SELOBJ","SELOBJ","") From GACTION
Gosub _AFF
End

Subprog B1_SFINUM(VALEUR)
Variable Decimal VALEUR
Local Char VALCHAR(20)
VALCHAR = num$(VALEUR)
Call OBJET("SFI",VALCHAR,"") From GOBJET
VALEUR = val(VALCHAR)
Gosub _AFF
End

Subprog P_SFINUM(VALEUR)
Variable Decimal VALEUR
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("SFI",num$(VALEUR),PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZSFINUM
Onevent BEFORE_AREA Gosub AV_ZSFINUM From W1BCH1
Return

$AV_ZSFINUM
Call LECTEXTRA(zc,"SFOOTINV","DESAXX",num$([M]SFINUM(indice)),"") From ATEXTRA
Gosub _AFF
Return

$ON_AMTCOD
Onevent INIT_AREA Call D_AMTCOD(zc) From W1BCH1
Return

Subprog D_AMTCOD(VALEUR)
Variable Integer VALEUR
If varinit([M]AMTCOD,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_PFINUM
Onevent CONTROL Call C_PFINUM(zc) From W1BCH1
Onevent BEFORE_INPUT Call AS_PFINUM(zc) From W1BCH1
Onevent AFTER_CHANGE Gosub AMM_PFINUM From W1BCH1
Return

Subprog AS_PFINUM(VALEUR)
Variable Decimal VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(6015,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Onkey 129 Titled GBOUT1 Call B1_PFINUM(zc) From W1BCH1
Onkey   2 Titled GBOUTS Call S_PFINUM(zc) From W1BCH1
Onkey 144 Titled GBOUTP Call P_PFINUM(zc) From W1BCH1
Gosub _AFF
End

Subprog C_PFINUM(VALEUR)
Variable Decimal VALEUR
## Action %OBLIG
If VALEUR=0
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "PFINUM" : GZNUM = 3820 : Endif
If !mkstat
 ## Action %CNTOBJ
 Call CONTNUM("PFI","",VALEUR,"",mkstat) From CONTOBJ
 If mkstat : GERR = 1 : GZONE = "PFINUM" : GZNUM = 3820 : Endif
 If !mkstat
  ## Action STD
  Call C_PFINUM(VALEUR) From FUNBCH
  If mkstat : GERR = 1 : GZONE = "PFINUM" : GZNUM = 3820 : Endif
 Endif
Endif
Gosub _AFF
End

$AMM_PFINUM
Call AM_PFINUM(zc)
If !mkstat & GOBJET
 zoncou = "PFINUM" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_PFINUM(VALEUR)
Variable Decimal VALEUR
If !mkstat & evalue("dim("+clanam([M])+"ZPFINUM)")>indice
 [M]PFINUM(indice) = VALEUR
 Affzo ZPFINUM(indice)
Endif
Gosub _AFF
End

Subprog S_PFINUM(VALEUR)
Variable Decimal VALEUR
Local Char PARMSK(250)(1..16)
PARMSK(1) = "PFI"
PARMSK(2) = ""
Call S_TAB_NUM(VALEUR,PARMSK,"SELOBJ","SELOBJ","") From GACTION
Gosub _AFF
End

Subprog B1_PFINUM(VALEUR)
Variable Decimal VALEUR
Local Char VALCHAR(20)
VALCHAR = num$(VALEUR)
Call OBJET("PFI",VALCHAR,"") From GOBJET
VALEUR = val(VALCHAR)
Gosub _AFF
End

Subprog P_PFINUM(VALEUR)
Variable Decimal VALEUR
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("PFI",num$(VALEUR),PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZPFINUM
Onevent BEFORE_AREA Gosub AV_ZPFINUM From W1BCH1
Return

$AV_ZPFINUM
Call LECTEXTRA(zc,"PFOOTINV","DESAXX",num$([M]PFINUM(indice)),"") From ATEXTRA
Gosub _AFF
Return

$CHG_STY
Gosub CHG_STY From W2BCH1
Return

$TIT_COL
Gosub TIT_COL From W2BCH1
Return


