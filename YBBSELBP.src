#<AdxTL>@(#)0.0.0.0 $Revision$
#######################################################################################################
# FILE NAME   : YBBSELBP                                                                               #
# DESCRIPTION : BP Customer/Supplier Selection                                                                        #
#######################################################################################################
# DATE        : 1-11-2018                                                                            #
# AUTHOR      : DEWALD                                                                                #
# COMPANY     : Leverage Technologies                                                                 #
#-----------------------------------------------------------------------------------------------------#
# Epics Code  : DFCX1-27                                                                             #
#-----------------------------------------------------------------------------------------------------#
#######################################################################################################
$ACTION
Case ACTION
  When Default
Endcase

Case GACTION
  When "YBBSELBP"
    Gosub S_SELBP
Endcase
Return

$S_SELBP
Local Integer I
Local Char TEXTE(255)(1..600,1..4)
Local Char TEX(25)(2000)
Local Char QRY(255)(0..)

I=0
TIT(1)="BP"
TIT(2)="Company name"
TIT(3)="Short description"
TIT(4)="Category"
CRITERE = "1=1"

#QRY1(0) = "SELECT top 1000 BPCNUM_0, BPCNAM_0, BPCSHO_0, 'Customer' from BPCUSTOMER where BPCSTA_0 = 2"
#QRY1(1) -= "union all"
#QRY1(2) -= "SELECT top 1000 BPSNUM_0, BPSNAM_0, BPSSHO_0, 'Supplier' From BPSUPPLIER where ENAFLG_0 = 2 and YSUPSTA_0 = 1"
#QRY(0) = "SELECT TOP 500 BP.BPSNUM_0, BP.BPSNAM_0, BP.BPSSHO_0, 'Supplier'"
#QRY(1) -= "FROM BPSUPPLIER BP"
#QRY(2) -= "INNER JOIN GACCCODE GCOD ON BP.ACCCOD_0 = GCOD.ACCCOD_0"
#QRY(3) -= "WHERE GCOD.ACC_0 = '"+[M:YBB1]YACC(nolign-1)+"' and BP.ENAFLG_0 = 2"

 QRY(0) = "SELECT DISTINCT TOP 250 BP.BPSNUM_0, BP.BPSNAM_0, GAC.ACCSHO_0, 'Supplier'"
 QRY(1) -= "From BPSUPPLIER BP"
 QRY(2) -= "INNER JOIN GACCCODE GCOD ON BP.ACCCOD_0 = GCOD.ACCCOD_0"
 QRY(3) -= "INNER JOIN GACCOUNT GAC ON GAC.ACC_0 = GCOD.ACC_0"
 QRY(4) -= "Where GCOD.ACC_0 = '"+[M:YBB1]YACC(nolign-1)+"' and BP.ENAFLG_0 = 2 and GAC.SAC_0 = 2 and GAC.COA_0 = '"+[M:YBB1]YCOA(nolign-1)+"'"
 QRY(5) -= "UNION ALL"
 QRY(6) -= "SELECT DISTINCT TOP 250 BP.BPCNUM_0, BP.BPCNAM_0, GAC.ACCSHO_0, 'Customer'"
 QRY(7) -= "From BPCUSTOMER BP"
 QRY(8) -= "INNER JOIN GACCCODE GCOD ON BP.ACCCOD_0 = GCOD.ACCCOD_0"
 QRY(9) -= "INNER JOIN GACCOUNT GAC ON GAC.ACC_0 = GCOD.ACC_0"
 QRY(10) -= "Where GAC.ACC_0 = '"+[M:YBB1]YACC(nolign-1)+"' and BP.BPCSTA_0 = 2 and GAC.SAC_0 = 2 and GAC.COA_0 = '"+[M:YBB1]YCOA(nolign-1)+"'"

For (Char BPCNUM, Char BPCNAM, Char BCGCOD, Char CAT) From "5" Sql QRY As [YLNK]
  I += 1
  TEX(I)     = [F:YLNK]BPCNUM
  TEXTE(I,1) = [F:YLNK]BPCNUM
  TEXTE(I,2) = [F:YLNK]BPCNAM
  TEXTE(I,3) = [F:YLNK]BCGCOD
  TEXTE(I,4) = [F:YLNK]CAT
Next
NBTEX=I

[M:YBB1]YCTRL(nolign-1) = TEXTE(I,3)
Affzo [M:YBB1]YCTRL(nolign-1)

#If I = 0
#
#  QRY(0) = "" : QRY(1) = "" : QRY(2) = "" : QRY(3) = ""
#
#  QRY(0) = "SELECT top 1000 BP.BPCNUM_0, BP.BPCNAM_0, BP.BPCSHO_0, 'Customer'"
#  QRY(1) -= "FROM BPCUSTOMER BP"
#  QRY(2) -= "INNER JOIN GACCCODE GCOD ON BP.ACCCOD_0 = GCOD.ACCCOD_0"
#  QRY(3) -= "WHERE GCOD.ACC_0 = '"+[M:YBB1]YACC(nolign-1)+"' and BP.BPCSTA_0 = 2"
#
#  For (Char BPCNUM, Char BPCNAM, Char BCGCOD, Char CAT) From "5" Sql QRY As [YLNK]
#    I += 1
#    TEX(I)     = [F:YLNK]BPCNUM
#    TEXTE(I,1) = [F:YLNK]BPCNUM
#    TEXTE(I,2) = [F:YLNK]BPCNAM
#    TEXTE(I,3) = [F:YLNK]BCGCOD
#    TEXTE(I,4) = [F:YLNK]CAT
#  Next
#  NBTEX=I
#
#Endif

Return

