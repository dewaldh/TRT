#<AdxTL>@(#)0.0.0.0 $Revision$
#-------------------------------------------------------------
# Script            : SPEYBB
# Creation date     : 30/08/2018
# Version           : 1.0.0
# Authors (Company) : DH (Leverage)
# Module            : Intercompany
# ------------------------------------------------------------
# Epic              : https://jira.leveragetech.com.au/browse/DFCX1-27
# Description       : Business Batch Screens - Hybrid Development
#-------------------------------------------------------------
$ACTION
Case ACTION
  When Default
Endcase
Return

#------------------------------------------------------------------------------------#
# Header Site Control
#------------------------------------------------------------------------------------#
Subprog C_YBATFCY(VALEUR)
Variable Char    VALEUR()
If [M:YBB0]YBATNBR = "" and GBATNBR = "" Then
  #Generate Batch Number
  Local Char RETVAL(30)
  Local Integer STA
  Call NUMERO("YBBHS","",date$,"null",RETVAL,STA) From SUBANM
  GBATNBR = RETVAL
  [M:YBB0]YBATNBR = RETVAL

  #Set Status to Final as per Tech Spec
  [M:YBB0]YFINSTA = 2
  Affzo [M:YBB0]
Endif

End

#------------------------------------------------------------------------------------#
# Entry Type Control
#------------------------------------------------------------------------------------#
Subprog C_YENTTYP(VALEUR)
Variable Char    VALEUR()

  #Check entered value
  Call C_YENTTYP(VALEUR) From YBBSELGTE

If [M:YBB1]NBLIG = 0

  #Populate Transaction Number
  [M:YBB1]YTRANSNBR(nolign-1) = nolign

  #Poplulate Description and Reference for first line only
  If [M:YBB1]YDETDES(0) = "" : [M:YBB1]YDETDES(0) = [M:YBB0]YBATDES : Endif
  If [M:YBB1]YREF(0) = ""    : [M:YBB1]YREF(0)    = [M:YBB0]YBATREF : Endif

  #Use Default Journal code when available
  If clalev([F:GTE]) = 0 : Local File GTYPACCENT [GTE] : Endif
  Read [F:GTE]GTE0 = VALEUR
  If [F:GTE]DEFJOU <> "" : [M:YBB1]YJOU(nolign-1) = [F:GTE]DEFJOU : Endif

Endif

If [M:YBB1]NBLIG >= 1 and VALEUR = [M:YBB1]YENTTYP(nolign-2)

  #Populate Transaction Number
  [M:YBB1]YTRANSNBR(nolign-1) = [M:YBB1]YTRANSNBR(nolign-2)

Endif

If [M:YBB1]NBLIG >= 1 and VALEUR <> [M:YBB1]YENTTYP(nolign-2)

  #Populate Transaction Number
  [M:YBB1]YTRANSNBR(nolign-1) = [M:YBB1]YTRANSNBR(nolign-2) + 1

Endif

End


#------------------------------------------------------------------------------------#
# Journal Control
#------------------------------------------------------------------------------------#
Subprog C_YJOU(VALEUR)
Variable Char    VALEUR()
  #Check entered value
  Call C_YJOU(VALEUR) From YBBSELJOU

  #Hide/Display Fields based on Journal Type Selection (IE/Cash/Jou)
  Call CTR_FLD(VALEUR)

End


#------------------------------------------------------------------------------------#
# Hide/Display Fields based on Journal
#------------------------------------------------------------------------------------#
Subprog CTR_FLD(YJOU)
Value Char YJOU()

  Local Integer YJOUTYP : YJOUTYP = 0
  If clalev([F:JOU]) = 0 : Local File GJOURNAL [JOU] : Endif
  Read [F:JOU]JOU0 = YJOU
  YJOUTYP = [F:JOU]YBUSBATTYP

  #1 - Inter Entity
  If YJOUTYP = 1
    Actzo [M:YBB1]YELA(nolign-1)
    Diszo [M:YBB1]YBAN(nolign-1)
  Endif
  #2 - Cash
  If YJOUTYP = 2
     Diszo [M:YBB1]YELA(nolign-1)
     Actzo [M:YBB1]YBAN(nolign-1)
  Endif
  #3 - Journal
  If YJOUTYP = 3
     Diszo [M:YBB1]YELA(nolign-1)
     Diszo [M:YBB1]YBAN(nolign-1)
  Endif
  #User mistake
  If YJOUTYP = 0
    GMESSAGE = mess(1,6254,1)+[M:YBB1]YJOU(nolign-1)
    GOK = 0
    GERR = 1
    zonsui = "[M:YBB1]YJOU(nolign-1)"
  Endif

End

#------------------------------------------------------------------------------------#
# Site Control
#------------------------------------------------------------------------------------#
Subprog C_YFCY(VALEUR)
Variable Char    VALEUR()

  If clalev([F:JOU]) = 0 : Local File GJOURNAL [JOU] : Endif
  Read [F:JOU]JOU0 = [M:YBB1]YJOU(nolign-1)
  If [F:JOU]YBUSBATTYP = 1 Then
  #Check Default ELA
  If clalev([F:YELA]) = 0 : Local File YENTLOAAGR  [YELA] : Endif
  For [YELA] Where YFCYREC = VALEUR and YENAFLG = 2
    If [F:YELA]YDEFFLG = 2 : [M:YBB1]YELA(nolign-1) = [F:YELA]YLONAGR : Endif
  Next
  #4. ALL ACTIVE ELAS Where THE RECIPIENT SITE ON THE ELA IS EQUAL To THE SITE ABOVE ARE AVAILABLE For SELECTION.

  Endif

End

#------------------------------------------------------------------------------------#
# ELA Control
#------------------------------------------------------------------------------------#
Subprog C_YELA(VALEUR)
Variable Char    VALEUR()
  #Check entered ELA value
  Call C_YELA(VALEUR) From YBBSELELA

End

#------------------------------------------------------------------------------------#
# Debit/Credit Controls
#------------------------------------------------------------------------------------#
# -- Debit
Subprog C_YDEB(VALEUR) #Control Field
Variable Decimal VALEUR
  If VALEUR > 0 : Diszo [M:YBB1]YCDT(nolign-1) : Endif
End

Subprog AM_YDEB(VALEUR) #After Change
Variable Decimal VALEUR
  #Zero Value Check
  If VALEUR < 0
    GMESSAGE = mess(11,6254,1)
    GOK = 0
    GERR = 1
    zonsui = "[M:YBB1]YDEB(nolign-1)"
    End
  Endif
  If VALEUR = 0
    Actzo [M:YBB1]YCDT(nolign-1)
  Endif

End

# -- Credit
Subprog C_YCDT(VALEUR) #Control Field
Variable Decimal VALEUR
  If VALEUR > 0 : Diszo [M:YBB1]YDEB(nolign-1) : Endif
  If VALEUR = 0 and [M:YBB1]YDEB(nolign-1) = 0
    GMESSAGE = mess(9,6254,1)
    GOK = 0
    GERR = 1
    zonsui = "[M:YBB1]YCDT(nolign-1)"
    End
  Endif
End

Subprog AM_YCDT(VALEUR) #After Change
Variable Decimal VALEUR
  #Zero Value Check
  If VALEUR < 0
    GMESSAGE = mess(11,6254,1)
    GOK = 0
    GERR = 1
    zonsui = "[M:YBB1]YDEB(nolign-1)"
  Endif
  If VALEUR = 0
    Actzo [M:YBB1]YDEB(nolign-1)
  Endif
End


######################################################################################

