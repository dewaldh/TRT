#<AdxTL>@(#)0.0.0.0 $Revision$
#------------------------------------------------------------------------------------#
#Action
#------------------------------------------------------------------------------------#
$ACTION
Case ACTION
  When "OUVRE"      : Gosub OUVRE
  When "INICRE"     : Gosub INICRE
  When "VERIF_MOD"  : Gosub VERIF_MOD
  When "SETBOUT"    : Gosub SETBOUT
  When Default
Endcase
Return

Subprog AM_PJT(VALEUR)
Variable Char    VALEUR()
End

#------------------------------------------------------------------------------------#
#Before creation validation
#------------------------------------------------------------------------------------#
$INICRE
  Gosub VALIDATEPJM
Return

#------------------------------------------------------------------------------------#
#Before modification validations
#------------------------------------------------------------------------------------#
$VERIF_MOD
  Gosub VALIDATEPJM
Return


#------------------------------------------------------------------------------------#
#Open needed tables
#------------------------------------------------------------------------------------#
$OUVRE

If clalev([F:YGAC]) = 0 : Local File GACCOUNT[YGAC] : Endif

Return

$SETBOUT

  CHMEN += "Z7"
  Gosub SET_BOUT_SPE From GSAISIE

Return
#------------------------------------------------------------------------------------#
#
#------------------------------------------------------------------------------------#
Subprog AM_DIE(VALEUR)
Variable Char    VALEUR()
End


#------------------------------------------------------------------------------------#
#
#------------------------------------------------------------------------------------#
Subprog AM_ACC1(VALEUR)
Variable Char    VALEUR()

End


#------------------------------------------------------------------------------------#
#After line, validate the PJM accounts
#------------------------------------------------------------------------------------#
Subprog AP_PJTLIN(VALEUR)
Variable Char    VALEUR()

Local Integer YVAL

If VALEUR = ''
  YVAL = func YDFCGENERAL.VAL_PJM([M:HAE2]ACC1(nolign-1))
  If YVAL = 2
#    Infbox mess(1,6201,1)
    Call ERRTIT( mess(1,6201,1),"Mandatory field") From GESECRAN
    mkstat = 2
  Endif
Endif
End


#------------------------------------------------------------------------------------#
#After line, validate the PJM accounts
#------------------------------------------------------------------------------------#
Subprog APRES_NBLIG

Local Integer YVAL

    YVAL = func YDFCGENERAL.VAL_PJM([M:HAE2]ACC1(nolign-1))
    If YVAL = 2 and [M:HAE2]PJTLIN(nolign-1) = ""
      Call ERRTIT( mess(1,6201,1),"Mandatory field") From GESECRAN
      zonsui = "[M:BIS3]PJTLIN(" + num$(nolign-1) + ")"
    Endif

End


#------------------------------------------------------------------------------------#
#Do PJM account link validations
#------------------------------------------------------------------------------------#
$VALIDATEPJM

Local Char YMSG(250)
Infbox 'd'
  For I = 0 To [M:HAE2]NBLIG-1

  Filter [F:YGAC] Where ACC = [M:HAE2]ACC1(I)
  For [F:YGAC]

  If [F:YGAC]YPJM = 2 and [M:HAE2]PJTLIN(I) = ""
    YMSG += num$(I + 1) + ", "
  Endif

  Next
  Filter [F:YGAC]

  Next

  If len(YMSG) > 0
    GMESSAGE = mess(2,6201,1) + left$(YMSG,len(YMSG)-2) # "Please enter a project code on the following lines: " + ZMSG
    GERR = 1
    GOK = 0
  Endif

Return

######################################################################################
## Section automatically added (screen GACCENT2) 09/08/2018 15:40:13 (ADMIN)
######################################################################################

Subprog AM_CCE1(VALEUR)
Variable Char    VALEUR()

End

Subprog AM_CCE2(VALEUR)
Variable Char    VALEUR()

End

Subprog AM_CCE3(VALEUR)
Variable Char    VALEUR()

End

Subprog AM_CCE4(VALEUR)
Variable Char    VALEUR()

End

Subprog AM_CCE5(VALEUR)
Variable Char    VALEUR()

End


######################################################################################

#------------------------------------------------------------------------------------#
#DEWAL - Check enter values for valid dimensions
#------------------------------------------------------------------------------------#
Subprog C_CCE1(VALEUR)
Variable Char    VALEUR()
  Call VAL_CCE(VALEUR) From YDIESEL
End

Subprog C_CCE2(VALEUR)
Variable Char    VALEUR()
  Call VAL_CCE(VALEUR) From YDIESEL
End

Subprog C_CCE3(VALEUR)
Variable Char    VALEUR()
  Call VAL_CCE(VALEUR) From YDIESEL
End

Subprog C_CCE4(VALEUR)
Variable Char    VALEUR()
  Call VAL_CCE(VALEUR) From YDIESEL
End

Subprog C_CCE5(VALEUR)
Variable Char    VALEUR()
  Call VAL_CCE(VALEUR) From YDIESEL
End
#------------------------------------------------------------------------------------#
#Control - Type
#------------------------------------------------------------------------------------#
Subprog C_TYP(VALEUR)
Variable Char    VALEUR()

  #Only validate manual input transactions
  If (GWEBSERV = 0 or GIMPORT = 0) and GFONC1 = ""

    #DFC1-154 Journal Document Type Restriction & Delete Condition

    #Open table
    If !clalev ([F:YGTE]) : Local File GTYPACCENT [F:YGTE] : Endif

    #Read Document Type
    Read [F:YGTE]GTE0 = VALEUR

    #Check if General Journals are permitted
    If fstat = 0
      If [F:YGTE]AUZJOU(8) = 1
        Call ERREURT("This Entry Type is not setup for General Journals!", 1) From GESECRAN
        [M:HAE0]TYP = ""
        Affzo [M:HAE0]TYP
        mkstat = 2
      Endif
    Endif

    #Close table
    If clalev([F:YGTE]) : Close Local File [F:YGTE] : Endif

  Endif

End


######################################################################################

