#<AdxTL>@(#)0.0.0.0 $Revision$
#<AdxTL>@(#)0.0.0.0 $Revision$
$ACTION
  Case ACTION
    When "EXEC" : Gosub EXEC
  Endcase
Return

$EXEC

Local Clbfile RESHEAD(0),RESBODY(0)
Local Integer RETVAL
Infbox(num$([M]CRN))
Infbox(num$(PARAM(1)))
  # No additional parameter nor additional header value are given here (only the values given in ORDER definition are used)
Local Char PCOD(100)(1..10),PVAL(100)(1..10),HCOD(100)(1..10),HVAL(100)(1..10)
RETVAL=func ASYRRESTCLI.EXEC_REST_WS("DFCABNINF","GET",PARAM(1),PCOD,PVAL,HCOD,HVAL,"{}", 0,"",RESHEAD, RESBODY)

If RETVAL = 404
  Call ERRTIT( mess(36,6201,1),"Mandatory field") From GESECRAN
  zonsui = "[M:BPRS]CRN"
Elsif RETVAL = 200

Local Char YMSG(255)

YMSG = "ABN: " + seg$(RESBODY,instr(1,RESBODY,"<ABN>")+5,instr(1,RESBODY,"</ABN>")-1)
& + chr$(10)+chr$(13) + "Business Name: " + seg$(RESBODY,instr(1,RESBODY,"<BusinessName>")+14,instr(1,RESBODY,"</BusinessName>")-1)
& + chr$(10)+chr$(13) + "Company Name: " + seg$(RESBODY,instr(1,RESBODY,"<CompanyName>")+13,instr(1,RESBODY,"</CompanyName>")-1)
& + chr$(10)+chr$(13) + "ABN Status: " + seg$(RESBODY,instr(1,RESBODY,"<ABNStatus>")+11,instr(1,RESBODY,"</ABNStatus>")-1)
& + chr$(10)+chr$(13) + "GST Registration Status: " + seg$(RESBODY,instr(1,RESBODY,"<GSTRegistrationStatus>")+23,instr(1,RESBODY,"</GSTRegistrationStatus>")-1)
& + chr$(10)+chr$(13) + "Additional Information: " + seg$(RESBODY,instr(1,RESBODY,"<AdditionalInformation>")+23,instr(1,RESBODY,"</AdditionalInformation>")-1)
& + chr$(10)+chr$(13) + "Is this correct? "


Call OUINON(YMSG,OK)  From GESECRAN
Case OK
   When 2: Goto YES  #yes
   When 1: Goto NO   #no
Endcase


#Infbox "ABN: " + seg$(RESBODY,instr(1,RESBODY,"<ABN>")+5,instr(1,RESBODY,"</ABN>")-1),
#& "Business Name: " + seg$(RESBODY,instr(1,RESBODY,"<BusinessName>")+14,instr(1,RESBODY,"</BusinessName>")-1),
#& "Company Name: " + seg$(RESBODY,instr(1,RESBODY,"<CompanyName>")+13,instr(1,RESBODY,"</CompanyName>")-1),
#& "ABN Status: " + seg$(RESBODY,instr(1,RESBODY,"<ABNStatus>")+11,instr(1,RESBODY,"</ABNStatus>")-1),
#& "GST Registration Status: " + seg$(RESBODY,instr(1,RESBODY,"<GSTRegistrationStatus>")+23,instr(1,RESBODY,"</GSTRegistrationStatus>")-1),
#& "Additional Information: " + seg$(RESBODY,instr(1,RESBODY,"<AdditionalInformation>")+23,instr(1,RESBODY,"</AdditionalInformation>")-1)

$YES
  #populate the screen
  [M:BPS4]YABRBUS = seg$(RESBODY,instr(1,RESBODY,"<BusinessName>")+14,instr(1,RESBODY,"</BusinessName>")-1)
  [M:BPS4]YABRCPY = seg$(RESBODY,instr(1,RESBODY,"<CompanyName>")+13,instr(1,RESBODY,"</CompanyName>")-1)
  [M:BPS4]YABRABNSTA = seg$(RESBODY,instr(1,RESBODY,"<ABNStatus>")+11,instr(1,RESBODY,"</ABNStatus>")-1)
  [M:BPS4]YARBGSTSTA = seg$(RESBODY,instr(1,RESBODY,"<GSTRegistrationStatus>")+23,instr(1,RESBODY,"</GSTRegistrationStatus>")-1)
  [M:BPS4]YABRLKPDAT = date$
  [M:BPS4]YABRINF = seg$(RESBODY,instr(1,RESBODY,"<AdditionalInformation>")+23,instr(1,RESBODY,"</AdditionalInformation>")-1)
  Affzo [M:BPS4]

  If [M:BPRS]BPRNAM() = ''
    If [M:BPS4]YABRBUS <> ''
      [M:BPRS]BPRNAM(0) = [M:BPS4]YABRBUS
    Else
      [M:BPRS]BPRNAM(0) = [M:BPS4]YABRCPY
    Endif
    Affzo [M:BPRS]BPRNAM(0)
  Endif

  If [M:BPRS]BPRNAM(1) = ''
     [M:BPRS]BPRNAM(1) = [M:BPS4]YABRCPY
     Affzo [M:BPRS]BPRNAM(1)
  Endif

Return

$NO
  #clear the screen
  zonsui = "[M:BPRS]CRN"

Endif

End

