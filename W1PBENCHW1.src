#<AdxTL>@(#)0.0.0.0 $Revision$
# Supervisor
# Mask management PBENCHW1 

$_AFF
If GIMPORT
 Gosub AFF From GSAISIE
Else
 If GMESSAGE <>""
  Gosub ERR From GSAISIE
 Else
  Raz GERR , GZNUM
 Endif
Endif
Return

$HORODAT
Local Date    A_DATE
Local Char    A_HEURE(10) , A_USER(10)
Local Char    A_STAMP(15)
A_DATE  = [28/08/2018]
A_HEURE = "00:06:57"
A_USER  = "ADMIN"
A_STAMP = "20180828000657"
Return

$TITRES
Return

$CHG_FMT
Case zoncou
 When "NBLIG"
  If [M]NBLIG=0
  Endif
Endcase
Return

$VISU
Local Integer A_REPONSE
Global Integer GPRE_VIEW
If dim(A_WINDPREV)<=0 : Local Char A_WINDPREV(30) : Endif
Local Mask PBENCHW1 [PBW1]
Gosub HORODAT
Local Inpbox "PBENCHW1" From GFONCTION At A_STAMP With A_WINDPREV Mask [PBW1] As [SIM_]
Grizo [PBW1]5
Grizo [PBW1]10
Grizo [PBW1]15
Grizo [PBW1]20
Grizo [PBW1]21
Grizo [PBW1]22
Grizo [PBW1]23
Grizo [PBW1]24
Grizo [PBW1]25
Boxact [SIM_]
Gosub TITRES
Boxinp [SIM_] Using A_REPONSE
Close Local Inpbox [SIM_]
Close Local Mask [PBW1]
Kill GPRE_VIEW
Return

$HARDCOP
Local Integer X1(0..14),X2(0..14),Y1(0..14),Y2(0..14)
X1(0)=1 : X2(0)=129 : Y1(0)=6 : Y2(0)=10
X1(1)=1 : X2(1)=129 : Y1(1)=11 : Y2(1)=12
X1(2)=1 : X2(2)=89 : Y1(2)=13 : Y2(2)=16
X1(3)=90 : X2(3)=129 : Y1(3)=13 : Y2(3)=16
X1(4)=1 : X2(4)=89 : Y1(4)=17 : Y2(4)=20
X1(5)=90 : X2(5)=129 : Y1(5)=17 : Y2(5)=20
X1(6)=130 : X2(6)=161 : Y1(6)=17 : Y2(6)=20
X1(7)=162 : X2(7)=190 : Y1(7)=17 : Y2(7)=20
X1(8)=1 : X2(8)=129 : Y1(8)=21 : Y2(8)=23
Return

$ON_PSHFCY
Onevent CONTROL Call C_PSHFCY(zc) From W1PBENCHW1
Onevent BEFORE_INPUT Call AS_PSHFCY(zc) From W1PBENCHW1
Onevent AFTER_CHANGE Gosub AMM_PSHFCY From W1PBENCHW1
Return

Subprog AS_PSHFCY(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Onkey   2 Titled GBOUTS Call S_PSHFCY(zc) From W1PBENCHW1
Onkey 144 Titled GBOUTP Call P_PSHFCY(zc) From W1PBENCHW1
Onkey 146 Titled GBOUTA Call SA_PSHFCY(zc) From W1PBENCHW1
Gosub _AFF
End

Subprog C_PSHFCY(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "PSHFCY" : GZNUM = 2550 : Endif
If !mkstat
 ## Action ACONTFCY
 Call CONTSITE(VALEUR) From SUBAGF
 If mkstat : GERR = 1 : GZONE = "PSHFCY" : GZNUM = 2550 : Endif
 If !mkstat
  ## Action %CNTOBJ
  Call CONTSEL("FCY","G",VALEUR,"",mkstat) From CONTOBJ
  If mkstat : GERR = 1 : GZONE = "PSHFCY" : GZNUM = 2550 : Endif
 Endif
Endif
Gosub _AFF
End

$AMM_PSHFCY
Call AM_PSHFCY(zc)
If !mkstat & GOBJET
 zoncou = "PSHFCY" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_PSHFCY(VALEUR)
Variable Char    VALEUR()
If !mkstat & evalue("dim("+clanam([M])+"ZPSHFCY)")>indice
 [M]PSHFCY(indice) = VALEUR
 Affzo ZPSHFCY(indice)
Endif
Gosub _AFF
End

Subprog S_PSHFCY(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16)
PARMSK(1) = "FCY"
PARMSK(2) = "G"
Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJ","SELOBJ","") From GACTION
Gosub _AFF
End

Subprog SA_PSHFCY(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "FCY"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_PSHFCY(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("FCY",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZPSHFCY
Onevent BEFORE_AREA Gosub AV_ZPSHFCY From W1PBENCHW1
Return

$AV_ZPSHFCY
If clalev([F:FCY])=0 : Local File FACILITY [FCY] : Endif
Call LECTURE("FCY",num$([M]PSHFCY(indice)),"") From CONTOBJ
zc = [F:FCY]FCYNAM
Gosub _AFF
Return

$ON_LINAPPFLG
Onevent INIT_AREA Call D_LINAPPFLG(zc) From W1PBENCHW1
Return

Subprog D_LINAPPFLG(VALEUR)
Variable Integer VALEUR
If varinit([M]LINAPPFLG,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_REQUSR
Onevent CONTROL Call C_REQUSR(zc) From W1PBENCHW1
Onevent BEFORE_INPUT Call AS_REQUSR(zc) From W1PBENCHW1
Onevent AFTER_CHANGE Gosub AMM_REQUSR From W1PBENCHW1
Return

Subprog AS_REQUSR(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Onkey   2 Titled GBOUTS Call S_REQUSR(zc) From W1PBENCHW1
Onkey 144 Titled GBOUTP Call P_REQUSR(zc) From W1PBENCHW1
Onkey 146 Titled GBOUTA Call SA_REQUSR(zc) From W1PBENCHW1
Gosub _AFF
End

Subprog C_REQUSR(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "REQUSR" : GZNUM = 2695 : Endif
If !mkstat
 ## Action %CNTOBJ
 Call CONTSEL("AUS","",VALEUR,"",mkstat) From CONTOBJ
 If mkstat : GERR = 1 : GZONE = "REQUSR" : GZNUM = 2695 : Endif
Endif
Gosub _AFF
End

$AMM_REQUSR
Call AM_REQUSR(zc)
If !mkstat & GOBJET
 zoncou = "REQUSR" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_REQUSR(VALEUR)
Variable Char    VALEUR()
If !mkstat & evalue("dim("+clanam([M])+"ZREQUSR)")>indice
 [M]REQUSR(indice) = VALEUR
 Affzo ZREQUSR(indice)
Endif
Gosub _AFF
End

Subprog S_REQUSR(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16)
PARMSK(1) = "AUS"
PARMSK(2) = ""
Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJ","SELOBJ","") From GACTION
Gosub _AFF
End

Subprog SA_REQUSR(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "AUS"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_REQUSR(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("AUS",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZREQUSR
Onevent BEFORE_AREA Gosub AV_ZREQUSR From W1PBENCHW1
Return

$AV_ZREQUSR
Call LECTEXTRA(zc,"AUTILIS","INTUSR",num$([M]REQUSR(indice)),"") From ATEXTRA
Gosub _AFF
Return

$ON_VCRNUM
Return

$ON_ITMREF
Onevent CONTROL Call C_ITMREF(zc) From W1PBENCHW1
Onevent BEFORE_INPUT Call AS_ITMREF(zc) From W1PBENCHW1
Onevent AFTER_CHANGE Gosub AMM_ITMREF From W1PBENCHW1
Return

Subprog IB_ITMREF(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action IBPRDINF
 Call IBPRDINF(VALEUR) From PRDINFLIB
Endif
Gosub _AFF
End

Subprog AS_ITMREF(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(12837,GBOUT13) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_ITMREF(VALEUR)
Onkey 170 Titled GBOUT13 Call B13_ITMREF(zc) From W1PBENCHW1
Onkey   2 Titled GBOUTS Call S_ITMREF(zc) From W1PBENCHW1
Onkey 144 Titled GBOUTP Call P_ITMREF(zc) From W1PBENCHW1
Onkey 146 Titled GBOUTA Call SA_ITMREF(zc) From W1PBENCHW1
Gosub _AFF
End

Subprog C_ITMREF(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
If !GWEBSERV
 If !mkstat
  ## Action ITMCHOICE
  Local Char    PARMSK(250)(1..20) , SAVACT(20)
  SAVACT = GACTION : GACTION = "ITMCHOICE"
  Call S_TAB_CHAR(VALEUR,PARMSK,"ITMCHOICE","TRTSEL","") From GACTION
  GACTION = SAVACT
  If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
 Endif
Endif
If !mkstat
 ## Action VXADCUPC
 Call ADCCTRUPC(VALEUR) From VXADCUPC
 If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
 If !mkstat
  ## Action %CNTOBJ
  Call CONTSEL("ITM","AB",VALEUR,"",mkstat) From CONTOBJ
  If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
 Endif
Endif
Gosub _AFF
End

$AMM_ITMREF
Call AM_ITMREF(zc)
If !mkstat & GOBJET
 zoncou = "ITMREF" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_ITMREF(VALEUR)
Variable Char    VALEUR()
If !mkstat & evalue("dim("+clanam([M])+"ZITMREF)")>indice
 [M]ITMREF(indice) = VALEUR
 Affzo ZITMREF(indice)
Endif
Gosub _AFF
End

Subprog S_ITMREF(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16)
PARMSK(1) = "ITM"
PARMSK(2) = "AB"
Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJ","SELOBJ","") From GACTION
Gosub _AFF
End

Subprog B13_ITMREF(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PRDINFA
 Call PRDINF(VALEUR) From PRDINFLIB
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog SA_ITMREF(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "ITM"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_ITMREF(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("ITM",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZITMREF
Onevent BEFORE_AREA Gosub AV_ZITMREF From W1PBENCHW1
Return

$AV_ZITMREF
Call LECTEXTRA(zc,"ITMMASTER","DES1AXX",num$([M]ITMREF(indice)),"") From ATEXTRA
Gosub _AFF
Return

$ON_ECCVALMAJ
Onevent BEFORE_INPUT Call AS_ECCVALMAJ(zc) From W1PBENCHW1
Onevent CONTROL Call C_ECCVALMAJ(zc) From W1PBENCHW1
Return

Subprog AS_ECCVALMAJ(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(15597,GBOUTS) From OBJDIV
## Action STD
Call AS_ECCVALMAJ(VALEUR) From SUBPBW1
If mkstat=2
 [M]ECCVALMAJ(INDIC) = VALEUR
 Affzo ECCVALMAJ(INDIC) : mkstat = 2
Endif
Onkey   2 Titled GBOUTS Call S_ECCVALMAJ(zc) From W1PBENCHW1
Gosub _AFF
End

Subprog C_ECCVALMAJ(VALEUR)
Variable Char    VALEUR()
## Action STD
Call C_ECCVALMAJ(VALEUR) From SUBPBW1
If mkstat : GERR = 1 : GZONE = "ECCVALMAJ" : GZNUM = 44205 : Endif
Gosub _AFF
End

Subprog S_ECCVALMAJ(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELECCVAL
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELECCVAL"
 PARMSK(1) = [M:PBW1]ITMREF
 PARMSK(2) = VALEUR
 PARMSK(3) = "[M:PBW1]ECCVALMIN"
 PARMSK(4) = "4"
 PARMSK(5) = [0/0/0]
 PARMSK(6) = "PBW1"
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELECCVAL","ECCLIB","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

$ON_ECCVALMIN
Onevent BEFORE_INPUT Call AS_ECCVALMIN(zc) From W1PBENCHW1
Onevent CONTROL Call C_ECCVALMIN(zc) From W1PBENCHW1
Return

Subprog AS_ECCVALMIN(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(15597,GBOUTS) From OBJDIV
## Action STD
Call AS_ECCVALMIN(VALEUR) From SUBPBW1
If mkstat=2
 [M]ECCVALMIN(INDIC) = VALEUR
 Affzo ECCVALMIN(INDIC) : mkstat = 2
Endif
Onkey   2 Titled GBOUTS Call S_ECCVALMIN(zc) From W1PBENCHW1
Gosub _AFF
End

Subprog C_ECCVALMIN(VALEUR)
Variable Char    VALEUR()
## Action STD
Call C_ECCVALMIN(VALEUR) From SUBPBW1
If mkstat : GERR = 1 : GZONE = "ECCVALMIN" : GZNUM = 44207 : Endif
Gosub _AFF
End

Subprog S_ECCVALMIN(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELECCVAL
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELECCVAL"
 PARMSK(1) = [M:PBW1]ITMREF
 PARMSK(2) = [M:PBW1]ECCVALMAJ
 PARMSK(3) = ""
 PARMSK(4) = "4"
 PARMSK(5) = [0/0/0]
 PARMSK(6) = "PBW1"
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELECCVAL","ECCLIB","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

$ON_STOMGTCOD
Onevent INIT_AREA Call D_STOMGTCOD(zc) From W1PBENCHW1
Return

Subprog D_STOMGTCOD(VALEUR)
Variable Integer VALEUR
If varinit([M]STOMGTCOD,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_POHTYP
Onevent INIT_AREA Call D_POHTYP(zc) From W1PBENCHW1
Return

Subprog D_POHTYP(VALEUR)
Variable Integer VALEUR
If varinit([M]POHTYP,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_POHFCY
Return

$ON_APPFCY
Return

$ON_STOFCY
Onevent CONTROL Call C_STOFCY(zc) From W1PBENCHW1
Onevent AFTER_CHANGE Gosub AMM_STOFCY From W1PBENCHW1
Onevent BEFORE_INPUT Call AS_STOFCY(zc) From W1PBENCHW1
Return

Subprog AS_STOFCY(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Onkey   2 Titled GBOUTS Call S_STOFCY(zc) From W1PBENCHW1
Onkey 144 Titled GBOUTP Call P_STOFCY(zc) From W1PBENCHW1
Onkey 146 Titled GBOUTA Call SA_STOFCY(zc) From W1PBENCHW1
Gosub _AFF
End

Subprog C_STOFCY(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "STOFCY" : GZNUM = 2552 : Endif
If !mkstat
 ## Action ACONTFCY
 Call CONTSITE(VALEUR) From SUBAGF
 If mkstat : GERR = 1 : GZONE = "STOFCY" : GZNUM = 2552 : Endif
 If !mkstat
  ## Action %CNTOBJ
  Call CONTSEL("FCY","D",VALEUR,"",mkstat) From CONTOBJ
  If mkstat : GERR = 1 : GZONE = "STOFCY" : GZNUM = 2552 : Endif
  If !mkstat
   ## Action PCOPRHFCY
   Call C_PRHFCY(VALEUR,[M]ITMREF) From TRTACHCTL1
   If mkstat : GERR = 1 : GZONE = "STOFCY" : GZNUM = 2552 : Endif
  Endif
 Endif
Endif
Gosub _AFF
End

$AMM_STOFCY
Call AM_STOFCY(zc)
If !mkstat & GOBJET
 zoncou = "STOFCY" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_STOFCY(VALEUR)
Variable Char    VALEUR()
## Action TRTPRHFCY
Local Char    PARMSK(250)(1..20) , SAVACT(20)
SAVACT = GACTION : GACTION = "TRTPRHFCY"
PARMSK(1) = [M]ITMREF
Call TRAITE_CHAR(VALEUR,PARMSK,"","TRTACHCTL1","",1,"XYTRTACHCTL1") From GTRAITE
GACTION = SAVACT
If mkstat : GERR = 1 : GZONE = "STOFCY" : GZNUM = 2552 : Endif
If !mkstat
 ## Action GOBJETC0A
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "GOBJETC0A"
 Local Char ACTION(20), PROGSUB(GLONADC), PROGSPE(GLONADC), PROGSPV(GLONADC)
 ACTION = "AAM_STOFCY" : PROGSUB = "SUBPBW1" : PROGSPE = "SPEPBW1" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 Local Char    OBJCLE(30)
 OBJCLE = VALEUR
 Call OBJET_CHAR(OBJCLE,WOBJET,[M]ITMREF) From GOBJET
 ACTION = "BAM_STOFCY" : PROGSUB = "SUBPBW1" : PROGSPE = "SPEPBW1" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 GACTION = SAVACT
 If mkstat : GERR = 1 : GZONE = "STOFCY" : GZNUM = 2552 : Endif
 If !mkstat & evalue("dim("+clanam([M])+"ZSTOFCY)")>indice
  [M]STOFCY(indice) = VALEUR
  Affzo ZSTOFCY(indice)
 Endif
Endif
Gosub _AFF
End

Subprog S_STOFCY(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELPRHFCY
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELPRHFCY"
 PARMSK(1) = "2"
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPRHFCY","TRTACHSEL1","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog SA_STOFCY(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "FCY"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_STOFCY(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("FCY",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZSTOFCY
Onevent BEFORE_AREA Gosub AV_ZSTOFCY From W1PBENCHW1
Return

$AV_ZSTOFCY
If clalev([F:FCY])=0 : Local File FACILITY [FCY] : Endif
Call LECTURE("FCY",num$([M]STOFCY(indice)),"") From CONTOBJ
zc = [F:FCY]FCYNAM
Gosub _AFF
Return

$ON_CAD
Onevent INIT_AREA Call D_CAD(zc) From W1PBENCHW1
Return

Subprog D_CAD(VALEUR)
Variable Integer VALEUR
If varinit([M]CAD,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_EXTRCPDAT
Onevent CONTROL Call C_EXTRCPDAT(zc) From W1PBENCHW1
Onevent AFTER_CHANGE Gosub AMM_EXTRCPDAT From W1PBENCHW1
Onevent BEFORE_AREA Gosub AV_EXTRCPDAT From W1PBENCHW1
Return

$AV_EXTRCPDAT
Chgfmt [M]EXTRCPDAT(indice) With "D:"+GFMDAT
Gosub _AFF
Return

Subprog C_EXTRCPDAT(VALEUR)
Variable Date    VALEUR
## Action %OBLIG
If VALEUR=[0/0/0]
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "EXTRCPDAT" : GZNUM = 5336 : Endif
If !mkstat
 ## Action CTLJOU
 Call CTL_JOU(VALEUR,[F:FCY]UVYDAY,[F:FCY]UVYCOD,1) From CONTX3
 If mkstat : GERR = 1 : GZONE = "EXTRCPDAT" : GZNUM = 5336 : Endif
 If !mkstat
  ## Action STD
  Call C_EXTRCPDAT(VALEUR) From SUBPBW1
  If mkstat : GERR = 1 : GZONE = "EXTRCPDAT" : GZNUM = 5336 : Endif
 Endif
Endif
Gosub _AFF
End

$AMM_EXTRCPDAT
Call AM_EXTRCPDAT(zc)
If !mkstat & GOBJET
 zoncou = "EXTRCPDAT" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_EXTRCPDAT(VALEUR)
Variable Date    VALEUR
## Action STD
Call AM_EXTRCPDAT(VALEUR) From SUBPBW1
If mkstat : GERR = 1 : GZONE = "EXTRCPDAT" : GZNUM = 5336 : Endif
Gosub _AFF
End

$ON_PUU
Return

$ON_QTYUOM
Onevent BEFORE_AREA Gosub AV_QTYUOM From W1PBENCHW1
Onevent BEFORE_INPUT Call AS_QTYUOM(zc) From W1PBENCHW1
Onevent AFTER_CHANGE Gosub AMM_QTYUOM From W1PBENCHW1
Onevent CONTROL Call C_QTYUOM(zc) From W1PBENCHW1
Return

$AV_QTYUOM
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find("",GUNITE(1..GNBUNT)),1))
Endif
Chgfmt [M]QTYUOM(indice) With "Nz:"+GUNTFMT
Gosub _AFF
Return

Subprog AS_QTYUOM(VALEUR)
Variable Decimal VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(454,GBOUT1) From OBJDIV
Call TEXTE(454,GBOUT2) From OBJDIV
## Action STD
Call AS_QTYUOM(VALEUR) From SUBPBW1
If mkstat=2
 [M]QTYUOM(INDIC) = VALEUR
 Affzo QTYUOM(INDIC) : mkstat = 2
Endif
Onkey 129 Titled GBOUT1 Call B1_QTYUOM(zc) From W1PBENCHW1
Onkey 130 Titled GBOUT2 Call B2_QTYUOM(zc) From W1PBENCHW1
Gosub _AFF
End

Subprog C_QTYUOM(VALEUR)
Variable Decimal VALEUR
## Action %OBLIG
If VALEUR=0
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "QTYUOM" : GZNUM = 4620 : Endif
Gosub _AFF
End

$AMM_QTYUOM
Call AM_QTYUOM(zc)
If !mkstat & GOBJET
 zoncou = "QTYUOM" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_QTYUOM(VALEUR)
Variable Decimal VALEUR
## Action PCALQTY
Call PCAL_QTY(VALEUR,[M]UOM,[M]QTYSTU,[M]STU,[M]ITMREF,[M]BPSNUM,1,GBIDD1) From TRTACHQTE1
If mkstat : GERR = 1 : GZONE = "QTYUOM" : GZNUM = 4620 : Endif
If !mkstat
 ## Action STD
 Call AM_QTYUOM(VALEUR) From SUBPBW1
 If mkstat : GERR = 1 : GZONE = "QTYUOM" : GZNUM = 4620 : Endif
Endif
Gosub _AFF
End

Subprog B1_QTYUOM(VALEUR)
Variable Decimal VALEUR
If !GWEBSERV
 ## Action CONSSFC
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "CONSSFC"
 Local Char ACTION(20), PROGSUB(GLONADC), PROGSPE(GLONADC), PROGSPV(GLONADC)
 ACTION = "AB1_QTYUOM" : PROGSUB = "SUBPBW1" : PROGSPE = "SPEPBW1" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 PARMSK(1) = "0"
 PARMSK(2) = [M]STOFCY
 PARMSK(3) = [M]ITMREF
 PARMSK(4) = ""
 Call CONSULT_NUM(VALEUR,"SFC",PARMSK) From GCONSULT
 ACTION = "BB1_QTYUOM" : PROGSUB = "SUBPBW1" : PROGSPE = "SPEPBW1" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B2_QTYUOM(VALEUR)
Variable Decimal VALEUR
If !GWEBSERV
 ## Action GOBJETC0
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "GOBJETC0"
 Local Char    OBJCLE(30)
 OBJCLE = [M]VCRNUM
 Call OBJET_CHAR(OBJCLE,[M]CODOBJ,num$([M]VCRLIN)) From GOBJET
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

$ON_UOM
Onevent BEFORE_INPUT Call AS_UOM(zc) From W1PBENCHW1
Onevent CONTROL Call C_UOM(zc) From W1PBENCHW1
Onevent AFTER_AREA Call AP_UOM(zc) From W1PBENCHW1
Onevent AFTER_CHANGE Gosub AMM_UOM From W1PBENCHW1
Return

Subprog AS_UOM(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
## Action STD
Call AS_UOM(VALEUR) From SUBPBW1
If mkstat=2
 [M]UOM(INDIC) = VALEUR
 Affzo UOM(INDIC) : mkstat = 2
Endif
Onkey   2 Titled GBOUTS Call S_UOM(zc) From W1PBENCHW1
Onkey 144 Titled GBOUTP Call P_UOM(zc) From W1PBENCHW1
Onkey 146 Titled GBOUTA Call SA_UOM(zc) From W1PBENCHW1
Gosub _AFF
End

Subprog C_UOM(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "UOM" : GZNUM = 0 : Endif
If !mkstat
 ## Action %CNTOBJ
 Call CONTSEL("TUN","",VALEUR,"",mkstat) From CONTOBJ
 If mkstat : GERR = 1 : GZONE = "UOM" : GZNUM = 0 : Endif
 If !mkstat
  ## Action PCOUOM
  Call PCOUOM(VALEUR,[M:PBW1]BPSNUM,[M:PBW1]ITMREF,3,5) From TRTACHCTL1
  If mkstat : GERR = 1 : GZONE = "UOM" : GZNUM = 0 : Endif
  If !mkstat
   ## Action STD
   Call C_UOM(VALEUR) From SUBPBW1
   If mkstat : GERR = 1 : GZONE = "UOM" : GZNUM = 0 : Endif
  Endif
 Endif
Endif
Gosub _AFF
End

Subprog AP_UOM(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AP_UOM(VALEUR) From SUBPBW1
If mkstat : GERR = 1 : GZONE = "UOM" : GZNUM = 0 : Endif
Gosub _AFF
End

$AMM_UOM
Call AM_UOM(zc)
If !mkstat & GOBJET
 zoncou = "UOM" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_UOM(VALEUR)
Variable Char    VALEUR()
If !mkstat & evalue("dim("+clanam([M])+"ZUOM)")>indice
 [M]UOM(indice) = VALEUR
 Affzo ZUOM(indice)
Endif
Gosub _AFF
End

Subprog S_UOM(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELPUOM
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELPUOM"
 PARMSK(1) = [M:PBW1]BPSNUM
 PARMSK(2) = [M:PBW1]ITMREF
 PARMSK(3) = "3"
 PARMSK(4) = "5"
 Call S_LIS_CHAR(VALEUR,PARMSK,"SELPUOM","TRTACHSEL1","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog SA_UOM(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "TUN"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_UOM(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("TUN",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZUOM
Onevent BEFORE_AREA Gosub AV_ZUOM From W1PBENCHW1
Return

$AV_ZUOM
Call LECTEXTRA(zc,"TABUNIT","DES",num$([M]UOM(indice)),"") From ATEXTRA
Gosub _AFF
Return

$ON_QTYSTU
Onevent BEFORE_AREA Gosub AV_QTYSTU From W1PBENCHW1
Onevent AFTER_AREA Call AP_QTYSTU(zc) From W1PBENCHW1
Onevent AFTER_CHANGE Gosub AMM_QTYSTU From W1PBENCHW1
Onevent CONTROL Call C_QTYSTU(zc) From W1PBENCHW1
Return

$AV_QTYSTU
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]STU,GUNITE(1..GNBUNT)),1))
Endif
Chgfmt [M]QTYSTU(indice) With "N+z:"+GUNTFMT
Gosub _AFF
Return

Subprog C_QTYSTU(VALEUR)
Variable Decimal VALEUR
## Action %OBLIG
If VALEUR=0
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "QTYSTU" : GZNUM = 2602 : Endif
Gosub _AFF
End

Subprog AP_QTYSTU(VALEUR)
Variable Decimal VALEUR
## Action PCALQTY
Call PCAL_QTY(VALEUR,[M]STU,[M]QTYUOM,[M]UOM,[M]ITMREF,[M]BPSNUM,1,GBIDD1) From TRTACHQTE1
If mkstat : GERR = 1 : GZONE = "QTYSTU" : GZNUM = 2602 : Endif
Gosub _AFF
End

$AMM_QTYSTU
Call AM_QTYSTU(zc)
If !mkstat & GOBJET
 zoncou = "QTYSTU" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_QTYSTU(VALEUR)
Variable Decimal VALEUR
If !GWEBSERV
 ## Action STD
 Call AM_QTYSTU(VALEUR) From SUBPBW1
 If mkstat : GERR = 1 : GZONE = "QTYSTU" : GZNUM = 2602 : Endif
Endif
Gosub _AFF
End

$ON_STU
Return

$ON_ORDQTYPUU
Onevent BEFORE_AREA Gosub AV_ORDQTYPUU From W1PBENCHW1
Return

$AV_ORDQTYPUU
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]PUU,GUNITE(1..GNBUNT)),1))
Endif
Gosub _AFF
Return

$ON_ITMWEI
Onevent BEFORE_AREA Gosub AV_ITMWEI From W1PBENCHW1
Return

$AV_ITMWEI
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]WEU,GUNITE(1..GNBUNT)),1))
Endif
Gosub _AFF
Return

$ON_WEU
Return

$ON_ITMVOL
Onevent BEFORE_AREA Gosub AV_ITMVOL From W1PBENCHW1
Return

$AV_ITMVOL
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]VOU,GUNITE(1..GNBUNT)),1))
Endif
Gosub _AFF
Return

$ON_VOU
Return

$ON_PURBASPRI
Onevent BEFORE_AREA Gosub AV_PURBASPRI From W1PBENCHW1
Return

$AV_PURBASPRI
## Action PARDEV
Gosub _AFF
Return

$ON_BPSNUM
Onevent CONTROL Call C_BPSNUM(zc) From W1PBENCHW1
Onevent BEFORE_AREA Gosub AV_BPSNUM From W1PBENCHW1
Onevent BEFORE_INPUT Call AS_BPSNUM(zc) From W1PBENCHW1
Onevent AFTER_CHANGE Gosub AMM_BPSNUM From W1PBENCHW1
Return

$AV_BPSNUM
## Action STD
Call AV_BPSNUM(zc) From SUBPBW1
Gosub _AFF
Return

Subprog AS_BPSNUM(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(1515,GBOUT1) From OBJDIV
Call TEXTE(16086,GBOUT2) From OBJDIV
Call TEXTE(16098,GBOUT3) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
## Action STD
Call AS_BPSNUM(VALEUR) From SUBPBW1
If mkstat=2
 [M]BPSNUM(INDIC) = VALEUR
 Affzo BPSNUM(INDIC) : mkstat = 2
Endif
Onkey 129 Titled GBOUT1 Call B1_BPSNUM(zc) From W1PBENCHW1
Onkey 130 Titled GBOUT2 Call B2_BPSNUM(zc) From W1PBENCHW1
Onkey 131 Titled GBOUT3 Call B3_BPSNUM(zc) From W1PBENCHW1
Onkey   2 Titled GBOUTS Call S_BPSNUM(zc) From W1PBENCHW1
Onkey 144 Titled GBOUTP Call P_BPSNUM(zc) From W1PBENCHW1
Onkey 146 Titled GBOUTA Call SA_BPSNUM(zc) From W1PBENCHW1
Gosub _AFF
End

Subprog C_BPSNUM(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action BPSCHOICE
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "BPSCHOICE"
 Call S_TAB_CHAR(VALEUR,PARMSK,"BPSCHOICE","TRTSEL","") From GACTION
 GACTION = SAVACT
 If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
Endif
If !mkstat
 ## Action %CNTOBJ
 Call CONTSEL("BPS","!AB",VALEUR,"",mkstat) From CONTOBJ
 If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
 If !mkstat
  ## Action CTLBPRCPY
  Call CTLBPRCPY(VALEUR,[M]PSHFCY) From CONTX3
  If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
  If !mkstat
   ## Action STD
   Call C_BPSNUM(VALEUR) From SUBPBW1
   If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
  Endif
 Endif
Endif
Gosub _AFF
End

$AMM_BPSNUM
Call AM_BPSNUM(zc)
If !mkstat & GOBJET
 zoncou = "BPSNUM" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_BPSNUM(VALEUR)
Variable Char    VALEUR()
## Action PAMBPSNUM
Call AM_BPSNUM(VALEUR) From TRTACHCTL1
If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
If !mkstat
 ## Action STD
 Call AM_BPSNUM(VALEUR) From SUBPBW1
 If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
 If !mkstat & evalue("dim("+clanam([M])+"ZBPSNUM)")>indice
  [M]BPSNUM(indice) = VALEUR
  Affzo ZBPSNUM(indice)
 Endif
Endif
Gosub _AFF
End

Subprog S_BPSNUM(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16)
PARMSK(1) = "BPS"
PARMSK(2) = "!AB"
Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJ","SELOBJ","") From GACTION
Gosub _AFF
End

Subprog B1_BPSNUM(VALEUR)
Variable Char    VALEUR()
Call OBJET("BPS",VALEUR,"") From GOBJET
Gosub _AFF
End

Subprog B2_BPSNUM(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELBPSITM
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELBPSITM"
 PARMSK(1) = [M]ITMREF
 Call SAISIE_CHAR(VALEUR,PARMSK,"IITPW","TRTACHSEL1","XWIITPW") From GSAISIE
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B3_BPSNUM(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action VISUPLP2
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "VISUPLP2"
 PARMSK(1) = VALEUR
 PARMSK(2) = [M]ITMREF
 Call SAISIE_CHAR(VALEUR,PARMSK,"IPLP2","TRTACHFEN1","XWIPLP2") From GSAISIE
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog SA_BPSNUM(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "BPS"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_BPSNUM(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("BPS",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZBPSNUM
Onevent BEFORE_AREA Gosub AV_ZBPSNUM From W1PBENCHW1
Return

$AV_ZBPSNUM
If clalev([F:BPS])=0 : Local File BPSUPPLIER [BPS] : Endif
Call LECTURE("BPS",num$([M]BPSNUM(indice)),"") From CONTOBJ
zc = [F:BPS]BPSSHO
Gosub _AFF
Return

$ON_POCNUM
Return

$ON_PJT
Onevent BEFORE_INPUT Call AS_PJT(zc) From W1PBENCHW1
Onevent CONTROL Call C_PJT(zc) From W1PBENCHW1
Onevent AFTER_CHANGE Gosub AMM_PJT From W1PBENCHW1
Return

Subprog IB_PJT(VALEUR)
Variable Char    VALEUR()
## Action PJTINIBUT
Call PJT_INIT_BUTTON(VALEUR,"PBW1","PJT",0,7,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
&,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,"",""
&,"","","","") From TRTPJT
Gosub _AFF
End

Subprog AS_PJT(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(43841,GBOUT1) From OBJDIV
Call TEXTE(14667,GBOUT2) From OBJDIV
Call TEXTE(54273,GBOUT3) From OBJDIV
Call TEXTE(43844,GBOUT4) From OBJDIV
Call TEXTE(43868,GBOUT15) From OBJDIV
Call TEXTE(17676,GBOUT16) From OBJDIV
Call TEXTE(54274,GBOUT17) From OBJDIV
Call TEXTE(54275,GBOUT18) From OBJDIV
Call TEXTE(11781,GBOUT19) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_PJT(VALEUR)
## Action PJTBEFZON
Call PJT_BEFORE_ZONE(VALEUR,"PBW1","PJT",0,7,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
&,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,"",""
&,"","","","") From TRTPJT
If mkstat=2
 [M]PJT(INDIC) = VALEUR
 Affzo PJT(INDIC) : mkstat = 2
Endif
Onkey 129 Titled GBOUT1 Call B1_PJT(zc) From W1PBENCHW1
Onkey 130 Titled GBOUT2 Call B2_PJT(zc) From W1PBENCHW1
Onkey 131 Titled GBOUT3 Call B3_PJT(zc) From W1PBENCHW1
Onkey 132 Titled GBOUT4 Call B4_PJT(zc) From W1PBENCHW1
Onkey 172 Titled GBOUT15 Call B15_PJT(zc) From W1PBENCHW1
Onkey 173 Titled GBOUT16 Call B16_PJT(zc) From W1PBENCHW1
Onkey 174 Titled GBOUT17 Call B17_PJT(zc) From W1PBENCHW1
Onkey 175 Titled GBOUT18 Call B18_PJT(zc) From W1PBENCHW1
Onkey 176 Titled GBOUT19 Call B19_PJT(zc) From W1PBENCHW1
Onkey   2 Titled GBOUTS Call S_PJT(zc) From W1PBENCHW1
Onkey 144 Titled GBOUTP Call P_PJT(zc) From W1PBENCHW1
Onkey 146 Titled GBOUTA Call SA_PJT(zc) From W1PBENCHW1
Gosub _AFF
End

Subprog C_PJT(VALEUR)
Variable Char    VALEUR()
## Action PJTCTL
Call PJT_CONTROL(VALEUR,"PBW1","PJT",0,7,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
&,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,"",""
&,"","","","") From TRTPJT
If mkstat : GERR = 1 : GZONE = "PJT" : GZNUM = 1886 : Endif
If !mkstat
 ## Action CONTOBJN
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "CONTOBJN"
 Call S_AFF_CHAR(VALEUR,PARMSK,"CONTOBJN","CONTOBJ","") From GACTION
 GACTION = SAVACT
 If mkstat : GERR = 1 : GZONE = "PJT" : GZNUM = 1886 : Endif
Endif
Gosub _AFF
End

$AMM_PJT
Call AM_PJT(zc)
If !mkstat & GOBJET
 zoncou = "PJT" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_PJT(VALEUR)
Variable Char    VALEUR()
## Action PJTAFTMOD
Call PJT_AFTER_MODIFY(VALEUR,"PBW1","PJT",0,7,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
&,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,"",""
&,"","","","") From TRTPJT
If mkstat : GERR = 1 : GZONE = "PJT" : GZNUM = 1886 : Endif
Gosub _AFF
End

Subprog S_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBUT
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBUT"
 PARMSK(1) = "PBW1"
 PARMSK(2) = "PJT"
 PARMSK(3) = "0"
 PARMSK(4) = "7"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = ""
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = ""
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJT","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B1_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTBU1CRM
 Call PJT_BUT1_CRM(VALEUR,"PBW1","PJT",0,7,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
& ,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,"",""
& ,"","","","") From TRTPJT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B2_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTBU2PRP
 Call PJT_BUT2_PRP(VALEUR,"PBW1","PJT",0,7,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
& ,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,"",""
& ,"","","","") From TRTPJT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B3_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTBU3BUD
 Call PJT_BUT3_PRPBUD(VALEUR,"PBW1","PJT",0,7,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
& ,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,"",""
& ,"","","","") From TRTPJT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B4_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTBU4TAC
 Call PJT_BUT4_PRPTAC(VALEUR,"PBW1","PJT",0,7,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
& ,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,"",""
& ,"","","","") From TRTPJT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B15_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBCRM
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBCRM"
 PARMSK(1) = "PBW1"
 PARMSK(2) = "PJT"
 PARMSK(3) = "0"
 PARMSK(4) = "7"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = ""
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = ""
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTCRM","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B16_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBPRP
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBPRP"
 PARMSK(1) = "PBW1"
 PARMSK(2) = "PJT"
 PARMSK(3) = "0"
 PARMSK(4) = "7"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = ""
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = ""
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTPRP","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B17_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBBUD
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBBUD"
 PARMSK(1) = "PBW1"
 PARMSK(2) = "PJT"
 PARMSK(3) = "0"
 PARMSK(4) = "7"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = ""
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = ""
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTBUD","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B18_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBTAC
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBTAC"
 PARMSK(1) = "PBW1"
 PARMSK(2) = "PJT"
 PARMSK(3) = "0"
 PARMSK(4) = "7"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = ""
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = ""
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTTAC","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B19_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBBPR
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBBPR"
 PARMSK(1) = "PBW1"
 PARMSK(2) = "PJT"
 PARMSK(3) = "0"
 PARMSK(4) = "7"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = ""
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = ""
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTBPR","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog SA_PJT(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "PIM"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_PJT(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("PIM",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_LINCLEFLG
Onevent INIT_AREA Call D_LINCLEFLG(zc) From W1PBENCHW1
Return

Subprog D_LINCLEFLG(VALEUR)
Variable Integer VALEUR
If varinit([M]LINCLEFLG,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_LINORDFLG
Onevent INIT_AREA Call D_LINORDFLG(zc) From W1PBENCHW1
Return

Subprog D_LINORDFLG(VALEUR)
Variable Integer VALEUR
If varinit([M]LINORDFLG,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_MRPMES
Onevent INIT_AREA Call D_MRPMES(zc) From W1PBENCHW1
Return

Subprog D_MRPMES(VALEUR)
Variable Integer VALEUR
If varinit([M]MRPMES,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_MRPQTY
Onevent BEFORE_AREA Gosub AV_MRPQTY From W1PBENCHW1
Return

$AV_MRPQTY
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]STU,GUNITE(1..GNBUNT)),1))
Endif
Gosub _AFF
Return

$ON_TCTRNUM
Onevent AFTER_CHANGE Gosub AMM_TCTRNUM From W1PBENCHW1
Onevent CONTROL Call C_TCTRNUM(zc) From W1PBENCHW1
Onevent BEFORE_INPUT Call AS_TCTRNUM(zc) From W1PBENCHW1
Return

Subprog AS_TCTRNUM(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Onkey   2 Titled GBOUTS Call S_TCTRNUM(zc) From W1PBENCHW1
Onkey 144 Titled GBOUTP Call P_TCTRNUM(zc) From W1PBENCHW1
Onkey 146 Titled GBOUTA Call SA_TCTRNUM(zc) From W1PBENCHW1
Gosub _AFF
End

Subprog C_TCTRNUM(VALEUR)
Variable Char    VALEUR()
## Action %CNTOBJ
Call CONTSEL("TCTR","!",VALEUR,"",mkstat) From CONTOBJ
If mkstat : GERR = 1 : GZONE = "TCTRNUM" : GZNUM = 52437 : Endif
Gosub _AFF
End

$AMM_TCTRNUM
Call AM_TCTRNUM(zc)
If !mkstat & GOBJET
 zoncou = "TCTRNUM" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_TCTRNUM(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_TCTRNUM(VALEUR) From SUBPBW1
If mkstat : GERR = 1 : GZONE = "TCTRNUM" : GZNUM = 52437 : Endif
If !mkstat & evalue("dim("+clanam([M])+"ZTCTRNUM)")>indice
 [M]TCTRNUM(indice) = VALEUR
 Affzo ZTCTRNUM(indice)
Endif
Gosub _AFF
End

Subprog S_TCTRNUM(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16)
PARMSK(1) = "TCTR"
PARMSK(2) = "!"
Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJ","SELOBJ","") From GACTION
Gosub _AFF
End

Subprog SA_TCTRNUM(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "TCTR"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_TCTRNUM(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("TCTR",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZTCTRNUM
Onevent BEFORE_AREA Gosub AV_ZTCTRNUM From W1PBENCHW1
Return

$AV_ZTCTRNUM
Call LECTEXTRA(zc,"TABCONTAINER","DESAXX",num$([M]TCTRNUM(indice)),"") From ATEXTRA
Gosub _AFF
Return

$ON_WEICAP
Onevent BEFORE_AREA Gosub AV_WEICAP From W1PBENCHW1
Onevent AFTER_CHANGE Gosub AMM_WEICAP From W1PBENCHW1
Onevent CONTROL Call C_WEICAP(zc) From W1PBENCHW1
Return

$AV_WEICAP
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]TCTRWEU,GUNITE(1..GNBUNT)),1))
Endif
Chgfmt [M]WEICAP(indice) With "N+z:"+GUNTFMT
Gosub _AFF
Return

Subprog C_WEICAP(VALEUR)
Variable Decimal VALEUR
Gosub _AFF
End

$AMM_WEICAP
Call AM_WEICAP(zc)
If !mkstat & GOBJET
 zoncou = "WEICAP" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_WEICAP(VALEUR)
Variable Decimal VALEUR
## Action STD
Call AM_WEICAP(VALEUR) From SUBPBW1
If mkstat : GERR = 1 : GZONE = "WEICAP" : GZNUM = 3634 : Endif
Gosub _AFF
End

$ON_TCTRQTY
Onevent AFTER_CHANGE Gosub AMM_TCTRQTY From W1PBENCHW1
Onevent CONTROL Call C_TCTRQTY(zc) From W1PBENCHW1
Return

Subprog C_TCTRQTY(VALEUR)
Variable Decimal VALEUR
Gosub _AFF
End

$AMM_TCTRQTY
Call AM_TCTRQTY(zc)
If !mkstat & GOBJET
 zoncou = "TCTRQTY" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_TCTRQTY(VALEUR)
Variable Decimal VALEUR
## Action STD
Call AM_TCTRQTY(VALEUR) From SUBPBW1
If mkstat : GERR = 1 : GZONE = "TCTRQTY" : GZNUM = 53913 : Endif
Gosub _AFF
End

$ON_VOLCAP
Onevent BEFORE_AREA Gosub AV_VOLCAP From W1PBENCHW1
Onevent AFTER_CHANGE Gosub AMM_VOLCAP From W1PBENCHW1
Onevent CONTROL Call C_VOLCAP(zc) From W1PBENCHW1
Return

$AV_VOLCAP
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]TCTRVOU,GUNITE(1..GNBUNT)),1))
Endif
Chgfmt [M]VOLCAP(indice) With "N+z:"+GUNTFMT
Gosub _AFF
Return

Subprog C_VOLCAP(VALEUR)
Variable Decimal VALEUR
Gosub _AFF
End

$AMM_VOLCAP
Call AM_VOLCAP(zc)
If !mkstat & GOBJET
 zoncou = "VOLCAP" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_VOLCAP(VALEUR)
Variable Decimal VALEUR
## Action STD
Call AM_VOLCAP(VALEUR) From SUBPBW1
If mkstat : GERR = 1 : GZONE = "VOLCAP" : GZNUM = 1072 : Endif
Gosub _AFF
End

$ON_WEITOT
Onevent BEFORE_AREA Gosub AV_WEITOT From W1PBENCHW1
Return

$AV_WEITOT
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]TCTRWEU,GUNITE(1..GNBUNT)),1))
Endif
Chgfmt [M]WEITOT(indice) With "NPz:"+GUNTFMT
Gosub _AFF
Return

$ON_VOLTOT
Onevent BEFORE_AREA Gosub AV_VOLTOT From W1PBENCHW1
Return

$AV_VOLTOT
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]TCTRVOU,GUNITE(1..GNBUNT)),1))
Endif
Chgfmt [M]VOLTOT(indice) With "NPz:"+GUNTFMT
Gosub _AFF
Return

$ON_WEIAVL
Onevent BEFORE_AREA Gosub AV_WEIAVL From W1PBENCHW1
Return

$AV_WEIAVL
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]TCTRWEU,GUNITE(1..GNBUNT)),1))
Endif
Chgfmt [M]WEIAVL(indice) With "NPz:"+GUNTFMT
Gosub _AFF
Return

$CHG_STY
Gosub CHG_STY From W2PBENCHW1
Return

$TIT_COL
Gosub TIT_COL From W2PBENCHW1
Return


