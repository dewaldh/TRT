#<AdxTL>@(#)0.0.0.0 $Revision:   1.1  $
 
#########################################################################
## Publication d'un web-service associé à un sous-programme
## Nom de Programme         : YPJMCST
## Nom de Sous-programme    : YPJMCST
## Nom de Publication       : YPCST_V001
## Timestamp de génération  : 20181029191917
## Version de génération    : 6.30
#########################################################################
 
 
Local Integer WW_OK
Local Char    WW_ZONE(30)
Local Integer WW_STAT
Local Integer WW_GRAVE(1..50)
Local Char    WW_MESS(250)(1..50)
Local Char WW_ACTION
Local Char    WW_IDENT(250)
Local Integer WW_NB
Local Char    WW_HORDAT(14)
Local Char    WW_TAB(20)
Local Char    WW_PAR(80)(1..10)
Local Clbfile WW_TRACE(1)
WW_HORDAT="20181029191917"
Local Char YACTION(250)
Local Char YOPPNUM(250)
Local Char YPBUFCYX(250)(1..1000)
Local Char YOPPNUMX(250)(1..1000)
Local Char YPBUCODX(250)(1..1000)
Local Char YPBUPAEX(250)(1..1000)
Local Integer YPBUSTATEX(1..1000)
Local Integer YPBUELEX(1..1000)
Local Integer YPBUIMPX(1..1000)
Local Char YCURX(250)(1..1000)
Local Date YPBUSTARTDTX(1..1000)
Local Date YPBUENDDTX(1..1000)
Local Integer YOPPIMPTX(1..1000)
Local Char YPCCCODX(250)(1..1000)
Local Char YPLBFCYX(250)(1..1000)
Local Char YPLBDESAXXX(250)(1..1000)
Local Char YPLBUX(250)(1..1000)
Local Integer YPLBQTYX(1..1000)
Local Integer YPLBPRIX(1..1000)
Local Decimal YPLBAMTX(1..1000)
Local Date YPLBDATBUDX(1..1000)
Local Integer YPLBFLGREMX(1..1000)
Local Integer YPLBQTYREMX(1..1000)
Local Integer YPLBPRIREMX(1..1000)
Local Integer YPLBQTYESTX(1..1000)
Local Decimal YPLBAMTESTX(1..1000)
Local Integer YPLBQTYRECX(1..1000)
Local Decimal YPLBAMTRECX(1..1000)
Local Integer YTCHOPPIMPTX(1..1000)
Local Date YTCHPBUSTRDTX(1..1000)
Local Char YPIMDESAXXX(250)(1..1000)
Local Char YTASCODX(250)(1..1000)
Local Integer YPIMTYPX(1..1000)
Local Integer YPIMSTAX(1..1000)
Local Integer YOPPSTATEX(1..1000)
 
 
Call OUVRE_TRACE("") From LECFIC
 
Onerrgo ERREURWS
Gosub INITWS From YPJMCST
Onerrgo
 
Call YPJMCST(WW_OK,WW_ZONE,WW_STAT,WW_GRAVE,WW_MESS,WW_ACTION,WW_IDENT,WW_NB,WW_HORDAT,WW_TAB,WW_PAR,WW_TRACE
&            ,YACTION,YOPPNUM,YPBUFCYX,YOPPNUMX,YPBUCODX
&            ,YPBUPAEX,YPBUSTATEX,YPBUELEX,YPBUIMPX,YCURX
&            ,YPBUSTARTDTX,YPBUENDDTX,YOPPIMPTX,YPCCCODX,YPLBFCYX
&            ,YPLBDESAXXX,YPLBUX,YPLBQTYX,YPLBPRIX,YPLBAMTX
&            ,YPLBDATBUDX,YPLBFLGREMX,YPLBQTYREMX,YPLBPRIREMX,YPLBQTYESTX
&            ,YPLBAMTESTX,YPLBQTYRECX,YPLBAMTRECX,YTCHOPPIMPTX,YTCHPBUSTRDTX
&            ,YPIMDESAXXX,YTASCODX,YPIMTYPX,YPIMSTAX,YOPPSTATEX)
 
Call ECR_TRACE(mess(218,123,1)+" : "+num$(WW_OK)-"("+mess(WW_OK+3,2940,1)+")",0) From GESECRAN
Call ECR_TRACE(mess(219,123,1)+" : "+num$(WW_STAT),0) From GESECRAN
Call ECR_TRACE("  ",0) From GESECRAN
Call ECR_TRACE(mess(222,123,1),0) From GESECRAN
Call ECR_TRACE("-------------------------------------------",0) From GESECRAN
For indice=1 To WW_STAT
  If WW_GRAVE(indice)=3
    Call ECR_TRACE(num$(indice)-num$(WW_GRAVE(indice))+" ("+mess(WW_GRAVE(indice),2940,1)+") :"-WW_MESS(indice),1) From GESECRAN
  Else
    Call ECR_TRACE(num$(indice)-num$(WW_GRAVE(indice))+" ("+mess(WW_GRAVE(indice),2940,1)+") :"-WW_MESS(indice),0) From GESECRAN
  Endif
Next indice
If WW_STAT=0 : Call ECR_TRACE("",0) From GESECRAN : Endif
Call ECR_TRACE("-------------------------------------------",0) From GESECRAN
Onerrgo ERREURWS
Gosub RESULTWS From YPJMCST
Onerrgo
 
Call FERME_TRACE From LECFIC
Call LEC_TRACE From LECFIC
End
 
 
$ERREURWS
Resume
 
 
# --------------------------------------------------------------- 
 
Subprog YPJMCST(WW_OK,WW_ZONE,WW_STAT,WW_GRAVE,WW_MESS,WW_ACTION,WW_IDENT,WW_NB,WW_HORDAT,WW_TAB,WW_PAR,WW_TRACE
&            ,YACTION,YOPPNUM,YPBUFCYX,YOPPNUMX,YPBUCODX
&            ,YPBUPAEX,YPBUSTATEX,YPBUELEX,YPBUIMPX,YCURX
&            ,YPBUSTARTDTX,YPBUENDDTX,YOPPIMPTX,YPCCCODX,YPLBFCYX
&            ,YPLBDESAXXX,YPLBUX,YPLBQTYX,YPLBPRIX,YPLBAMTX
&            ,YPLBDATBUDX,YPLBFLGREMX,YPLBQTYREMX,YPLBPRIREMX,YPLBQTYESTX
&            ,YPLBAMTESTX,YPLBQTYRECX,YPLBAMTRECX,YTCHOPPIMPTX,YTCHPBUSTRDTX
&            ,YPIMDESAXXX,YTASCODX,YPIMTYPX,YPIMSTAX,YOPPSTATEX)
 
Variable Integer WW_OK
Variable Char    WW_ZONE()
Variable Integer WW_STAT
Variable Integer WW_GRAVE(1..)
Variable Char    WW_MESS()(1..)
Value Char       WW_ACTION
Value Char       WW_IDENT()
Variable Integer WW_NB
Variable Char    WW_HORDAT()
Variable Char    WW_TAB()
Variable Char    WW_PAR()(1..)
Variable Clbfile WW_TRACE()
Value Char YACTION()
Value Char YOPPNUM()
Variable Char YPBUFCYX()(1..)
Variable Char YOPPNUMX()(1..)
Variable Char YPBUCODX()(1..)
Variable Char YPBUPAEX()(1..)
Variable Integer YPBUSTATEX(1..)
Variable Integer YPBUELEX(1..)
Variable Integer YPBUIMPX(1..)
Variable Char YCURX()(1..)
Variable Date YPBUSTARTDTX(1..)
Variable Date YPBUENDDTX(1..)
Variable Integer YOPPIMPTX(1..)
Variable Char YPCCCODX()(1..)
Variable Char YPLBFCYX()(1..)
Variable Char YPLBDESAXXX()(1..)
Variable Char YPLBUX()(1..)
Variable Integer YPLBQTYX(1..)
Variable Integer YPLBPRIX(1..)
Variable Decimal YPLBAMTX(1..)
Variable Date YPLBDATBUDX(1..)
Variable Integer YPLBFLGREMX(1..)
Variable Integer YPLBQTYREMX(1..)
Variable Integer YPLBPRIREMX(1..)
Variable Integer YPLBQTYESTX(1..)
Variable Decimal YPLBAMTESTX(1..)
Variable Integer YPLBQTYRECX(1..)
Variable Decimal YPLBAMTRECX(1..)
Variable Integer YTCHOPPIMPTX(1..)
Variable Date YTCHPBUSTRDTX(1..)
Variable Char YPIMDESAXXX()(1..)
Variable Char YTASCODX()(1..)
Variable Integer YPIMTYPX(1..)
Variable Integer YPIMSTAX(1..)
Variable Integer YOPPSTATEX(1..)
 
 
WW_OK=0
Gosub ISDBGON from AWEB
If WW_OK<>0 : End : Endif
Local Char HORDAT1(14)
Local Integer WW_I
Local Char HORDATG(14),VERGEN
HORDATG="20181029191917"
VERGEN="6.30"
Call RECUPHDAT("YPCST_V001",HORDAT1,WW_I) from AWEB
Gosub ANLHORSPG From AWEB
If WW_OK<>0 : Gosub SETTRACE : End : Endif
GWEBSERV=1
indice=0
Raz GMESSAGE,GW_STAT,GW_MESS,GW_GRAVE
 
 
Local Char ALIAS : ALIAS="YPCST_V001"
Local Char ACTION
ACTION="AV_WS"
GPE=0
Onerrgo ERREURWS
Gosub ACTION From SPEWS
Onerrgo
If GPE<>1
Call YPJMCST(YACTION,YOPPNUM,YPBUFCYX,YOPPNUMX,YPBUCODX,
&            YPBUPAEX,YPBUSTATEX,YPBUELEX,YPBUIMPX,YCURX,
&            YPBUSTARTDTX,YPBUENDDTX,YOPPIMPTX,YPCCCODX,YPLBFCYX,
&            YPLBDESAXXX,YPLBUX,YPLBQTYX,YPLBPRIX,YPLBAMTX,
&            YPLBDATBUDX,YPLBFLGREMX,YPLBQTYREMX,YPLBPRIREMX,YPLBQTYESTX,
&            YPLBAMTESTX,YPLBQTYRECX,YPLBAMTRECX,YTCHOPPIMPTX,YTCHPBUSTRDTX,
&            YPIMDESAXXX,YTASCODX,YPIMTYPX,YPIMSTAX,YOPPSTATEX) From YPJMCST
 
 
Gosub ANLSPGRES From AWEB
Endif

ACTION="AP_WS"
Onerrgo ERREURWS
Gosub ACTION From SPEWS
Onerrgo
GWEBSERV=0
Gosub SETTRACE
End



$XT_SPG
Local Integer WIND : WIND =35
Local Char    PRG      :    PRG="YPJMCST"
Local Char    SUBPRG   :    SUBPRG="YPJMCST"
Local Integer RUBNBR   :    RUBNBR=WIND
Local Char    RUBCOD        (GLONAVA+2)(0..WIND-1 )
Local Char    RUBGRP        (GLONAPU)(0..WIND-1 )
Local Integer RUBINTIT      (0..WIND-1 )
Local Char    RUBTYP        (10)(0..WIND-1 )    :    # Internal type (example Char, Integer)
Local Integer RUBADR        (0..WIND-1 )
Local Integer RUBLON        (0..WIND-1 )
Local Integer RUBMNL        (0..WIND-1 )
Local Integer RUBDIM        (0..WIND-1 )
 
RUBCOD(0)="YACTION" : RUBGRP(0)="GRP1" : RUBINTIT(0)=0 : RUBTYP(0)="1" : RUBADR(0)=2 : RUBLON(0)=0 : RUBDIM(0)=1 : RUBMNL(0)=0
RUBCOD(1)="YOPPNUM" : RUBGRP(1)="GRP1" : RUBINTIT(1)=0 : RUBTYP(1)="1" : RUBADR(1)=2 : RUBLON(1)=0 : RUBDIM(1)=1 : RUBMNL(1)=0
RUBCOD(2)="YPBUFCYX" : RUBGRP(2)="GRP2" : RUBINTIT(2)=0 : RUBTYP(2)="1" : RUBADR(2)=1 : RUBLON(2)=0 : RUBDIM(2)=1000 : RUBMNL(2)=0
RUBCOD(3)="YOPPNUMX" : RUBGRP(3)="GRP2" : RUBINTIT(3)=0 : RUBTYP(3)="1" : RUBADR(3)=1 : RUBLON(3)=0 : RUBDIM(3)=1000 : RUBMNL(3)=0
RUBCOD(4)="YPBUCODX" : RUBGRP(4)="GRP2" : RUBINTIT(4)=0 : RUBTYP(4)="1" : RUBADR(4)=1 : RUBLON(4)=0 : RUBDIM(4)=1000 : RUBMNL(4)=0
RUBCOD(5)="YPBUPAEX" : RUBGRP(5)="GRP2" : RUBINTIT(5)=0 : RUBTYP(5)="1" : RUBADR(5)=1 : RUBLON(5)=0 : RUBDIM(5)=1000 : RUBMNL(5)=0
RUBCOD(6)="YPBUSTATEX" : RUBGRP(6)="GRP2" : RUBINTIT(6)=0 : RUBTYP(6)="2" : RUBADR(6)=1 : RUBLON(6)=0 : RUBDIM(6)=1000 : RUBMNL(6)=0
RUBCOD(7)="YPBUELEX" : RUBGRP(7)="GRP2" : RUBINTIT(7)=0 : RUBTYP(7)="2" : RUBADR(7)=1 : RUBLON(7)=0 : RUBDIM(7)=1000 : RUBMNL(7)=0
RUBCOD(8)="YPBUIMPX" : RUBGRP(8)="GRP2" : RUBINTIT(8)=0 : RUBTYP(8)="2" : RUBADR(8)=1 : RUBLON(8)=0 : RUBDIM(8)=1000 : RUBMNL(8)=0
RUBCOD(9)="YCURX" : RUBGRP(9)="GRP2" : RUBINTIT(9)=0 : RUBTYP(9)="1" : RUBADR(9)=1 : RUBLON(9)=0 : RUBDIM(9)=1000 : RUBMNL(9)=0
RUBCOD(10)="YPBUSTARTDTX" : RUBGRP(10)="GRP2" : RUBINTIT(10)=0 : RUBTYP(10)="4" : RUBADR(10)=1 : RUBLON(10)=0 : RUBDIM(10)=1000 : RUBMNL(10)=0
RUBCOD(11)="YPBUENDDTX" : RUBGRP(11)="GRP2" : RUBINTIT(11)=0 : RUBTYP(11)="4" : RUBADR(11)=1 : RUBLON(11)=0 : RUBDIM(11)=1000 : RUBMNL(11)=0
RUBCOD(12)="YOPPIMPTX" : RUBGRP(12)="GRP2" : RUBINTIT(12)=0 : RUBTYP(12)="2" : RUBADR(12)=1 : RUBLON(12)=0 : RUBDIM(12)=1000 : RUBMNL(12)=0
RUBCOD(13)="YPCCCODX" : RUBGRP(13)="GRP2" : RUBINTIT(13)=0 : RUBTYP(13)="1" : RUBADR(13)=1 : RUBLON(13)=0 : RUBDIM(13)=1000 : RUBMNL(13)=0
RUBCOD(14)="YPLBFCYX" : RUBGRP(14)="GRP2" : RUBINTIT(14)=0 : RUBTYP(14)="1" : RUBADR(14)=1 : RUBLON(14)=0 : RUBDIM(14)=1000 : RUBMNL(14)=0
RUBCOD(15)="YPLBDESAXXX" : RUBGRP(15)="GRP2" : RUBINTIT(15)=0 : RUBTYP(15)="1" : RUBADR(15)=1 : RUBLON(15)=0 : RUBDIM(15)=1000 : RUBMNL(15)=0
RUBCOD(16)="YPLBUX" : RUBGRP(16)="GRP2" : RUBINTIT(16)=0 : RUBTYP(16)="1" : RUBADR(16)=1 : RUBLON(16)=0 : RUBDIM(16)=1000 : RUBMNL(16)=0
RUBCOD(17)="YPLBQTYX" : RUBGRP(17)="GRP2" : RUBINTIT(17)=0 : RUBTYP(17)="2" : RUBADR(17)=1 : RUBLON(17)=0 : RUBDIM(17)=1000 : RUBMNL(17)=0
RUBCOD(18)="YPLBPRIX" : RUBGRP(18)="GRP2" : RUBINTIT(18)=0 : RUBTYP(18)="2" : RUBADR(18)=1 : RUBLON(18)=0 : RUBDIM(18)=1000 : RUBMNL(18)=0
RUBCOD(19)="YPLBAMTX" : RUBGRP(19)="GRP2" : RUBINTIT(19)=0 : RUBTYP(19)="3" : RUBADR(19)=1 : RUBLON(19)=0 : RUBDIM(19)=1000 : RUBMNL(19)=0
RUBCOD(20)="YPLBDATBUDX" : RUBGRP(20)="GRP2" : RUBINTIT(20)=0 : RUBTYP(20)="4" : RUBADR(20)=1 : RUBLON(20)=0 : RUBDIM(20)=1000 : RUBMNL(20)=0
RUBCOD(21)="YPLBFLGREMX" : RUBGRP(21)="GRP2" : RUBINTIT(21)=0 : RUBTYP(21)="2" : RUBADR(21)=1 : RUBLON(21)=0 : RUBDIM(21)=1000 : RUBMNL(21)=0
RUBCOD(22)="YPLBQTYREMX" : RUBGRP(22)="GRP2" : RUBINTIT(22)=0 : RUBTYP(22)="2" : RUBADR(22)=1 : RUBLON(22)=0 : RUBDIM(22)=1000 : RUBMNL(22)=0
RUBCOD(23)="YPLBPRIREMX" : RUBGRP(23)="GRP2" : RUBINTIT(23)=0 : RUBTYP(23)="2" : RUBADR(23)=1 : RUBLON(23)=0 : RUBDIM(23)=1000 : RUBMNL(23)=0
RUBCOD(24)="YPLBQTYESTX" : RUBGRP(24)="GRP2" : RUBINTIT(24)=0 : RUBTYP(24)="2" : RUBADR(24)=1 : RUBLON(24)=0 : RUBDIM(24)=1000 : RUBMNL(24)=0
RUBCOD(25)="YPLBAMTESTX" : RUBGRP(25)="GRP2" : RUBINTIT(25)=0 : RUBTYP(25)="3" : RUBADR(25)=1 : RUBLON(25)=0 : RUBDIM(25)=1000 : RUBMNL(25)=0
RUBCOD(26)="YPLBQTYRECX" : RUBGRP(26)="GRP2" : RUBINTIT(26)=0 : RUBTYP(26)="2" : RUBADR(26)=1 : RUBLON(26)=0 : RUBDIM(26)=1000 : RUBMNL(26)=0
RUBCOD(27)="YPLBAMTRECX" : RUBGRP(27)="GRP2" : RUBINTIT(27)=0 : RUBTYP(27)="3" : RUBADR(27)=1 : RUBLON(27)=0 : RUBDIM(27)=1000 : RUBMNL(27)=0
RUBCOD(28)="YTCHOPPIMPTX" : RUBGRP(28)="GRP2" : RUBINTIT(28)=0 : RUBTYP(28)="2" : RUBADR(28)=1 : RUBLON(28)=0 : RUBDIM(28)=1000 : RUBMNL(28)=0
RUBCOD(29)="YTCHPBUSTRDTX" : RUBGRP(29)="GRP2" : RUBINTIT(29)=0 : RUBTYP(29)="4" : RUBADR(29)=1 : RUBLON(29)=0 : RUBDIM(29)=1000 : RUBMNL(29)=0
RUBCOD(30)="YPIMDESAXXX" : RUBGRP(30)="GRP2" : RUBINTIT(30)=0 : RUBTYP(30)="1" : RUBADR(30)=1 : RUBLON(30)=0 : RUBDIM(30)=1000 : RUBMNL(30)=0
RUBCOD(31)="YTASCODX" : RUBGRP(31)="GRP2" : RUBINTIT(31)=0 : RUBTYP(31)="1" : RUBADR(31)=1 : RUBLON(31)=0 : RUBDIM(31)=1000 : RUBMNL(31)=0
RUBCOD(32)="YPIMTYPX" : RUBGRP(32)="GRP2" : RUBINTIT(32)=0 : RUBTYP(32)="2" : RUBADR(32)=1 : RUBLON(32)=0 : RUBDIM(32)=1000 : RUBMNL(32)=0
RUBCOD(33)="YPIMSTAX" : RUBGRP(33)="GRP2" : RUBINTIT(33)=0 : RUBTYP(33)="2" : RUBADR(33)=1 : RUBLON(33)=0 : RUBDIM(33)=1000 : RUBMNL(33)=0
RUBCOD(34)="YOPPSTATEX" : RUBGRP(34)="GRP2" : RUBINTIT(34)=0 : RUBTYP(34)="2" : RUBADR(34)=1 : RUBLON(34)=0 : RUBDIM(34)=1000 : RUBMNL(34)=0
Return
 
 
$SETTRACE
Local Char WPTRACE(200)(1..500)
Local Integer IT
Setlob WPTRACE(1..IT) With WW_TRACE
If instr(1,WPTRACE(1),"adonix.trace.on=on")=0 : Return : Endif
WPTRACE(1)="Engine version    : "+num$(ver$(0))+chr$(10)
WPTRACE(2)="Wrapper timestamp : "+num$(HORDATG)+chr$(10)
WPTRACE(3)="Wrapper version   : "+num$(VERGEN)+chr$(10)
WPTRACE(4)="Duration time     : "+num$(time-val(TSTART))+chr$(10)
WPTRACE(5)="WW_OK     : "+num$(WW_OK)+chr$(10)
WPTRACE(6)="WW_ZONE   : "+num$(WW_ZONE)+chr$(10)
WPTRACE(7)="WW_STAT   : "+num$(WW_STAT)+chr$(10)
IT=8
For indice=1 To WW_STAT
  WPTRACE(IT)="WW_GRAVE("+num$(indice)+")  : "+num$(WW_GRAVE(indice))+chr$(10)
  IT+=1 : WPTRACE(IT)="WW_MESS("+num$(indice)+")   : "+num$(WW_MESS(indice))+chr$(10)
  IT+=1
Next indice
IT+=1 : WPTRACE(IT)="WW_ACTION : "+num$(WW_ACTION)+chr$(10)
IT+=1 : WPTRACE(IT)="WW_IDENT  : "+num$(WW_IDENT)+chr$(10)
IT+=1 : WPTRACE(IT)="WW_NB     : "+num$(WW_NB)+chr$(10)
IT+=1 : WPTRACE(IT)="WW_HORDAT : "+num$(WW_HORDAT)+chr$(10)
IT+=1 : WPTRACE(IT)="WW_TAB    : "+num$(WW_TAB)+chr$(10)
IT+=1 : WPTRACE(IT)="WW_PAR    : "+num$(WW_PAR)+chr$(10)
Setlob WW_TRACE With WPTRACE(1..IT)
Return   
