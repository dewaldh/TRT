#<AdxTL>@(#)0.0.0.0 $Revision$
#  If clalev([F:TAX])    = 0 : Local File TABRATVAT    [TAX]     : Endif
#  If clalev([F:GAC])    = 0 : Local File GACCOUNT     [GAC]     : Endif
#  If clalev([F:TVT])    = 0 : Local File TABVAT       [TVT]     : Endif
#  If clalev([F:YELA])   = 0 : Local File YENTLOAAGR   [YELA]    : Endif
#  If clalev([F:YBDT])   = 0 : Local File YBBDETAILTEM [YBDT]    : Endif
#  If clalev([F:YBDT2])  = 0 : Local File YBBDETAILTEM [YBDT2]   : Endif
#
#  Local Char BATNBR(50) : BATNBR = "BB20181100004"
#
#  Local Char TAX_OVERRIDE(5), TAX_RULE(5)
#  Local Decimal NEW_GST, NEW_VATRAT, NEW_AMT
#  Local Integer I : I = 0
#  # -- IE Declarations
#  Local Char PREVFCYIE(5)
#  Local Char PREVGSTGRP(5)
#
#  For [F:YBDT] Where YBATNBR = BATNBR
#    I = [F:YBDT]YDETLIG
#    Read [F:YBDT2]YBDT1 = BATNBR;I
#    #Get Vat Rates
#    Read [F:TVT]TVT1 = [F:YBDT2]YTAX
#    NEW_VATRAT = [F:TVT]VATRAT
#    TAX_RULE = [F:TVT]VATVAC
#    #Check ACCOUNT IS DEFINED As SUBJECTED
#    Read [F:GAC]GAC0 = [F:YBDT2]YCOA;[F:YBDT2]YACC
#    If [F:GAC]FLGVAT = 2 Then
#      #SET TAX To null
#      [L]TAX_OVERRIDE = ""
#      TAX_RULE = ""
#    Else
#      #IE Transaction Type for GST Calc
#      If [F:YBDT2]YBATTYP = 1 Then
#        If PREVFCYIE = "" : PREVFCYIE = [F:YBDT2]YFCY : Endif
#        If PREVGSTGRP = "" : PREVGSTGRP = [F:YBDT2]YTAX : Endif
#        If PREVFCYIE <> "" and PREVGSTGRP <> "" and [F:YBDT2]YFCY <> PREVFCYIE and [F:YBDT2]YTAX = PREVGSTGRP Then
#          #THE BUSINESS TRANSACTION ARE MEMBERS OF THE SAME GST GROUP
#          [L]TAX_OVERRIDE = func AFNC.PARAM("YIEVAT","")
#        Elsif PREVFCYIE <> "" and PREVGSTGRP <> "" and [F:YBDT2]YFCY <> PREVFCYIE and [F:YBDT2]YTAX = PREVGSTGRP Then
#          [L]TAX_OVERRIDE = TAX_RULE
#        Endif
#        [F:YBDT2]YTAX = [L]TAX_OVERRIDE
#      Else
#        If [L]TAX_OVERRIDE <> "" Then
#          #CALCULATE THE GST and AMOUNT + TAX (As PER SECTION 6.1.17 GST CALCULATIONS)
#          If [F:YBDT2]YDEB <> 0 : [L]NEW_AMT = [F:YBDT2]YDEB : Endif
#          If [F:YBDT2]YCDT <> 0 : [L]NEW_AMT = [F:YBDT2]YCDT : Endif
#          If [F:YBDT2]YGSTINC = 2 Then #GST Inc
#            #GST Amount = Amount - Round(Amount/(1+(Rate/100)))
#            [L]NEW_GST = [L]NEW_AMT - (1+([L]NEW_VATRAT/100))
#            [F:YBDT2]YAMTTAX = [L]NEW_AMT + [L]NEW_GST
#          Else #GST Ex
#            #GST Amount = Amount * (Rate/100)
#            [L]NEW_GST = [L]NEW_AMT * ([L]NEW_VATRAT/100)
#            [F:YBDT2]YAMTTAX = [L]NEW_AMT - [L]NEW_GST
#          Endif
#        Else
#          [F:YBDT2]YAMTTAX = [L]NEW_AMT
#          [L]NEW_GST = 0
#        Endif
#        [F:YBDT2]YGSTAMT = [L]NEW_GST
#        If fstat = 0
#          Rewrite [F:YBDT2]
#        Else
#          Call ADDMESSERR("Critical error occured."-[V]CST_AERROR) From AWEB
#          Rollback
#          End
#        Endif
#      Endif
#    Endif
#  Next
#
#  If clalev([F:YELA]) = 0  : Close Local File [F:YELA] : Endif
#  If clalev([F:YBDT]) = 0  : Close Local File [F:YBDT] : Endif
#  If clalev([F:TAX])  = 0  : Close Local File [F:TAX]  : Endif
#  If clalev([F:GAC])  = 0  : Close Local File [F:GAC]  : Endif
#  If clalev([F:TVT])  = 0  : Close Local File [F:TVT]  : Endif
#

