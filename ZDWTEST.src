#<AdxTL>@(#)0.0.0.0 $Revision$

Call OUVRE_TRACE("Journal Integration") From LECFIC

Call ECR_TRACE("Start Date: " + num$(datetime$),0) From GESECRAN

NAME = "JNL" + format$("D:YYMMDDhhmmss",date$)

OPEN File To Write GL DATA For IMPORTING
Openo filpath('tmp',NAME,'DAT'),-1 Using [ZGL]

Iomode adxium 50 Using [ZGL]
Iomode adxirs chr$(13)+ chr$(10) Using [ZGL] # line seperator
Iomode adxifs ',' Using [ZGL] #field sperator
Write THE HEADER LINE:


              Call CREATE_GL_HEADER("ODP","",ZFCY,"ODP",num$([F:XX1]PYRDAT),num$([F:XX1]PYRDAT),"","ZAR","STDCO","","")

              Call CREATE_GL_DETAIL(num$(ZCOUNT+1),"1",num$(ZCOUNT+1),[F:XX1]HDFCY,"",[F:XX1]ACC,"","",num$([F:XX1]SNS),num$([F:XX1]AMOUNT),"ZAR")

    Close File BEFORE IMPORT
     Openo Using [ZPAY]

  Gosub OUVRE From GIMPOBJ

  Call IMPORTSIL("ZGASTUTB1", filpath('tmp',NAME,'DAT')) From GIMPOBJ

  Call ECR_TRACE("End Date: " + num$(datetime$),0) From GESECRAN

  ZTRACE = GTRACE
  Raz XMSG

      Delete THE File CREATED.
      RETURN_STATUS=Delfile(filpath('TRA',NAME,'DAT'))

Call FERME_TRACE() From LECFIC
Call LEC_TRACE From LECFIC

GET THE log File DETAILS
If filinfo(filpath("TRA",ZTRACE,"tra",0),7) > 0

  Openi filpath("TRA",ZTRACE,"tra",0) Using [XLL]

  Repeat
   Rdseq XMOT Using [XLL]

    If seg$(XMOT ,1,1) = "<"
             XMSG(XXCONTA) = XMOT + chr$(10)
             XXCONTA += 1
        Endif

  Until fstat <> 0
  Openi Using [XLL]



Subprog CREATE_GL_HEADER(HTYP,HNUM,HFCY,HJOU,HACCDAT,HBPRDATVCR,HREF,HCUR,HDACDIA,HBPRVCR,DESVCR)
Value Char HTYP       #Entry type
Value Char HNUM       #Document no.
Value Char HFCY       #Site
Value Char HJOU       #Journal
Value Char HACCDAT    #Accounting date
Value Char HBPRDATVCR #Document Date
Value Char HREF       #Reference
Value Char HCUR       #Entry currency
Value Char HDACDIA    #Transaction
Value Char HBPRVCR    #Source document\
Value Char DESVCR     #Description

Local Char HEADER(255)

Raz HEADER
        HEADER ="G,"                          #Line Type
        HEADER += HTYP +","
        HEADER += HNUM +","
        HEADER += HFCY +","
        HEADER += HJOU +","
        HEADER += HACCDAT +","
        HEADER += HBPRDATVCR +","
        HEADER += HREF +","
        HEADER += HCUR +","
        HEADER += HDACDIA +","
        HEADER += HBPRVCR +","
        HEADER += DESVCR

Wrseq HEADER Using   [ZGL]

End

CREATE LINES
Subprog CREATE_GL_DETAIL(LIN,LEDTYP,IDTLIN,FCYLIN,SAC,ACC,BPR,DES,SNS,AMTCUR,CUR)

Value Char     LIN        #Line number
Value Char     LEDTYP     #Ledger type
Value Char     IDTLIN
Value Char     FCYLIN     #Site
Value Char     SAC        #Collective
Value Char     ACC        #G/L accounts
Value Char     BPR        #BP
Value Char     DES        #Description
Value Char     SNS        #Sign
Value Char     AMTCUR     #Entry  amount
Value Char     CUR        #Chart code


Local Char LINES(255)
Raz LINES
       LINES ="D,"
       LINES += LIN +","
       LINES += LEDTYP +","
       LINES += IDTLIN +","
       LINES += FCYLIN +","
       LINES += num$(SAC) +","
       LINES += ACC +","
       LINES += BPR +","
       LINES += DES +","
       LINES += SNS +","
       LINES += AMTCUR +","
       LINES += CUR
       Wrseq LINES Using   [ZGL]

End

