#<AdxTL>@(#)0.0.0.0 $Revision$
#Open Tables
If clalev([F:YBBS])= 0  : Local File YBBSIM   [YBBS] : Endif

  #Set Batch Number
  Local Char YBATNBR(50) : [L]YBATNBR = "BB20181100083" #[M:YBB0]YBATNBR
  Local Char ZNAME(255) :  [L]ZNAME =  [L]YBATNBR+"_"+format$("D:YYMMDDhhmmss",date$)

  Call OUVRE_TRACE("Business Batch Post") From LECFIC
  Call ECR_TRACE("Start Date: " + num$(datetime$),0) From GESECRAN

  #Open File To Write GL Data
  Openo filpath('tmp',[L]ZNAME ,'DAT'),-1 Using [ZGL]

  #Assing Values of Different Parameters
  Iomode adxium 50 Using [ZGL]
  Iomode adxirs chr$(13)+ chr$(10) Using [ZGL] # Line Seperator
  Iomode adxifs ',' Using [ZGL] #Field Seperator
# ------------- Write Lines Start ------------- #

Read [F:YBBS]YBBS1 = [L]YBATNBR

Local Integer I,CTRNNO,NTRNNO


For [F:YBBS]YBBS1 Where [F:YBBS]YBATNBR =  [L]YBATNBR
  #Get Prev Trans no
  If [L]CTRNNO = 0 : [L]CTRNNO = [F:YBBS]YTRANSNBR : Endif
  I += 1
Next

#-- DEBUG
Infbox "Count"-num$(I)
#-- END

#TODO: Loop through Transaction for business batch
  # HEADER
  Local Char HEADER(255)
  HEADER = "this is a test to check if it will write,"
  HEADER += "Another part again as part 2"
  Wrseq HEADER Using [ZGL]

  # DETAILS

# ------------

  #Close file before import
  #Openo Using [ZPAY]

  #Gosub OUVRE From GIMPOBJ

  #Call IMPORTSIL("ZGASTUTB1", filpath('tmp',ZNAME,'DAT')) From GIMPOBJ

  #Call ECR_TRACE("End Date: " + num$(datetime$),0) From GESECRAN

  #ZTRACE = GTRACE
  #Raz XMSG

  #DELETE THE FILE CREATED.
  #RETURN_STATUS = Delfile(filpath('TRA',ZNAME,'DAT'))

Call FERME_TRACE() From LECFIC
Call LEC_TRACE From LECFIC

#get the log file details
If filinfo(filpath("TRA",ZTRACE,"tra",0),7) > 0

  Openi filpath("TRA",ZTRACE,"tra",0) Using [XLL]

  Repeat
   Rdseq XMOT Using [XLL]

    If seg$(XMOT ,1,1) = "<"
             XMSG(XXCONTA) = XMOT + chr$(10)
             XXCONTA += 1
        Endif

  Until fstat <> 0
  Openi Using [XLL]

Endif

#Close Tabels
If clalev([F:YBBS]) = 0 : Close Local File [F:YBBS] : Endif

#
#Call OUVRE_TRACE("Journal Integration") From LECFIC
#
#Call ECR_TRACE("Start Date: " + num$(datetime$),0) From GESECRAN
#
#NAME = "JNL" + format$("D:YYMMDDhhmmss",date$)
#TODO:

# 1. Get Header Details


##OPEN File To Write GL DATA For IMPORTING
#Openo filpath('tmp',NAME,'DAT'),-1 Using [ZGL]
#
#Iomode adxium 50 Using [ZGL]
#Iomode adxirs chr$(13)+ chr$(10) Using [ZGL] # line seperator
#Iomode adxifs ',' Using [ZGL] #field sperator
##Write the header line:
#
#
#              Call CREATE_GL_HEADER("ODP","",ZFCY,"ODP",num$([F:XX1]PYRDAT),num$([F:XX1]PYRDAT),"","ZAR","STDCO","","")
#
#              Call CREATE_GL_DETAIL(num$(ZCOUNT+1),"1",num$(ZCOUNT+1),[F:XX1]HDFCY,"",[F:XX1]ACC,"","",num$([F:XX1]SNS),num$([F:XX1]AMOUNT),"ZAR")
#
#    #Close file before import
#     Openo Using [ZPAY]
#
#  Gosub OUVRE From GIMPOBJ
#
#  Call IMPORTSIL("ZGASTUTB1", filpath('tmp',NAME,'DAT')) From GIMPOBJ
#
#  Call ECR_TRACE("End Date: " + num$(datetime$),0) From GESECRAN
#
#  ZTRACE = GTRACE
#  Raz XMSG
#
#      #DELETE THE FILE CREATED.
#      RETURN_STATUS=Delfile(filpath('TRA',NAME,'DAT'))
#
#Call FERME_TRACE() From LECFIC
#Call LEC_TRACE From LECFIC
#
##get the log file details
#If filinfo(filpath("TRA",ZTRACE,"tra",0),7) > 0
#
#  Openi filpath("TRA",ZTRACE,"tra",0) Using [XLL]
#
#  Repeat
#   Rdseq XMOT Using [XLL]
#
#    If seg$(XMOT ,1,1) = "<"
#             XMSG(XXCONTA) = XMOT + chr$(10)
#             XXCONTA += 1
#        Endif
#
#  Until fstat <> 0
#  Openi Using [XLL]
#
#
#
#Subprog CREATE_GL_HEADER(HTYP,HNUM,HFCY,HJOU,HACCDAT,HBPRDATVCR,HREF,HCUR,HDACDIA,HBPRVCR,DESVCR)
#Value Char HTYP       #Entry type
#Value Char HNUM       #Document no.
#Value Char HFCY       #Site
#Value Char HJOU       #Journal
#Value Char HACCDAT    #Accounting date
#Value Char HBPRDATVCR #Document Date
#Value Char HREF       #Reference
#Value Char HCUR       #Entry currency
#Value Char HDACDIA    #Transaction
#Value Char HBPRVCR    #Source document\
#Value Char DESVCR     #Description
#
#Local Char HEADER(255)
#
#Raz HEADER
#        HEADER ="G,"                          #Line Type
#        HEADER += HTYP +","
#        HEADER += HNUM +","
#        HEADER += HFCY +","
#        HEADER += HJOU +","
#        HEADER += HACCDAT +","
#        HEADER += HBPRDATVCR +","
#        HEADER += HREF +","
#        HEADER += HCUR +","
#        HEADER += HDACDIA +","
#        HEADER += HBPRVCR +","
#        HEADER += DESVCR
#
#Wrseq HEADER Using   [ZGL]
#
#End
#
##create lines
#Subprog CREATE_GL_DETAIL(LIN,LEDTYP,IDTLIN,FCYLIN,SAC,ACC,BPR,DES,SNS,AMTCUR,CUR)
#
#Value Char     LIN        #Line number
#Value Char     LEDTYP     #Ledger type
#Value Char     IDTLIN
#Value Char     FCYLIN     #Site
#Value Char     SAC        #Collective
#Value Char     ACC        #G/L accounts
#Value Char     BPR        #BP
#Value Char     DES        #Description
#Value Char     SNS        #Sign
#Value Char     AMTCUR     #Entry  amount
#Value Char     CUR        #Chart code
#
#
#Local Char LINES(255)
#Raz LINES
#       LINES ="D,"
#       LINES += LIN +","
#       LINES += LEDTYP +","
#       LINES += IDTLIN +","
#       LINES += FCYLIN +","
#       LINES += num$(SAC) +","
#       LINES += ACC +","
#       LINES += BPR +","
#       LINES += DES +","
#       LINES += SNS +","
#       LINES += AMTCUR +","
#       LINES += CUR
#       Wrseq LINES Using   [ZGL]
#
#End
#

