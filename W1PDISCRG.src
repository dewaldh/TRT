#<AdxTL>@(#)0.0.0.0 $Revision$
# Supervisor
# Mask management PDISCRG 

$_AFF
If GIMPORT
 Gosub AFF From GSAISIE
Else
 If GMESSAGE <>""
  Gosub ERR From GSAISIE
 Else
  Raz GERR , GZNUM
 Endif
Endif
Return

$HORODAT
Local Date    A_DATE
Local Char    A_HEURE(10) , A_USER(10)
Local Char    A_STAMP(15)
A_DATE  = [28/08/2018]
A_HEURE = "00:07:12"
A_USER  = "ADMIN"
A_STAMP = "20180828000712"
Return

$TITRES
Chgtzn [M:PDC1]DISCRGVAL1 With GCOLREM(0)
Chgtzn [M:PDC1]DISCRGVAL2 With GCOLREM(1)
Chgtzn [M:PDC1]DISCRGVAL3 With GCOLREM(2)
Chgtzn [M:PDC1]DISCRGAMT1 With [M:PDC1]LIB1
Chgtzn [M:PDC1]DISCRGAMT2 With [M:PDC1]LIB2
Chgtzn [M:PDC1]DISCRGAMT3 With [M:PDC1]LIB3
Chgtzn [M:PDC1]DISCRGAMT4 With [M:PDC1]LIB4
Chgtzn [M:PDC1]DISCRGAMT5 With [M:PDC1]LIB5
Chgtzn [M:PDC1]DISCRGAMT6 With [M:PDC1]LIB6
Chgtzn [M:PDC1]DISCRGAMT7 With [M:PDC1]LIB7
Chgtzn [M:PDC1]DISCRGAMT8 With [M:PDC1]LIB8
Chgtzn [M:PDC1]DISCRGAMT9 With [M:PDC1]LIB9
Return

$VISU
Local Integer A_REPONSE
Global Integer GPRE_VIEW
If dim(A_WINDPREV)<=0 : Local Char A_WINDPREV(30) : Endif
Local Mask PDISCRG [PDC1]
Gosub HORODAT
Local Inpbox "PDISCRG" From GFONCTION At A_STAMP With A_WINDPREV Mask [PDC1] As [SIM_]
Grizo [PDC1]5
Grizo [PDC1]10
Grizo [PDC1]15
Grizo [PDC1]20
Boxact [SIM_]
Gosub TITRES
Boxinp [SIM_] Using A_REPONSE
Close Local Inpbox [SIM_]
Close Local Mask [PDC1]
Kill GPRE_VIEW
Return

$HARDCOP
Local Integer X1(0..14),X2(0..14),Y1(0..14),Y2(0..14)
X1(0)=26 : X2(0)=87 : Y1(0)=4 : Y2(0)=8
X1(1)=26 : X2(1)=58 : Y1(1)=9 : Y2(1)=12
X1(2)=59 : X2(2)=87 : Y1(2)=9 : Y2(2)=12
X1(3)=26 : X2(3)=87 : Y1(3)=13 : Y2(3)=24
Return

$ON_TYPORI
Onevent INIT_AREA Call D_TYPORI(zc) From W1PDISCRG
Return

Subprog D_TYPORI(VALEUR)
Variable Integer VALEUR
If varinit([M]TYPORI,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_NUMORI
Return

$ON_ITMREF
Return

$ON_QTYUOM
Onevent BEFORE_AREA Gosub AV_QTYUOM From W1PDISCRG
Return

$AV_QTYUOM
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]UOM,GUNITE(1..GNBUNT)),1))
Endif
Chgfmt [M]QTYUOM(indice) With "NPz:"+GUNTFMT
Gosub _AFF
Return

$ON_UOM
Return

$ON_NETPRI
Onevent BEFORE_AREA Gosub AV_NETPRI From W1PDISCRG
Return

$AV_NETPRI
If !GWEBSERV
 ## Action PARDEV
Endif
Gosub _AFF
Return

$ON_AMTNOTLIN
Onevent BEFORE_AREA Gosub AV_AMTNOTLIN From W1PDISCRG
Return

$AV_AMTNOTLIN
## Action INIDEV
GDEVFMT="11.2" : GDEVFMT = GDEVFMT1(max(find([M]CUR,GDEVISE(1..GNBDEV)),1))
Chgfmt [M]AMTNOTLIN(indice) With "NPz3:"+GDEVFMT
Gosub _AFF
Return

$ON_CUR
Return

$ON_DISCRGVAL1
Onevent AFTER_CHANGE Gosub AMM_DISCRGVAL1 From W1PDISCRG
Onevent BEFORE_AREA Gosub AV_DISCRGVAL1 From W1PDISCRG
Return

$AV_DISCRGVAL1
If [M]FMTREM(0)<>""
 Chgfmt [M]DISCRGVAL1(indice) With [M]FMTREM(0)
Else
 Chgfmt [M]DISCRGVAL1(indice) With "-K:1X"
Endif
Gosub _AFF
Return

$AMM_DISCRGVAL1
Call AM_DISCRGVAL1(zc)
If !mkstat & GOBJET
 zoncou = "DISCRGVAL1" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_DISCRGVAL1(VALEUR)
Variable Decimal VALEUR
## Action PAMDISCRG
Call PAMDISCRG(VALEUR,"PDC1",1,0,[M:PDC1]CUR) From TRTACHPRI1
If mkstat : GERR = 1 : GZONE = "DISCRGVAL1" : GZNUM = 0 : Endif
If !mkstat
 ## Action STD
 Call AM_DISCRGVAL1(VALEUR) From SUBPDC
 If mkstat : GERR = 1 : GZONE = "DISCRGVAL1" : GZNUM = 0 : Endif
Endif
Gosub _AFF
End

$ON_DISCRGTYP1
Return

$ON_DISCRGVAL2
Onevent AFTER_CHANGE Gosub AMM_DISCRGVAL2 From W1PDISCRG
Onevent BEFORE_AREA Gosub AV_DISCRGVAL2 From W1PDISCRG
Return

$AV_DISCRGVAL2
If [M]FMTREM(1)<>""
 Chgfmt [M]DISCRGVAL2(indice) With [M]FMTREM(1)
Else
 Chgfmt [M]DISCRGVAL2(indice) With "-K:1X"
Endif
Gosub _AFF
Return

$AMM_DISCRGVAL2
Call AM_DISCRGVAL2(zc)
If !mkstat & GOBJET
 zoncou = "DISCRGVAL2" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_DISCRGVAL2(VALEUR)
Variable Decimal VALEUR
## Action PAMDISCRG
Call PAMDISCRG(VALEUR,"PDC1",2,0,[M:PDC1]CUR) From TRTACHPRI1
If mkstat : GERR = 1 : GZONE = "DISCRGVAL2" : GZNUM = 0 : Endif
If !mkstat
 ## Action STD
 Call AM_DISCRGVAL2(VALEUR) From SUBPDC
 If mkstat : GERR = 1 : GZONE = "DISCRGVAL2" : GZNUM = 0 : Endif
Endif
Gosub _AFF
End

$ON_DISCRGTYP2
Return

$ON_DISCRGVAL3
Onevent AFTER_CHANGE Gosub AMM_DISCRGVAL3 From W1PDISCRG
Onevent BEFORE_AREA Gosub AV_DISCRGVAL3 From W1PDISCRG
Return

$AV_DISCRGVAL3
If [M]FMTREM(2)<>""
 Chgfmt [M]DISCRGVAL3(indice) With [M]FMTREM(2)
Else
 Chgfmt [M]DISCRGVAL3(indice) With "-K:1X"
Endif
Gosub _AFF
Return

$AMM_DISCRGVAL3
Call AM_DISCRGVAL3(zc)
If !mkstat & GOBJET
 zoncou = "DISCRGVAL3" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_DISCRGVAL3(VALEUR)
Variable Decimal VALEUR
## Action PAMDISCRG
Call PAMDISCRG(VALEUR,"PDC1",3,0,[M:PDC1]CUR) From TRTACHPRI1
If mkstat : GERR = 1 : GZONE = "DISCRGVAL3" : GZNUM = 0 : Endif
If !mkstat
 ## Action STD
 Call AM_DISCRGVAL3(VALEUR) From SUBPDC
 If mkstat : GERR = 1 : GZONE = "DISCRGVAL3" : GZNUM = 0 : Endif
Endif
Gosub _AFF
End

$ON_DISCRGTYP3
Return

$ON_DISCRGREN1
Onevent CONTROL Call C_DISCRGREN1(zc) From W1PDISCRG
Onevent BEFORE_INPUT Call AS_DISCRGREN1(zc) From W1PDISCRG
Return

Subprog AS_DISCRGREN1(VALEUR)
Variable Decimal VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(15597,GBOUTS) From OBJDIV
Onkey   2 Titled GBOUTS Call S_DISCRGREN1(zc) From W1PDISCRG
Gosub _AFF
End

Subprog C_DISCRGREN1(VALEUR)
Variable Decimal VALEUR
## Action CTLREN
Local Char    PARMSK(250)(1..20) , SAVACT(20)
SAVACT = GACTION : GACTION = "CTLREN"
PARMSK(1) = "6"
PARMSK(2) = num$(DISCRGREN1)
PARMSK(3) = num$(DISCRGVAL1)
Call S_AFF_NUM(VALEUR,PARMSK,"CTLREN","TRTPRICE","") From GACTION
GACTION = SAVACT
If mkstat : GERR = 1 : GZONE = "DISCRGREN1" : GZNUM = 0 : Endif
Gosub _AFF
End

Subprog S_DISCRGREN1(VALEUR)
Variable Decimal VALEUR
If !GWEBSERV
 ## Action SELREN
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELREN"
 PARMSK(1) = "6"
 Call S_TAB_NUM(VALEUR,PARMSK,"SELREN","TRTPRICE","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

$ON_DISCRGDES1
Onevent BEFORE_AREA Gosub AV_DISCRGDES1 From W1PDISCRG
Return

$AV_DISCRGDES1
## Action PLECREN
Call LECREN(zc,DISCRGREN1,6) From TRTPRICE
Gosub _AFF
Return

$ON_DISCRGREN2
Onevent CONTROL Call C_DISCRGREN2(zc) From W1PDISCRG
Onevent BEFORE_INPUT Call AS_DISCRGREN2(zc) From W1PDISCRG
Return

Subprog AS_DISCRGREN2(VALEUR)
Variable Decimal VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(15597,GBOUTS) From OBJDIV
Onkey   2 Titled GBOUTS Call S_DISCRGREN2(zc) From W1PDISCRG
Gosub _AFF
End

Subprog C_DISCRGREN2(VALEUR)
Variable Decimal VALEUR
## Action CTLREN
Local Char    PARMSK(250)(1..20) , SAVACT(20)
SAVACT = GACTION : GACTION = "CTLREN"
PARMSK(1) = "6"
PARMSK(2) = num$(DISCRGREN2)
PARMSK(3) = num$(DISCRGVAL2)
Call S_AFF_NUM(VALEUR,PARMSK,"CTLREN","TRTPRICE","") From GACTION
GACTION = SAVACT
If mkstat : GERR = 1 : GZONE = "DISCRGREN2" : GZNUM = 0 : Endif
Gosub _AFF
End

Subprog S_DISCRGREN2(VALEUR)
Variable Decimal VALEUR
If !GWEBSERV
 ## Action SELREN
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELREN"
 PARMSK(1) = "6"
 Call S_TAB_NUM(VALEUR,PARMSK,"SELREN","TRTPRICE","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

$ON_DISCRGDES2
Onevent BEFORE_AREA Gosub AV_DISCRGDES2 From W1PDISCRG
Return

$AV_DISCRGDES2
## Action PLECREN
Call LECREN(zc,DISCRGREN2,6) From TRTPRICE
Gosub _AFF
Return

$ON_DISCRGREN3
Onevent CONTROL Call C_DISCRGREN3(zc) From W1PDISCRG
Onevent BEFORE_INPUT Call AS_DISCRGREN3(zc) From W1PDISCRG
Return

Subprog AS_DISCRGREN3(VALEUR)
Variable Decimal VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(15597,GBOUTS) From OBJDIV
Onkey   2 Titled GBOUTS Call S_DISCRGREN3(zc) From W1PDISCRG
Gosub _AFF
End

Subprog C_DISCRGREN3(VALEUR)
Variable Decimal VALEUR
## Action CTLREN
Local Char    PARMSK(250)(1..20) , SAVACT(20)
SAVACT = GACTION : GACTION = "CTLREN"
PARMSK(1) = "6"
PARMSK(2) = num$(DISCRGREN3)
PARMSK(3) = num$(DISCRGVAL3)
Call S_AFF_NUM(VALEUR,PARMSK,"CTLREN","TRTPRICE","") From GACTION
GACTION = SAVACT
If mkstat : GERR = 1 : GZONE = "DISCRGREN3" : GZNUM = 0 : Endif
Gosub _AFF
End

Subprog S_DISCRGREN3(VALEUR)
Variable Decimal VALEUR
If !GWEBSERV
 ## Action SELREN
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELREN"
 PARMSK(1) = "6"
 Call S_TAB_NUM(VALEUR,PARMSK,"SELREN","TRTPRICE","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

$ON_DISCRGDES3
Onevent BEFORE_AREA Gosub AV_DISCRGDES3 From W1PDISCRG
Return

$AV_DISCRGDES3
## Action PLECREN
Call LECREN(zc,DISCRGREN3,6) From TRTPRICE
Gosub _AFF
Return

$ON_DISCRGAMT1
Onevent BEFORE_AREA Gosub AV_DISCRGAMT1 From W1PDISCRG
Return

$AV_DISCRGAMT1
If func SUBPDC.FMT("PIH3",1)<>""
 Chgfmt [M]DISCRGAMT1(indice) With func SUBPDC.FMT("PIH3",1)
Else
 Chgfmt [M]DISCRGAMT1(indice) With "-K:1X"
Endif
Gosub _AFF
Return

$ON_DISCRGAMT2
Onevent BEFORE_AREA Gosub AV_DISCRGAMT2 From W1PDISCRG
Return

$AV_DISCRGAMT2
If func SUBPDC.FMT("PIH3",2)<>""
 Chgfmt [M]DISCRGAMT2(indice) With func SUBPDC.FMT("PIH3",2)
Else
 Chgfmt [M]DISCRGAMT2(indice) With "-K:1X"
Endif
Gosub _AFF
Return

$ON_DISCRGAMT3
Onevent BEFORE_AREA Gosub AV_DISCRGAMT3 From W1PDISCRG
Return

$AV_DISCRGAMT3
If func SUBPDC.FMT("PIH3",3)<>""
 Chgfmt [M]DISCRGAMT3(indice) With func SUBPDC.FMT("PIH3",3)
Else
 Chgfmt [M]DISCRGAMT3(indice) With "-K:1X"
Endif
Gosub _AFF
Return

$ON_DISCRGAMT4
Onevent BEFORE_AREA Gosub AV_DISCRGAMT4 From W1PDISCRG
Return

$AV_DISCRGAMT4
If func SUBPDC.FMT("PIH3",4)<>""
 Chgfmt [M]DISCRGAMT4(indice) With func SUBPDC.FMT("PIH3",4)
Else
 Chgfmt [M]DISCRGAMT4(indice) With "-K:1X"
Endif
Gosub _AFF
Return

$ON_DISCRGAMT5
Onevent BEFORE_AREA Gosub AV_DISCRGAMT5 From W1PDISCRG
Return

$AV_DISCRGAMT5
If func SUBPDC.FMT("PIH3",5)<>""
 Chgfmt [M]DISCRGAMT5(indice) With func SUBPDC.FMT("PIH3",5)
Else
 Chgfmt [M]DISCRGAMT5(indice) With "-K:1X"
Endif
Gosub _AFF
Return

$ON_DISCRGAMT6
Onevent BEFORE_AREA Gosub AV_DISCRGAMT6 From W1PDISCRG
Return

$AV_DISCRGAMT6
If func SUBPDC.FMT("PIH3",6)<>""
 Chgfmt [M]DISCRGAMT6(indice) With func SUBPDC.FMT("PIH3",6)
Else
 Chgfmt [M]DISCRGAMT6(indice) With "-K:1X"
Endif
Gosub _AFF
Return

$ON_DISCRGAMT7
Onevent BEFORE_AREA Gosub AV_DISCRGAMT7 From W1PDISCRG
Return

$AV_DISCRGAMT7
If func SUBPDC.FMT("PIH3",7)<>""
 Chgfmt [M]DISCRGAMT7(indice) With func SUBPDC.FMT("PIH3",7)
Else
 Chgfmt [M]DISCRGAMT7(indice) With "-K:1X"
Endif
Gosub _AFF
Return

$ON_DISCRGAMT8
Onevent BEFORE_AREA Gosub AV_DISCRGAMT8 From W1PDISCRG
Return

$AV_DISCRGAMT8
If func SUBPDC.FMT("PIH3",8)<>""
 Chgfmt [M]DISCRGAMT8(indice) With func SUBPDC.FMT("PIH3",8)
Else
 Chgfmt [M]DISCRGAMT8(indice) With "-K:1X"
Endif
Gosub _AFF
Return

$ON_DISCRGAMT9
Onevent BEFORE_AREA Gosub AV_DISCRGAMT9 From W1PDISCRG
Return

$AV_DISCRGAMT9
If func SUBPDC.FMT("PIH3",9)<>""
 Chgfmt [M]DISCRGAMT9(indice) With func SUBPDC.FMT("PIH3",9)
Else
 Chgfmt [M]DISCRGAMT9(indice) With "-K:1X"
Endif
Gosub _AFF
Return

$CHG_STY
Return


