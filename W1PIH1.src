#<AdxTL>@(#)0.0.0.0 $Revision$
# Supervisor
# Mask management PIH1 

$_AFF
If GIMPORT
 Gosub AFF From GSAISIE
Else
 If GMESSAGE <>""
  Gosub ERR From GSAISIE
 Else
  Raz GERR , GZNUM
 Endif
Endif
Return

$HORODAT
Local Date    A_DATE
Local Char    A_HEURE(10) , A_USER(10)
Local Char    A_STAMP(15)
A_DATE  = [28/08/2018]
A_HEURE = "00:07:38"
A_USER  = "ADMIN"
A_STAMP = "20180828000738"
Return

$TITRES
Chgtzn [M:PIH1]BPRDAT With mess(617+func AFNC.ACTIV("KAG"),197,1)
Return

$CHG_FMT
Case zoncou
 When "NBFAC1"
  If [M]NBFAC1=0
  Endif
 When "NBAXE"
  If [M]NBAXE=0
  Endif
Endcase
Return

$VISU
Local Integer A_REPONSE
Global Integer GPRE_VIEW
If dim(A_WINDPREV)<=0 : Local Char A_WINDPREV(30) : Endif
Local Mask PIH1 [PIH1]
Gosub HORODAT
Local Inpbox "PIH1" From GFONCTION At A_STAMP With A_WINDPREV Mask [PIH1] As [SIM_]
Grizo [PIH1]5
Grizo [PIH1]10
Grizo [PIH1]20
Grizo [PIH1]25
Grizo [PIH1]30
Grizo [PIH1]35
Boxact [SIM_]
Gosub TITRES
Boxinp [SIM_] Using A_REPONSE
Close Local Inpbox [SIM_]
Close Local Mask [PIH1]
Kill GPRE_VIEW
Return

$HARDCOP
Local Integer X1(0..14),X2(0..14),Y1(0..14),Y2(0..14)
X1(0)=1 : X2(0)=59 : Y1(0)=1 : Y2(0)=12
X1(1)=60 : X2(1)=106 : Y1(1)=1 : Y2(1)=12
X1(2)=1 : X2(2)=59 : Y1(2)=13 : Y2(2)=18
X1(3)=60 : X2(3)=106 : Y1(3)=13 : Y2(3)=16
X1(4)=1 : X2(4)=59 : Y1(4)=19 : Y2(4)=22
X1(5)=60 : X2(5)=106 : Y1(5)=17 : Y2(5)=22
Return

$ON_BPRDAT
Onevent AFTER_CHANGE Gosub AMM_BPRDAT From W1PIH1
Onevent CONTROL Call C_BPRDAT(zc) From W1PIH1
Onevent BEFORE_AREA Gosub AV_BPRDAT From W1PIH1
Return

$AV_BPRDAT
Chgfmt [M]BPRDAT(indice) With "D:"+GFMDAT
Gosub _AFF
Return

Subprog C_BPRDAT(VALEUR)
Variable Date    VALEUR
## Action %OBLIG
If VALEUR=[0/0/0]
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "BPRDAT" : GZNUM = 0 : Endif
Gosub _AFF
End

$AMM_BPRDAT
Call AM_BPRDAT(zc)
If !mkstat & GOBJET
 zoncou = "BPRDAT" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_BPRDAT(VALEUR)
Variable Date    VALEUR
## Action STD
Call AM_BPRDAT(VALEUR) From SUBPIH
If mkstat : GERR = 1 : GZONE = "BPRDAT" : GZNUM = 0 : Endif
Gosub _AFF
End

$ON_BPRVCR
Onevent CONTROL Call C_BPRVCR(zc) From W1PIH1
Onevent AFTER_CHANGE Gosub AMM_BPRVCR From W1PIH1
Onevent BEFORE_INPUT Call AS_BPRVCR(zc) From W1PIH1
Return

Subprog IB_BPRVCR(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action STD
 Call IB_BPRVCR From SUBPIH
Endif
Gosub _AFF
End

Subprog AS_BPRVCR(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(8410,GBOUT1) From OBJDIV
Call IB_BPRVCR(VALEUR)
Onkey 129 Titled GBOUT1 Call B1_BPRVCR(zc) From W1PIH1
Gosub _AFF
End

Subprog C_BPRVCR(VALEUR)
Variable Char    VALEUR()
## Action STD
Call C_BPRVCR(VALEUR) From SUBPIH
If mkstat : GERR = 1 : GZONE = "BPRVCR" : GZNUM = 15580 : Endif
Gosub _AFF
End

$AMM_BPRVCR
Call AM_BPRVCR(zc)
If !mkstat & GOBJET
 zoncou = "BPRVCR" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_BPRVCR(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_BPRVCR(VALEUR) From SUBPIH
If mkstat : GERR = 1 : GZONE = "BPRVCR" : GZNUM = 15580 : Endif
Gosub _AFF
End

Subprog B1_BPRVCR(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action GOBJETC
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "GOBJETC"
 Call OBJET_CHAR([M:PIH0]SIHNUM,"SIH","") From GOBJET
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

$ON_BPRPAY
Onevent CONTROL Call C_BPRPAY(zc) From W1PIH1
Onevent AFTER_CHANGE Gosub AMM_BPRPAY From W1PIH1
Onevent BEFORE_INPUT Call AS_BPRPAY(zc) From W1PIH1
Return

Subprog AS_BPRPAY(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(1500,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Onkey 129 Titled GBOUT1 Call B1_BPRPAY(zc) From W1PIH1
Onkey   2 Titled GBOUTS Call S_BPRPAY(zc) From W1PIH1
Onkey 144 Titled GBOUTP Call P_BPRPAY(zc) From W1PIH1
Onkey 146 Titled GBOUTA Call SA_BPRPAY(zc) From W1PIH1
Gosub _AFF
End

Subprog C_BPRPAY(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "BPRPAY" : GZNUM = 5365 : Endif
If !GWEBSERV
 If !mkstat
  ## Action BPRCHOICE
  Local Char    PARMSK(250)(1..20) , SAVACT(20)
  SAVACT = GACTION : GACTION = "BPRCHOICE"
  Call S_TAB_CHAR(VALEUR,PARMSK,"BPRCHOICE","TRTSEL","") From GACTION
  GACTION = SAVACT
  If mkstat : GERR = 1 : GZONE = "BPRPAY" : GZNUM = 5365 : Endif
 Endif
Endif
If !mkstat
 ## Action %CNTOBJ
 Call CONTSEL("BPR","",VALEUR,"",mkstat) From CONTOBJ
 If mkstat : GERR = 1 : GZONE = "BPRPAY" : GZNUM = 5365 : Endif
 If !mkstat
  ## Action CONTBPRCPY
  Call CONTBPRCPY(VALEUR,[M:PIH0]FCY,"","","F") From CPTSUB
  If mkstat : GERR = 1 : GZONE = "BPRPAY" : GZNUM = 5365 : Endif
 Endif
Endif
Gosub _AFF
End

$AMM_BPRPAY
Call AM_BPRPAY(zc)
If !mkstat & GOBJET
 zoncou = "BPRPAY" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_BPRPAY(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_BPRPAY(VALEUR) From SUBPIH
If mkstat : GERR = 1 : GZONE = "BPRPAY" : GZNUM = 5365 : Endif
If !mkstat & evalue("dim("+clanam([M])+"ZBPRPAY)")>indice
 [M]BPRPAY(indice) = VALEUR
 Affzo ZBPRPAY(indice)
Endif
Gosub _AFF
End

Subprog S_BPRPAY(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16)
PARMSK(1) = "BPR"
PARMSK(2) = ""
Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJ","SELOBJ","") From GACTION
Gosub _AFF
End

Subprog B1_BPRPAY(VALEUR)
Variable Char    VALEUR()
Call OBJET("BPR",VALEUR,"") From GOBJET
Gosub _AFF
End

Subprog SA_BPRPAY(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "BPR"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_BPRPAY(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("BPR",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZBPRPAY
Onevent BEFORE_AREA Gosub AV_ZBPRPAY From W1PIH1
Return

$AV_ZBPRPAY
If clalev([F:BPR])=0
 If dim(GTABCPT)>0 & GTABCPT<>"" & find("BPR",GABRCPT(1..GNBTABCPT))
  Local File =GTABCPT+"BPARTNER" [BPR]
 Else 
  Local File BPARTNER [BPR]
 Endif
Endif
Call LECTURE("BPR",num$([M]BPRPAY(indice)),"") From CONTOBJ
zc = [F:BPR]BPRSHO
Gosub _AFF
Return

$ON_CUR
Onevent CONTROL Call C_CUR(zc) From W1PIH1
Onevent AFTER_CHANGE Gosub AMM_CUR From W1PIH1
Onevent BEFORE_INPUT Call AS_CUR(zc) From W1PIH1
Return

Subprog AS_CUR(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(3837,GBOUT1) From OBJDIV
Call TEXTE(17412,GBOUT2) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Onkey 129 Titled GBOUT1 Call B1_CUR(zc) From W1PIH1
Onkey 130 Titled GBOUT2 Call B2_CUR(zc) From W1PIH1
Onkey   2 Titled GBOUTS Call S_CUR(zc) From W1PIH1
Onkey 144 Titled GBOUTP Call P_CUR(zc) From W1PIH1
Onkey 146 Titled GBOUTA Call SA_CUR(zc) From W1PIH1
Gosub _AFF
End

Subprog C_CUR(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "CUR" : GZNUM = 323 : Endif
If !mkstat
 ## Action %CNTOBJ
 Call CONTSEL("TCU","",VALEUR,"",mkstat) From CONTOBJ
 If mkstat : GERR = 1 : GZONE = "CUR" : GZNUM = 323 : Endif
 If !mkstat
  ## Action CONTDEV
  Call CONTDEV(VALEUR,[M:PIH1]RATDAT) From TRTDEV
  If mkstat : GERR = 1 : GZONE = "CUR" : GZNUM = 323 : Endif
 Endif
Endif
Gosub _AFF
End

$AMM_CUR
Call AM_CUR(zc)
If !mkstat & GOBJET
 zoncou = "CUR" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_CUR(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_CUR(VALEUR) From SUBPIH
If mkstat : GERR = 1 : GZONE = "CUR" : GZNUM = 323 : Endif
If !mkstat & evalue("dim("+clanam([M])+"ZCUR)")>indice
 [M]CUR(indice) = VALEUR
 Affzo ZCUR(indice)
Endif
Gosub _AFF
End

Subprog S_CUR(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16)
PARMSK(1) = "TCU"
PARMSK(2) = ""
Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJ","SELOBJ","") From GACTION
Gosub _AFF
End

Subprog B1_CUR(VALEUR)
Variable Char    VALEUR()
Call OBJET("TCU",VALEUR,"") From GOBJET
Gosub _AFF
End

Subprog B2_CUR(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SAIRATCUR
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SAIRATCUR"
 PARMSK(1) = VALEUR
 PARMSK(2) = GSOCIETE
 PARMSK(3) = num$([M:PIH1]CURTYP)
 PARMSK(4) = [M:PIH1]RATDAT
 PARMSK(5) = "[M:PIH1]RATMLT"
 PARMSK(6) = "[M:PIH1]RATDIV"
 Call SAISIE_CHAR(VALEUR,PARMSK,"DSAICUR","SUBSCL","SPESCL") From GSAISIE
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog SA_CUR(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "TCU"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_CUR(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("TCU",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZCUR
Onevent BEFORE_AREA Gosub AV_ZCUR From W1PIH1
Return

$AV_ZCUR
Call LECTEXTRA(zc,"TABCUR","INTDES",num$([M]CUR(indice)),"") From ATEXTRA
Gosub _AFF
Return

$ON_CURTYP
Onevent AFTER_CHANGE Gosub AMM_CURTYP From W1PIH1
Onevent INIT_AREA Call D_CURTYP(zc) From W1PIH1
Onevent BEFORE_INPUT Call AS_CURTYP(zc) From W1PIH1
Onevent CONTROL Call C_CURTYP(zc) From W1PIH1
Return

Subprog D_CURTYP(VALEUR)
Variable Integer VALEUR
If varinit([M]CURTYP,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

Subprog AS_CURTYP(VALEUR)
Variable Integer VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
If VALEUR<1
 VALEUR = 1
Endif
Gosub _AFF
End

Subprog C_CURTYP(VALEUR)
Variable Integer VALEUR
## Action %OBLIG
If VALEUR=0
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "CURTYP" : GZNUM = 426 : Endif
Gosub _AFF
End

$AMM_CURTYP
Call AM_CURTYP(zc)
If !mkstat & GOBJET
 zoncou = "CURTYP" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_CURTYP(VALEUR)
Variable Integer VALEUR
## Action STD
Call AM_CURTYP(VALEUR) From SUBPIH
If mkstat : GERR = 1 : GZONE = "CURTYP" : GZNUM = 426 : Endif
Gosub _AFF
End

$ON_RAT1
Onevent BEFORE_INPUT Call AS_RAT1(zc) From W1PIH1
Onevent AFTER_CHANGE Gosub AMM_RAT1 From W1PIH1
Onevent CONTROL Call C_RAT1(zc) From W1PIH1
Return

Subprog AS_RAT1(VALEUR)
Variable Decimal VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(694,GBOUT2) From OBJDIV
Call TEXTE(17412,GBOUT3) From OBJDIV
If !GWEBSERV
 ## Action ARCUINI
 Call RCUINI(VALEUR,[M:PIH1]CURMLT,[M:PIH1]CURDIV) From AINICOURS
 If mkstat=2
  [M]RAT1(INDIC) = VALEUR
  Affzo RAT1(INDIC) : mkstat = 2
 Endif
Endif
If !mkstat
 ## Action STD
 Call AS_RAT1(VALEUR) From SUBPIH
 If mkstat=2
  [M]RAT1(INDIC) = VALEUR
  Affzo RAT1(INDIC) : mkstat = 2
 Endif
 Onkey 130 Titled GBOUT2 Call B2_RAT1(zc) From W1PIH1
 Onkey 131 Titled GBOUT3 Call B3_RAT1(zc) From W1PIH1
Endif
Gosub _AFF
End

Subprog C_RAT1(VALEUR)
Variable Decimal VALEUR
Gosub _AFF
End

$AMM_RAT1
Call AM_RAT1(zc)
If !mkstat & GOBJET
 zoncou = "RAT1" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_RAT1(VALEUR)
Variable Decimal VALEUR
## Action STD
Call AM_RAT1(VALEUR) From SUBPIH
If mkstat : GERR = 1 : GZONE = "RAT1" : GZNUM = 995 : Endif
Gosub _AFF
End

Subprog B2_RAT1(VALEUR)
Variable Decimal VALEUR
If !GWEBSERV
 ## Action AINICOURS
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "AINICOURS"
 PARMSK(1) = [M:PIH1]CURMLT
 PARMSK(2) = [M:PIH1]CURDIV
 PARMSK(3) = GSOCIETE
 PARMSK(4) = num$([M:PIH1]CURTYP)
 PARMSK(5) = [M:PIH1]RATDAT
 PARMSK(6) = "2"
 PARMSK(7) = "[M:PIH1]RAT2"
 Call S_AFF_NUM(VALEUR,PARMSK,"AINICOURS","AINICOURS","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B3_RAT1(VALEUR)
Variable Decimal VALEUR
If !GWEBSERV
 ## Action SAIRATCUR
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SAIRATCUR"
 PARMSK(1) = [M:PIH1]CUR
 PARMSK(2) = GSOCIETE
 PARMSK(3) = num$([M:PIH1]CURTYP)
 PARMSK(4) = [M:PIH1]RATDAT
 PARMSK(5) = "[M:PIH1]RATMLT"
 PARMSK(6) = "[M:PIH1]RATDIV"
 Call SAISIE_NUM(VALEUR,PARMSK,"DSAICUR","SUBSCL","SPESCL") From GSAISIE
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

$ON_CURDIV
Return

$ON_RAT2
Onevent BEFORE_INPUT Call AS_RAT2(zc) From W1PIH1
Onevent CONTROL Call C_RAT2(zc) From W1PIH1
Onevent AFTER_CHANGE Gosub AMM_RAT2 From W1PIH1
Return

Subprog AS_RAT2(VALEUR)
Variable Decimal VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(694,GBOUT2) From OBJDIV
Call TEXTE(17412,GBOUT3) From OBJDIV
If !GWEBSERV
 ## Action ARCUINI
 Call RCUINI(VALEUR,[M:PIH1]CURMLT,[M:PIH1]CURDIV) From AINICOURS
 If mkstat=2
  [M]RAT2(INDIC) = VALEUR
  Affzo RAT2(INDIC) : mkstat = 2
 Endif
Endif
If !mkstat
 ## Action STD
 Call AS_RAT2(VALEUR) From SUBPIH
 If mkstat=2
  [M]RAT2(INDIC) = VALEUR
  Affzo RAT2(INDIC) : mkstat = 2
 Endif
 Onkey 130 Titled GBOUT2 Call B2_RAT2(zc) From W1PIH1
 Onkey 131 Titled GBOUT3 Call B3_RAT2(zc) From W1PIH1
Endif
Gosub _AFF
End

Subprog C_RAT2(VALEUR)
Variable Decimal VALEUR
## Action STD
Call C_RAT2(VALEUR) From SUBPIH
If mkstat : GERR = 1 : GZONE = "RAT2" : GZNUM = 0 : Endif
Gosub _AFF
End

$AMM_RAT2
Call AM_RAT2(zc)
If !mkstat & GOBJET
 zoncou = "RAT2" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_RAT2(VALEUR)
Variable Decimal VALEUR
## Action STD
Call AM_RAT2(VALEUR) From SUBPIH
If mkstat : GERR = 1 : GZONE = "RAT2" : GZNUM = 0 : Endif
Gosub _AFF
End

Subprog B2_RAT2(VALEUR)
Variable Decimal VALEUR
If !GWEBSERV
 ## Action AINICOURS
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "AINICOURS"
 PARMSK(1) = [M:PIH1]CURMLT
 PARMSK(2) = [M:PIH1]CURDIV
 PARMSK(3) = GSOCIETE
 PARMSK(4) = num$([M:PIH1]CURTYP)
 PARMSK(5) = [M:PIH1]RATDAT
 PARMSK(6) = "1"
 PARMSK(7) = "[M:PIH1]RAT1"
 Call S_AFF_NUM(VALEUR,PARMSK,"AINICOURS","AINICOURS","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B3_RAT2(VALEUR)
Variable Decimal VALEUR
If !GWEBSERV
 ## Action SAIRATCUR
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SAIRATCUR"
 PARMSK(1) = [M:PIH1]CUR
 PARMSK(2) = GSOCIETE
 PARMSK(3) = num$([M:PIH1]CURTYP)
 PARMSK(4) = [M:PIH1]RATDAT
 PARMSK(5) = "[M:PIH1]RATMLT"
 PARMSK(6) = "[M:PIH1]RATDIV"
 Call SAISIE_NUM(VALEUR,PARMSK,"DSAICUR","SUBSCL","SPESCL") From GSAISIE
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

$ON_CURMLT
Return

$ON_INVNUM
Onevent CONTROL Call C_INVNUM(zc) From W1PIH1
Onevent AFTER_AREA Call AP_INVNUM(zc) From W1PIH1
Onevent BEFORE_INPUT Call AS_INVNUM(zc) From W1PIH1
Return

Subprog AS_INVNUM(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(15597,GBOUTS) From OBJDIV
Onkey   2 Titled GBOUTS Call S_INVNUM(zc) From W1PIH1
Gosub _AFF
End

Subprog C_INVNUM(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action CONTVCR
 Call CONTVCR(VALEUR) From TRTDIV
 If mkstat : GERR = 1 : GZONE = "INVNUM" : GZNUM = 8496 : Endif
Endif
Gosub _AFF
End

Subprog AP_INVNUM(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AP_INVNUM(VALEUR) From SUBPIH
If mkstat : GERR = 1 : GZONE = "INVNUM" : GZNUM = 8496 : Endif
Gosub _AFF
End

Subprog S_INVNUM(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELPIH
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELPIH"
 PARMSK(1) = "BPR=[M:PIH0]BPR & STA=3 & CPY=GSOCIETE & ACCDAT<=[M:PIH0]ACCDAT"
 PARMSK(2) = "AB"
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPIH","TRTACHSEL1","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

$ON_EECICT2
Onevent AFTER_CHANGE Gosub AMM_EECICT2 From W1PIH1
Onevent CONTROL Call C_EECICT2(zc) From W1PIH1
Onevent BEFORE_INPUT Call AS_EECICT2(zc) From W1PIH1
Return

Subprog AS_EECICT2(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(5345,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Onkey 129 Titled GBOUT1 Call B1_EECICT2(zc) From W1PIH1
Onkey   2 Titled GBOUTS Call S_EECICT2(zc) From W1PIH1
Onkey 144 Titled GBOUTP Call P_EECICT2(zc) From W1PIH1
Onkey 146 Titled GBOUTA Call SA_EECICT2(zc) From W1PIH1
Gosub _AFF
End

Subprog C_EECICT2(VALEUR)
Variable Char    VALEUR()
## Action %CNTOBJ
Call CONTSEL("ICT","!",VALEUR,"",mkstat) From CONTOBJ
If mkstat : GERR = 1 : GZONE = "EECICT2" : GZNUM = 42406 : Endif
Gosub _AFF
End

$AMM_EECICT2
Call AM_EECICT2(zc)
If !mkstat & GOBJET
 zoncou = "EECICT2" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_EECICT2(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_EECICT2(VALEUR) From SUBPIH
If mkstat : GERR = 1 : GZONE = "EECICT2" : GZNUM = 42406 : Endif
If !mkstat & evalue("dim("+clanam([M])+"ZEECICT2)")>indice
 [M]EECICT2(indice) = VALEUR
 Affzo ZEECICT2(indice)
Endif
Gosub _AFF
End

Subprog S_EECICT2(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16)
PARMSK(1) = "ICT"
PARMSK(2) = "!"
Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJ","SELOBJ","") From GACTION
Gosub _AFF
End

Subprog B1_EECICT2(VALEUR)
Variable Char    VALEUR()
Call OBJET("ICT",VALEUR,"") From GOBJET
Gosub _AFF
End

Subprog SA_EECICT2(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "ICT"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_EECICT2(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("ICT",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZEECICT2
Onevent BEFORE_AREA Gosub AV_ZEECICT2 From W1PIH1
Return

$AV_ZEECICT2
Call LECTEXTRA(zc,"INCOTERM","DES",num$([M]EECICT2(indice)),"") From ATEXTRA
Gosub _AFF
Return

$ON_ICTCTY2
Onevent AFTER_CHANGE Gosub AMM_ICTCTY2 From W1PIH1
Onevent BEFORE_INPUT Call AS_ICTCTY2(zc) From W1PIH1
Return

Subprog AS_ICTCTY2(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(15597,GBOUTS) From OBJDIV
Onkey   2 Titled GBOUTS Call S_ICTCTY2(zc) From W1PIH1
Gosub _AFF
End

$AMM_ICTCTY2
Call AM_ICTCTY2(zc)
If !mkstat & GOBJET
 zoncou = "ICTCTY2" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_ICTCTY2(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_ICTCTY2(VALEUR) From SUBPIH
If mkstat : GERR = 1 : GZONE = "ICTCTY2" : GZNUM = 0 : Endif
Gosub _AFF
End

Subprog S_ICTCTY2(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELCTY
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELCTY"
 PARMSK(1) = ""
 PARMSK(2) = [M:PCEZ]WPOSCOD
 PARMSK(3) = ""
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELCTY","SUBPOS","") From GACTION
 [M:PCEZ]WPOSCOD = PARMSK(2)
 GACTION = SAVACT
Endif
Gosub _AFF
End

$ON_LED
Return

$ON_CURLED
Return

$ON_RATMLT
Return

$ON_RATDIV
Return

$ON_MODADR
Onevent INIT_AREA Call D_MODADR(zc) From W1PIH1
Return

Subprog D_MODADR(VALEUR)
Variable Integer VALEUR
If varinit([M]MODADR,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_PJTH
Onevent BEFORE_INPUT Call AS_PJTH(zc) From W1PIH1
Onevent CONTROL Call C_PJTH(zc) From W1PIH1
Onevent AFTER_CHANGE Gosub AMM_PJTH From W1PIH1
Return

Subprog IB_PJTH(VALEUR)
Variable Char    VALEUR()
## Action PJTINIBUT
Call PJT_INIT_BUTTON(VALEUR,"PIH1","PJTH",0,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
&,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:PIH0]FCY,""
&,"","","[M:PIH3]PJT",func TRTPJT.GET_CPY_FROM_FCY([M:PIH0]FCY)) From TRTPJT
Gosub _AFF
End

Subprog AS_PJTH(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(43841,GBOUT1) From OBJDIV
Call TEXTE(14667,GBOUT2) From OBJDIV
Call TEXTE(54273,GBOUT3) From OBJDIV
Call TEXTE(43844,GBOUT4) From OBJDIV
Call TEXTE(43868,GBOUT15) From OBJDIV
Call TEXTE(17676,GBOUT16) From OBJDIV
Call TEXTE(54274,GBOUT17) From OBJDIV
Call TEXTE(54275,GBOUT18) From OBJDIV
Call TEXTE(11781,GBOUT19) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_PJTH(VALEUR)
## Action PJTBEFZON
Call PJT_BEFORE_ZONE(VALEUR,"PIH1","PJTH",0,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
&,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:PIH0]FCY,""
&,"","","[M:PIH3]PJT",func TRTPJT.GET_CPY_FROM_FCY([M:PIH0]FCY)) From TRTPJT
If mkstat=2
 [M]PJTH(INDIC) = VALEUR
 Affzo PJTH(INDIC) : mkstat = 2
Endif
Onkey 129 Titled GBOUT1 Call B1_PJTH(zc) From W1PIH1
Onkey 130 Titled GBOUT2 Call B2_PJTH(zc) From W1PIH1
Onkey 131 Titled GBOUT3 Call B3_PJTH(zc) From W1PIH1
Onkey 132 Titled GBOUT4 Call B4_PJTH(zc) From W1PIH1
Onkey 172 Titled GBOUT15 Call B15_PJTH(zc) From W1PIH1
Onkey 173 Titled GBOUT16 Call B16_PJTH(zc) From W1PIH1
Onkey 174 Titled GBOUT17 Call B17_PJTH(zc) From W1PIH1
Onkey 175 Titled GBOUT18 Call B18_PJTH(zc) From W1PIH1
Onkey 176 Titled GBOUT19 Call B19_PJTH(zc) From W1PIH1
Onkey   2 Titled GBOUTS Call S_PJTH(zc) From W1PIH1
Onkey 144 Titled GBOUTP Call P_PJTH(zc) From W1PIH1
Onkey 146 Titled GBOUTA Call SA_PJTH(zc) From W1PIH1
Gosub _AFF
End

Subprog C_PJTH(VALEUR)
Variable Char    VALEUR()
## Action PJTCTL
Call PJT_CONTROL(VALEUR,"PIH1","PJTH",0,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
&,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:PIH0]FCY,""
&,"","","[M:PIH3]PJT",func TRTPJT.GET_CPY_FROM_FCY([M:PIH0]FCY)) From TRTPJT
If mkstat : GERR = 1 : GZONE = "PJTH" : GZNUM = 18260 : Endif
If !mkstat
 ## Action CONTOBJN
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "CONTOBJN"
 Call S_AFF_CHAR(VALEUR,PARMSK,"CONTOBJN","CONTOBJ","") From GACTION
 GACTION = SAVACT
 If mkstat : GERR = 1 : GZONE = "PJTH" : GZNUM = 18260 : Endif
Endif
Gosub _AFF
End

$AMM_PJTH
Call AM_PJTH(zc)
If !mkstat & GOBJET
 zoncou = "PJTH" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_PJTH(VALEUR)
Variable Char    VALEUR()
## Action PJTAFTMOD
Call PJT_AFTER_MODIFY(VALEUR,"PIH1","PJTH",0,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
&,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:PIH0]FCY,""
&,"","","[M:PIH3]PJT",func TRTPJT.GET_CPY_FROM_FCY([M:PIH0]FCY)) From TRTPJT
If mkstat : GERR = 1 : GZONE = "PJTH" : GZNUM = 18260 : Endif
If !mkstat
 ## Action STD
 Call AM_PJTH(VALEUR) From SUBPIH
 If mkstat : GERR = 1 : GZONE = "PJTH" : GZNUM = 18260 : Endif
 If !mkstat & evalue("dim("+clanam([M])+"ZPJTH)")>indice
  [M]PJTH(indice) = VALEUR
  Affzo ZPJTH(indice)
 Endif
Endif
Gosub _AFF
End

Subprog S_PJTH(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBUT
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBUT"
 PARMSK(1) = "PIH1"
 PARMSK(2) = "PJTH"
 PARMSK(3) = "0"
 PARMSK(4) = "6"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:PIH0]FCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = "[M:PIH3]PJT"
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:PIH0]FCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJT","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B1_PJTH(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTBU1CRM
 Call PJT_BUT1_CRM(VALEUR,"PIH1","PJTH",0,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
& ,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:PIH0]FCY,""
& ,"","","[M:PIH3]PJT",func TRTPJT.GET_CPY_FROM_FCY([M:PIH0]FCY)) From TRTPJT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B2_PJTH(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTBU2PRP
 Call PJT_BUT2_PRP(VALEUR,"PIH1","PJTH",0,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
& ,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:PIH0]FCY,""
& ,"","","[M:PIH3]PJT",func TRTPJT.GET_CPY_FROM_FCY([M:PIH0]FCY)) From TRTPJT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B3_PJTH(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTBU3BUD
 Call PJT_BUT3_PRPBUD(VALEUR,"PIH1","PJTH",0,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
& ,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:PIH0]FCY,""
& ,"","","[M:PIH3]PJT",func TRTPJT.GET_CPY_FROM_FCY([M:PIH0]FCY)) From TRTPJT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B4_PJTH(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTBU4TAC
 Call PJT_BUT4_PRPTAC(VALEUR,"PIH1","PJTH",0,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
& ,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:PIH0]FCY,""
& ,"","","[M:PIH3]PJT",func TRTPJT.GET_CPY_FROM_FCY([M:PIH0]FCY)) From TRTPJT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B15_PJTH(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBCRM
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBCRM"
 PARMSK(1) = "PIH1"
 PARMSK(2) = "PJTH"
 PARMSK(3) = "0"
 PARMSK(4) = "6"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:PIH0]FCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = "[M:PIH3]PJT"
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:PIH0]FCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTCRM","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B16_PJTH(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBPRP
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBPRP"
 PARMSK(1) = "PIH1"
 PARMSK(2) = "PJTH"
 PARMSK(3) = "0"
 PARMSK(4) = "6"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:PIH0]FCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = "[M:PIH3]PJT"
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:PIH0]FCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTPRP","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B17_PJTH(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBBUD
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBBUD"
 PARMSK(1) = "PIH1"
 PARMSK(2) = "PJTH"
 PARMSK(3) = "0"
 PARMSK(4) = "6"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:PIH0]FCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = "[M:PIH3]PJT"
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:PIH0]FCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTBUD","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B18_PJTH(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBTAC
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBTAC"
 PARMSK(1) = "PIH1"
 PARMSK(2) = "PJTH"
 PARMSK(3) = "0"
 PARMSK(4) = "6"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:PIH0]FCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = "[M:PIH3]PJT"
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:PIH0]FCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTTAC","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B19_PJTH(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBBPR
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBBPR"
 PARMSK(1) = "PIH1"
 PARMSK(2) = "PJTH"
 PARMSK(3) = "0"
 PARMSK(4) = "6"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:PIH0]FCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = "[M:PIH3]PJT"
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:PIH0]FCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTBPR","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog SA_PJTH(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "PIM"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_PJTH(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("PIM",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZPJTH
Onevent BEFORE_AREA Gosub AV_ZPJTH From W1PIH1
Return

$AV_ZPJTH
Call LECTEXTRA(zc,"PIMPL","PIMDESAXX",num$([M]PJTH(indice)),"") From ATEXTRA
Gosub _AFF
Return

$ON_STRDUDDAT
Onevent CONTROL Call C_STRDUDDAT(zc) From W1PIH1
Onevent BEFORE_AREA Gosub AV_STRDUDDAT From W1PIH1
Return

$AV_STRDUDDAT
Chgfmt [M]STRDUDDAT(indice) With "DzZ:"+GFMDAT
Gosub _AFF
Return

Subprog C_STRDUDDAT(VALEUR)
Variable Date    VALEUR
## Action %OBLIG
If VALEUR=[0/0/0]
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "STRDUDDAT" : GZNUM = 3604 : Endif
Gosub _AFF
End

$ON_DUDDAT1
Onevent BEFORE_AREA Gosub AV_DUDDAT1 From W1PIH1
Return

$AV_DUDDAT1
Chgfmt [M]DUDDAT1(indice) With "DPzZ:"+GFMDAT
Gosub _AFF
Return

$ON_PTE
Onevent CONTROL Call C_PTE(zc) From W1PIH1
Onevent BEFORE_INPUT Call AS_PTE(zc) From W1PIH1
Onevent AFTER_CHANGE Gosub AMM_PTE From W1PIH1
Return

Subprog IB_PTE(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action IBTUNLEG
 Call IBTUNLEG("") From TRTVENCTL
Endif
Gosub _AFF
End

Subprog AS_PTE(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(3589,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_PTE(VALEUR)
Onkey 129 Titled GBOUT1 Call B1_PTE(zc) From W1PIH1
Onkey   2 Titled GBOUTS Call S_PTE(zc) From W1PIH1
Onkey 144 Titled GBOUTP Call P_PTE(zc) From W1PIH1
Onkey 146 Titled GBOUTA Call SA_PTE(zc) From W1PIH1
Gosub _AFF
End

Subprog C_PTE(VALEUR)
Variable Char    VALEUR()
## Action CONTTPT
Call CONTTPT(VALEUR,GCURLEG,"","",[M:PIH0]FCY,"",GSOCIETE) From SUBTPT
If mkstat : GERR = 1 : GZONE = "PTE" : GZNUM = 3624 : Endif
If !mkstat
 ## Action CONTOBJN
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "CONTOBJN"
 Call S_AFF_CHAR(VALEUR,PARMSK,"CONTOBJN","CONTOBJ","") From GACTION
 GACTION = SAVACT
 If mkstat : GERR = 1 : GZONE = "PTE" : GZNUM = 3624 : Endif
 If !mkstat
  ## Action STD
  Call C_PTE(VALEUR) From SUBPIH
  If mkstat : GERR = 1 : GZONE = "PTE" : GZNUM = 3624 : Endif
 Endif
Endif
Gosub _AFF
End

$AMM_PTE
Call AM_PTE(zc)
If !mkstat & GOBJET
 zoncou = "PTE" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_PTE(VALEUR)
Variable Char    VALEUR()
If !mkstat & evalue("dim("+clanam([M])+"ZPTE)")>indice
 [M]PTE(indice) = VALEUR
 Affzo ZPTE(indice)
Endif
Gosub _AFF
End

Subprog S_PTE(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELTPTLEG
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELTPTLEG"
 PARMSK(1) = GCURLEG
 PARMSK(2) = [M:PIH0]FCY
 PARMSK(3) = ""
 PARMSK(4) = GSOCIETE
 PARMSK(5) = ""
 PARMSK(6) = ""
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELTPT","SUBTPT","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B1_PTE(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action TUNTPT
 Call TUNTPT(VALEUR,GCURLEG) From SUBTPT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog SA_PTE(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "TPT"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_PTE(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("TPT",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZPTE
Onevent BEFORE_AREA Gosub AV_ZPTE From W1PIH1
Return

$AV_ZPTE
Call LECTEXTRA(zc,"TABPAYTERM","DESAXX",num$([M]PTE(indice)),"") From ATEXTRA
Gosub _AFF
Return

$ON_DEP
Onevent CONTROL Call C_DEP(zc) From W1PIH1
Onevent AFTER_CHANGE Gosub AMM_DEP From W1PIH1
Onevent BEFORE_INPUT Call AS_DEP(zc) From W1PIH1
Return

Subprog IB_DEP(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action IBTUNLEG
 Call IBTUNLEG("") From TRTVENCTL
Endif
Gosub _AFF
End

Subprog AS_DEP(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(3585,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_DEP(VALEUR)
Onkey 129 Titled GBOUT1 Call B1_DEP(zc) From W1PIH1
Onkey   2 Titled GBOUTS Call S_DEP(zc) From W1PIH1
Onkey 144 Titled GBOUTP Call P_DEP(zc) From W1PIH1
Onkey 146 Titled GBOUTA Call SA_DEP(zc) From W1PIH1
Gosub _AFF
End

Subprog C_DEP(VALEUR)
Variable Char    VALEUR()
## Action CONTTDA
Call CONTTDA(VALEUR,GCURLEG,"PIH1","DEP",[M:PIH0]FCY,"",GSOCIETE) From SUBTDA
If mkstat : GERR = 1 : GZONE = "DEP" : GZNUM = 1669 : Endif
If !mkstat
 ## Action CONTOBJN
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "CONTOBJN"
 Call S_AFF_CHAR(VALEUR,PARMSK,"CONTOBJN","CONTOBJ","") From GACTION
 GACTION = SAVACT
 If mkstat : GERR = 1 : GZONE = "DEP" : GZNUM = 1669 : Endif
Endif
Gosub _AFF
End

$AMM_DEP
Call AM_DEP(zc)
If !mkstat & GOBJET
 zoncou = "DEP" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_DEP(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_DEP(VALEUR) From SUBPIH
If mkstat : GERR = 1 : GZONE = "DEP" : GZNUM = 1669 : Endif
If !mkstat & evalue("dim("+clanam([M])+"ZDEP)")>indice
 [M]DEP(indice) = VALEUR
 Affzo ZDEP(indice)
Endif
Gosub _AFF
End

Subprog S_DEP(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELTDALEG
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELTDALEG"
 PARMSK(1) = GCURLEG
 PARMSK(2) = "PIH1"
 PARMSK(3) = "DEP"
 PARMSK(4) = [M:PIH0]FCY
 PARMSK(5) = ""
 PARMSK(6) = GSOCIETE
 PARMSK(7) = ""
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELTDA","SUBTDA","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B1_DEP(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action TUNTDA
 Call TUNTDA(VALEUR,GCURLEG) From SUBTDA
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog SA_DEP(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "TDA"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_DEP(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("TDA",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZDEP
Onevent BEFORE_AREA Gosub AV_ZDEP From W1PIH1
Return

$AV_ZDEP
Call LECTEXTRA(zc,"TABDEPAGIO","SHOAXX",num$([M]DEP(indice)),"") From ATEXTRA
Gosub _AFF
Return

$ON_VAC
Onevent CONTROL Call C_VAC(zc) From W1PIH1
Onevent AFTER_AREA Call AP_VAC(zc) From W1PIH1
Onevent AFTER_CHANGE Gosub AMM_VAC From W1PIH1
Onevent BEFORE_INPUT Call AS_VAC(zc) From W1PIH1
Return

Subprog IB_VAC(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action IBTUNLEG
 Call IBTUNLEG("") From TRTVENCTL
Endif
Gosub _AFF
End

Subprog AS_VAC(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(28739,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_VAC(VALEUR)
Onkey 129 Titled GBOUT1 Call B1_VAC(zc) From W1PIH1
Onkey   2 Titled GBOUTS Call S_VAC(zc) From W1PIH1
Onkey 144 Titled GBOUTP Call P_VAC(zc) From W1PIH1
Onkey 146 Titled GBOUTA Call SA_VAC(zc) From W1PIH1
Gosub _AFF
End

Subprog C_VAC(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "VAC" : GZNUM = 3673 : Endif
If !mkstat
 ## Action CONTTVB
 Call CONTTVB(VALEUR,GCURLEG,"PIH1","VAC",[M:PIH0]FCY,"",GSOCIETE) From SUBTVB
 If mkstat : GERR = 1 : GZONE = "VAC" : GZNUM = 3673 : Endif
 If !mkstat
  ## Action CONTOBJN
  Local Char    PARMSK(250)(1..20) , SAVACT(20)
  SAVACT = GACTION : GACTION = "CONTOBJN"
  Call S_AFF_CHAR(VALEUR,PARMSK,"CONTOBJN","CONTOBJ","") From GACTION
  GACTION = SAVACT
  If mkstat : GERR = 1 : GZONE = "VAC" : GZNUM = 3673 : Endif
 Endif
Endif
Gosub _AFF
End

Subprog AP_VAC(VALEUR)
Variable Char    VALEUR()
## Action PAPVACBPR
[M]VACTYP=[F:TVB]REGVAC
If mkstat : GERR = 1 : GZONE = "VAC" : GZNUM = 3673 : Endif
Gosub _AFF
End

$AMM_VAC
Call AM_VAC(zc)
If !mkstat & GOBJET
 zoncou = "VAC" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_VAC(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_VAC(VALEUR) From SUBPIH
If mkstat : GERR = 1 : GZONE = "VAC" : GZNUM = 3673 : Endif
If !mkstat & evalue("dim("+clanam([M])+"ZVAC)")>indice
 [M]VAC(indice) = VALEUR
 Affzo ZVAC(indice)
Endif
Gosub _AFF
End

Subprog S_VAC(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELTVBLEG
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELTVBLEG"
 PARMSK(1) = GCURLEG
 PARMSK(2) = [M:PIH0]FCY
 PARMSK(3) = ""
 PARMSK(4) = GSOCIETE
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELTVB","SUBTVB","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B1_VAC(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action TUNTVB
 Call TUNTVB(VALEUR,GCURLEG) From SUBTVB
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog SA_VAC(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "TVB"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_VAC(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("TVB",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZVAC
Onevent BEFORE_AREA Gosub AV_ZVAC From W1PIH1
Return

$AV_ZVAC
Call LECTEXTRA(zc,"TABVACBPR","DESAXX",num$([M]VAC(indice)),"") From ATEXTRA
Gosub _AFF
Return

$ON_DAS2
Onevent INIT_AREA Call D_DAS2(zc) From W1PIH1
Onevent BEFORE_INPUT Call AS_DAS2(zc) From W1PIH1
Return

Subprog D_DAS2(VALEUR)
Variable Integer VALEUR
If varinit([M]DAS2,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

Subprog AS_DAS2(VALEUR)
Variable Integer VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
If VALEUR<1
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_STRDATSVC
Onevent AFTER_CHANGE Gosub AMM_STRDATSVC From W1PIH1
Onevent BEFORE_AREA Gosub AV_STRDATSVC From W1PIH1
Return

$AV_STRDATSVC
If GPIH_FMTPER(4)<>""
 Chgfmt [M]STRDATSVC(indice) With GPIH_FMTPER(4)
Else
 Chgfmt [M]STRDATSVC(indice) With "-K:1X"
Endif
Gosub _AFF
Return

$AMM_STRDATSVC
Call AM_STRDATSVC(zc)
If !mkstat & GOBJET
 zoncou = "STRDATSVC" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_STRDATSVC(VALEUR)
Variable Date    VALEUR
## Action STD
Call AM_STRDATSVC(VALEUR) From SUBPIH
If mkstat : GERR = 1 : GZONE = "STRDATSVC" : GZNUM = 20661 : Endif
Gosub _AFF
End

$ON_ENDDATSVC
Onevent BEFORE_INPUT Call AS_ENDDATSVC(zc) From W1PIH1
Onevent CONTROL Call C_ENDDATSVC(zc) From W1PIH1
Onevent AFTER_CHANGE Gosub AMM_ENDDATSVC From W1PIH1
Onevent BEFORE_AREA Gosub AV_ENDDATSVC From W1PIH1
Return

$AV_ENDDATSVC
If GPIH_FMTPER(5)<>""
 Chgfmt [M]ENDDATSVC(indice) With GPIH_FMTPER(5)
Else
 Chgfmt [M]ENDDATSVC(indice) With "-K:1X"
Endif
Gosub _AFF
Return

Subprog AS_ENDDATSVC(VALEUR)
Variable Date    VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
## Action STD
Call AS_ENDDATSVC(VALEUR) From SUBPIH
If mkstat=2
 [M]ENDDATSVC(INDIC) = VALEUR
 Affzo ENDDATSVC(INDIC) : mkstat = 2
Endif
Gosub _AFF
End

Subprog C_ENDDATSVC(VALEUR)
Variable Date    VALEUR
## Action DATDEBFIN
Call DATDEBFIN(VALEUR,[M:PIH1]STRDATSVC) From EXEFNC
If mkstat : GERR = 1 : GZONE = "ENDDATSVC" : GZNUM = 20663 : Endif
If !mkstat
 ## Action STD
 Call C_ENDDATSVC(VALEUR) From SUBPIH
 If mkstat : GERR = 1 : GZONE = "ENDDATSVC" : GZNUM = 20663 : Endif
Endif
Gosub _AFF
End

$AMM_ENDDATSVC
Call AM_ENDDATSVC(zc)
If !mkstat & GOBJET
 zoncou = "ENDDATSVC" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_ENDDATSVC(VALEUR)
Variable Date    VALEUR
## Action STD
Call AM_ENDDATSVC(VALEUR) From SUBPIH
If mkstat : GERR = 1 : GZONE = "ENDDATSVC" : GZNUM = 20663 : Endif
Gosub _AFF
End

$ON_FRM1099
Onevent AFTER_CHANGE Gosub AMM_FRM1099 From W1PIH1
Onevent INIT_AREA Call D_FRM1099(zc) From W1PIH1
Onevent BEFORE_INPUT Call AS_FRM1099(zc) From W1PIH1
Return

Subprog D_FRM1099(VALEUR)
Variable Integer VALEUR
If varinit([M]FRM1099,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

Subprog AS_FRM1099(VALEUR)
Variable Integer VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
If VALEUR<1
 VALEUR = 1
Endif
Gosub _AFF
End

$AMM_FRM1099
Call AM_FRM1099(zc)
If !mkstat & GOBJET
 zoncou = "FRM1099" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_FRM1099(VALEUR)
Variable Integer VALEUR
## Action STD
Call AM_FRM1099(VALEUR) From SUBPIH
If mkstat : GERR = 1 : GZONE = "FRM1099" : GZNUM = 44093 : Endif
Gosub _AFF
End

$ON_BOX1099
Onevent CONTROL Call C_BOX1099(zc) From W1PIH1
Onevent BEFORE_INPUT Call AS_BOX1099(zc) From W1PIH1
Return

Subprog AS_BOX1099(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(15597,GBOUTS) From OBJDIV
Onkey   2 Titled GBOUTS Call S_BOX1099(zc) From W1PIH1
Gosub _AFF
End

Subprog C_BOX1099(VALEUR)
Variable Char    VALEUR()
## Action CNTBOX1099
Call CNTBOX1099(VALEUR,[M]FRM1099) From TEN99LIB
If mkstat : GERR = 1 : GZONE = "BOX1099" : GZNUM = 44094 : Endif
Gosub _AFF
End

Subprog S_BOX1099(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELBX9
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELBX9"
 PARMSK(1) = num$([M]FRM1099)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELBX9","TEN99LIB","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

$CHG_STY
Gosub CHG_STY From W2PIH1
Return

$TIT_COL
Gosub TIT_COL From W2PIH1
Return


