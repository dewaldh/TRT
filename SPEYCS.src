#<AdxTL>@(#)0.0.0.0 $Revision$
# Mask management YCSWEB (Specific)

######################################################################################
## Section automatically added (screen YCSWEB) 14/02/2019 00:28:43 (ADMIN)
######################################################################################
$ACTION
Case ACTION
  When "OUVRE" : Gosub OUVRE
  When "LIENS" : Gosub LIENS
 When Default
Endcase
Return

Subprog CL_YCREFLD(VALEUR)
Variable Char    VALEUR()

  Infbox 'Create new button clicked', "Object: " + GABREV,[M:YCS0]YOBJID

End

#------------------------------------------------------------------------------------#
#Open needed tables
#------------------------------------------------------------------------------------#
$OUVRE

If clalev([F:YCSFL]) = 0 : Local File YCSVRFR[YCSFL] : Endif
If clalev([F:YCSL]) = 0 : Local File YCSLNK[YCSL] : Endif

Return

#------------------------------------------------------------------------------------#
#Load content server rules based on the object.
#------------------------------------------------------------------------------------#
$LIENS
Local Char YWEBURL(250)
Local Char YCSBASE,YCSNODE

#get all the url paramaters for the CS connection
#Content server base URL
  If func AFNC.PARAM("YCSBASE", "") <> ""
    YCSBASE = func AFNC.PARAM("YCSBASE", "")
  Else
    GMESSAGE = "Content server base url not defined in the paramaters: YCSBASE"
    GERR = 1
    Return
  Endif

  If func AFNC.PARAM("YCSNODE", "") <> ""
    YCSNODE = func AFNC.PARAM("YCSNODE", "")
  Else
    GMESSAGE = "Content server node url not defined in the paramaters: YCSNODE"
    GERR = 1
    Return
  Endif

  If func AFNC.PARAM("YCSWEBURL", "") <> ""
    YWEBURL = func AFNC.PARAM("YCSWEBURL", "")
  Else
    GMESSAGE = "Content server component url not defined in the paramaters: YCSWEBURL"
    GERR = 1
    Return
  Endif


Read [F:YCSFL]YCSFL0 = GABREV
#read succesfull
If fstat = 0
  Read [F:YCSL]YCSL1 = GABREV;num$(evalue([F:YCSFL]YOBJIDFLD))
  If fstat = 0

    YWEBURL = left$(YWEBURL,instr(1,YWEBURL,"~")-1) + YCSBASE + YCSNODE + [F:YCSL]YCSNID + right$(YWEBURL,instr(1,YWEBURL,"~")+1)

    #set the URL to open CS at the saved node id.
    [M:YCS0]YOBJID = YWEBURL
    #disable buttons
    Diszo [M:YCS0]YCREFLD
    Diszo [M:YCS0]YLINK
    Affzo [M:YCS0]
  Else
    #Content server base URL
    If func AFNC.PARAM("YCSBASE", "") <> ""
      YWEBURL = left$(YWEBURL,instr(1,YWEBURL,"~")-1) + func AFNC.PARAM("YCSBASE", "") + right$(YWEBURL,instr(1,YWEBURL,"~")+1)
      [M:YCS0]YOBJID = YWEBURL
    Endif
  Endif
Else
  #no object was found. display message and disable buttons.
  GMESSAGE = "No Content server filing rules found for object type " + GABREV
  GERR = 1

  #Content server default URL
  If func AFNC.PARAM("YCSDEF", "") <> ""
    YWEBURL = left$(YWEBURL,instr(1,YWEBURL,"~")-1) + func AFNC.PARAM("YCSDEF", "") + right$(YWEBURL,instr(1,YWEBURL,"~")+1)
    [M:YCS0]YOBJID = YWEBURL
  Endif

Endif




Return

######################################################################################
## Section automatically added (screen YCSWEB) 14/02/2019 05:26:19 (ADMIN)
######################################################################################
Subprog IB_YOBJID
End


######################################################################################

