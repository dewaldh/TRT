#<AdxTL>@(#)0.0.0.0 $Revision$
# Supervisor
# Mask management WT04LOM1 

$_AFF
If GIMPORT
 Gosub AFF From GSAISIE
Else
 If GMESSAGE <>""
  Gosub ERR From GSAISIE
 Else
  Raz GERR , GZNUM
 Endif
Endif
Return

$HORODAT
Local Date    A_DATE
Local Char    A_HEURE(10) , A_USER(10)
Local Char    A_STAMP(15)
A_DATE  = [28/08/2018]
A_HEURE = "00:28:27"
A_USER  = "ADMIN"
A_STAMP = "20180828002827"
Return

$TITRES
Chgtzn [M:SMX1]USRFLD1OLD With mess(1,726,1)
Chgtzn [M:SMX1]USRFLD2OLD With mess(2,726,1)
Chgtzn [M:SMX1]USRFLD3OLD With mess(3,726,1)
Chgtzn [M:SMX1]USRFLD4OLX With mess(4,726,1)
Chgtzn [M:SMX1]USRFLD1 With mess(1,726,1)
Chgtzn [M:SMX1]USRFLD2 With mess(2,726,1)
Chgtzn [M:SMX1]USRFLD3 With mess(3,726,1)
Chgtzn [M:SMX1]USRFLD4 With mess(4,726,1)
Return

$VISU
Local Integer A_REPONSE
Global Integer GPRE_VIEW
If dim(A_WINDPREV)<=0 : Local Char A_WINDPREV(30) : Endif
Local Mask WT04LOM1 [SMX1]
Gosub HORODAT
Local Inpbox "WT04LOM1" From GFONCTION At A_STAMP With A_WINDPREV Mask [SMX1] As [SIM_]
Grizo [SMX1]5
Grizo [SMX1]10
Grizo [SMX1]15
Grizo [SMX1]20
Boxact [SIM_]
Gosub TITRES
Boxinp [SIM_] Using A_REPONSE
Close Local Inpbox [SIM_]
Close Local Mask [SMX1]
Kill GPRE_VIEW
Return

$HARDCOP
Local Integer X1(0..14),X2(0..14),Y1(0..14),Y2(0..14)
X1(0)=5 : X2(0)=108 : Y1(0)=1 : Y2(0)=5
X1(1)=5 : X2(1)=108 : Y1(1)=6 : Y2(1)=8
X1(2)=5 : X2(2)=56 : Y1(2)=9 : Y2(2)=28
X1(3)=57 : X2(3)=108 : Y1(3)=9 : Y2(3)=28
Return

$ON_STOFCY
Onevent CONTROL Call C_STOFCY(zc) From W1WT04LOM1
Onevent BEFORE_INPUT Call AS_STOFCY(zc) From W1WT04LOM1
Onevent AFTER_CHANGE Gosub AMM_STOFCY From W1WT04LOM1
Return

Subprog AS_STOFCY(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(1427,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
## Action STKASFCY
Call STKASFCY(VALEUR) From STKACT
If mkstat=2
 [M]STOFCY(INDIC) = VALEUR
 Affzo STOFCY(INDIC) : mkstat = 2
Endif
Onkey 129 Titled GBOUT1 Call B1_STOFCY(zc) From W1WT04LOM1
Onkey   2 Titled GBOUTS Call S_STOFCY(zc) From W1WT04LOM1
Onkey 144 Titled GBOUTP Call P_STOFCY(zc) From W1WT04LOM1
Onkey 146 Titled GBOUTA Call SA_STOFCY(zc) From W1WT04LOM1
Gosub _AFF
End

Subprog C_STOFCY(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "STOFCY" : GZNUM = 1347 : Endif
If !mkstat
 ## Action ACONTFCY
 Call CONTSITE(VALEUR) From SUBAGF
 If mkstat : GERR = 1 : GZONE = "STOFCY" : GZNUM = 1347 : Endif
 If !mkstat
  ## Action %CNTOBJ
  Call CONTSEL("FCY","",VALEUR,"",mkstat) From CONTOBJ
  If mkstat : GERR = 1 : GZONE = "STOFCY" : GZNUM = 1347 : Endif
  If !mkstat
   ## Action STKCTRFCY
   Call STKCTRFCY(VALEUR) From STKACT
   If mkstat : GERR = 1 : GZONE = "STOFCY" : GZNUM = 1347 : Endif
  Endif
 Endif
Endif
Gosub _AFF
End

$AMM_STOFCY
Call AM_STOFCY(zc)
If !mkstat & GOBJET
 zoncou = "STOFCY" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_STOFCY(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_STOFCY(VALEUR) From SUBSMX
If mkstat : GERR = 1 : GZONE = "STOFCY" : GZNUM = 1347 : Endif
If !mkstat & evalue("dim("+clanam([M])+"ZSTOFCY)")>indice
 [M]STOFCY(indice) = VALEUR
 Affzo ZSTOFCY(indice)
Endif
Gosub _AFF
End

Subprog S_STOFCY(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16)
PARMSK(1) = "FCY"
PARMSK(2) = ""
Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJ","SELOBJ","") From GACTION
Gosub _AFF
End

Subprog B1_STOFCY(VALEUR)
Variable Char    VALEUR()
Call OBJET("FCY",VALEUR,"") From GOBJET
Gosub _AFF
End

Subprog SA_STOFCY(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "FCY"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_STOFCY(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("FCY",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZSTOFCY
Onevent BEFORE_AREA Gosub AV_ZSTOFCY From W1WT04LOM1
Return

$AV_ZSTOFCY
If clalev([F:FCY])=0 : Local File FACILITY [FCY] : Endif
Call LECTURE("FCY",num$([M]STOFCY(indice)),"") From CONTOBJ
zc = [F:FCY]FCYNAM
Gosub _AFF
Return

$ON_CHANGECOD
Onevent INIT_AREA Call D_CHANGECOD(zc) From W1WT04LOM1
Return

Subprog D_CHANGECOD(VALEUR)
Variable Integer VALEUR
If varinit([M]CHANGECOD,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_VCRTYP
Onevent INIT_AREA Call D_VCRTYP(zc) From W1WT04LOM1
Return

Subprog D_VCRTYP(VALEUR)
Variable Integer VALEUR
If varinit([M]VCRTYP,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_VCRNUM
Onevent CONTROL Call C_VCRNUM(zc) From W1WT04LOM1
Onevent INIT_AREA Call D_VCRNUM(zc) From W1WT04LOM1
Onevent BEFORE_INPUT Call AS_VCRNUM(zc) From W1WT04LOM1
Return

Subprog D_VCRNUM(VALEUR)
Variable Char    VALEUR()
If varinit([M]VCRNUM,indice)=0
 ## Action STD
 Call D_VCRNUM(VALEUR) From SUBSMX
Endif
Gosub _AFF
End

Subprog AS_VCRNUM(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(15597,GBOUTS) From OBJDIV
Onkey   2 Titled GBOUTS Call S_VCRNUM(zc) From W1WT04LOM1
Gosub _AFF
End

Subprog C_VCRNUM(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action CONTVCR
 Call CONTVCR(VALEUR) From TRTDIV
 If mkstat : GERR = 1 : GZONE = "VCRNUM" : GZNUM = 3170 : Endif
Endif
If !mkstat
 ## Action STD
 Call C_VCRNUM(VALEUR) From SUBSMX
 If mkstat : GERR = 1 : GZONE = "VCRNUM" : GZNUM = 3170 : Endif
Endif
Gosub _AFF
End

Subprog S_VCRNUM(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELOBJET
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELOBJET"
 PARMSK(1) = "SMX"
 PARMSK(2) = "VCRNUM"
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJET","SELOBJ","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

$ON_IPTDAT
Onevent CONTROL Call C_IPTDAT(zc) From W1WT04LOM1
Onevent INIT_AREA Call D_IPTDAT(zc) From W1WT04LOM1
Onevent BEFORE_AREA Gosub AV_IPTDAT From W1WT04LOM1
Return

$AV_IPTDAT
Chgfmt [M]IPTDAT(indice) With "DZ:"+GFMDAT4
Gosub _AFF
Return

Subprog D_IPTDAT(VALEUR)
Variable Date    VALEUR
If varinit([M]IPTDAT,indice)=0
 VALEUR = date$
Endif
Gosub _AFF
End

Subprog C_IPTDAT(VALEUR)
Variable Date    VALEUR
## Action STKCTRIPT
Call STKCTRIPT(VALEUR,[M]STOFCY,"1") From STKLIB
If mkstat : GERR = 1 : GZONE = "IPTDAT" : GZNUM = 3205 : Endif
Gosub _AFF
End

$ON_TRSFAM
Onevent INIT_AREA Call D_TRSFAM(zc) From W1WT04LOM1
Onevent CONTROL Call C_TRSFAM(zc) From W1WT04LOM1
Onevent BEFORE_INPUT Call AS_TRSFAM(zc) From W1WT04LOM1
Onevent AFTER_CHANGE Gosub AMM_TRSFAM From W1WT04LOM1
Return

Subprog D_TRSFAM(VALEUR)
Variable Char    VALEUR()
If varinit([M]TRSFAM,indice)=0
 ## Action INILEG
 Call INILEG(VALEUR,"9","") From SUBADI
Endif
Gosub _AFF
End

Subprog AS_TRSFAM(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Onkey   2 Titled GBOUTS Call S_TRSFAM(zc) From W1WT04LOM1
Onkey 144 Titled GBOUTP Call P_TRSFAM(zc) From W1WT04LOM1
Onkey 146 Titled GBOUTA Call SA_TRSFAM(zc) From W1WT04LOM1
Gosub _AFF
End

Subprog C_TRSFAM(VALEUR)
Variable Char    VALEUR()
## Action CONTADI
Call CONTADI(VALEUR,"9","") From SUBADI
If mkstat : GERR = 1 : GZONE = "TRSFAM" : GZNUM = 17501 : Endif
If !mkstat
 ## Action %CNTOBJ
 Call CONTSEL("ADI","!",VALEUR,"9",mkstat) From CONTOBJ
 If mkstat : GERR = 1 : GZONE = "TRSFAM" : GZNUM = 17501 : Endif
Endif
Gosub _AFF
End

$AMM_TRSFAM
Call AM_TRSFAM(zc)
If !mkstat & GOBJET
 zoncou = "TRSFAM" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_TRSFAM(VALEUR)
Variable Char    VALEUR()
If !mkstat & evalue("dim("+clanam([M])+"ZTRSFAM)")>indice
 [M]TRSFAM(indice) = VALEUR
 Affzo ZTRSFAM(indice)
Endif
Gosub _AFF
End

Subprog S_TRSFAM(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELADI
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELADI"
 PARMSK(1) = "9"
 PARMSK(2) = ""
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELADI","SUBADI","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog SA_TRSFAM(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "ADI"
PARMSK(2) = "9"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_TRSFAM(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = "9"
Call VISU("ADI",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZTRSFAM
Onevent BEFORE_AREA Gosub AV_ZTRSFAM From W1WT04LOM1
Return

$AV_ZTRSFAM
Call LECTEXTRA(zc,"ATABDIV","LNGDES","9",num$([M]TRSFAM(indice))) From ATEXTRA
Gosub _AFF
Return

$ON_PJT
Onevent BEFORE_INPUT Call AS_PJT(zc) From W1WT04LOM1
Onevent CONTROL Call C_PJT(zc) From W1WT04LOM1
Onevent AFTER_CHANGE Gosub AMM_PJT From W1WT04LOM1
Return

Subprog IB_PJT(VALEUR)
Variable Char    VALEUR()
## Action PJTINIBUT
Call PJT_INIT_BUTTON(VALEUR,"SMX1","PJT",0,7,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
&,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:SMX1]STOFCY,""
&,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:SMX1]STOFCY)) From TRTPJT
Gosub _AFF
End

Subprog AS_PJT(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(43841,GBOUT1) From OBJDIV
Call TEXTE(14667,GBOUT2) From OBJDIV
Call TEXTE(54273,GBOUT3) From OBJDIV
Call TEXTE(43844,GBOUT4) From OBJDIV
Call TEXTE(43868,GBOUT15) From OBJDIV
Call TEXTE(17676,GBOUT16) From OBJDIV
Call TEXTE(54274,GBOUT17) From OBJDIV
Call TEXTE(54275,GBOUT18) From OBJDIV
Call TEXTE(11781,GBOUT19) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_PJT(VALEUR)
## Action PJTBEFZON
Call PJT_BEFORE_ZONE(VALEUR,"SMX1","PJT",0,7,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
&,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:SMX1]STOFCY,""
&,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:SMX1]STOFCY)) From TRTPJT
If mkstat=2
 [M]PJT(INDIC) = VALEUR
 Affzo PJT(INDIC) : mkstat = 2
Endif
Onkey 129 Titled GBOUT1 Call B1_PJT(zc) From W1WT04LOM1
Onkey 130 Titled GBOUT2 Call B2_PJT(zc) From W1WT04LOM1
Onkey 131 Titled GBOUT3 Call B3_PJT(zc) From W1WT04LOM1
Onkey 132 Titled GBOUT4 Call B4_PJT(zc) From W1WT04LOM1
Onkey 172 Titled GBOUT15 Call B15_PJT(zc) From W1WT04LOM1
Onkey 173 Titled GBOUT16 Call B16_PJT(zc) From W1WT04LOM1
Onkey 174 Titled GBOUT17 Call B17_PJT(zc) From W1WT04LOM1
Onkey 175 Titled GBOUT18 Call B18_PJT(zc) From W1WT04LOM1
Onkey 176 Titled GBOUT19 Call B19_PJT(zc) From W1WT04LOM1
Onkey   2 Titled GBOUTS Call S_PJT(zc) From W1WT04LOM1
Onkey 144 Titled GBOUTP Call P_PJT(zc) From W1WT04LOM1
Onkey 146 Titled GBOUTA Call SA_PJT(zc) From W1WT04LOM1
Gosub _AFF
End

Subprog C_PJT(VALEUR)
Variable Char    VALEUR()
## Action PJTCTL
Call PJT_CONTROL(VALEUR,"SMX1","PJT",0,7,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
&,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:SMX1]STOFCY,""
&,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:SMX1]STOFCY)) From TRTPJT
If mkstat : GERR = 1 : GZONE = "PJT" : GZNUM = 1886 : Endif
If !mkstat
 ## Action CONTOBJN
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "CONTOBJN"
 Call S_AFF_CHAR(VALEUR,PARMSK,"CONTOBJN","CONTOBJ","") From GACTION
 GACTION = SAVACT
 If mkstat : GERR = 1 : GZONE = "PJT" : GZNUM = 1886 : Endif
Endif
Gosub _AFF
End

$AMM_PJT
Call AM_PJT(zc)
If !mkstat & GOBJET
 zoncou = "PJT" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_PJT(VALEUR)
Variable Char    VALEUR()
## Action PJTAFTMOD
Call PJT_AFTER_MODIFY(VALEUR,"SMX1","PJT",0,7,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
&,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:SMX1]STOFCY,""
&,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:SMX1]STOFCY)) From TRTPJT
If mkstat : GERR = 1 : GZONE = "PJT" : GZNUM = 1886 : Endif
Gosub _AFF
End

Subprog S_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBUT
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBUT"
 PARMSK(1) = "SMX1"
 PARMSK(2) = "PJT"
 PARMSK(3) = "0"
 PARMSK(4) = "7"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:SMX1]STOFCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:SMX1]STOFCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJT","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B1_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTBU1CRM
 Call PJT_BUT1_CRM(VALEUR,"SMX1","PJT",0,7,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
& ,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:SMX1]STOFCY,""
& ,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:SMX1]STOFCY)) From TRTPJT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B2_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTBU2PRP
 Call PJT_BUT2_PRP(VALEUR,"SMX1","PJT",0,7,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
& ,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:SMX1]STOFCY,""
& ,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:SMX1]STOFCY)) From TRTPJT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B3_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTBU3BUD
 Call PJT_BUT3_PRPBUD(VALEUR,"SMX1","PJT",0,7,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
& ,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:SMX1]STOFCY,""
& ,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:SMX1]STOFCY)) From TRTPJT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B4_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTBU4TAC
 Call PJT_BUT4_PRPTAC(VALEUR,"SMX1","PJT",0,7,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
& ,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:SMX1]STOFCY,""
& ,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:SMX1]STOFCY)) From TRTPJT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B15_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBCRM
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBCRM"
 PARMSK(1) = "SMX1"
 PARMSK(2) = "PJT"
 PARMSK(3) = "0"
 PARMSK(4) = "7"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:SMX1]STOFCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:SMX1]STOFCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTCRM","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B16_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBPRP
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBPRP"
 PARMSK(1) = "SMX1"
 PARMSK(2) = "PJT"
 PARMSK(3) = "0"
 PARMSK(4) = "7"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:SMX1]STOFCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:SMX1]STOFCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTPRP","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B17_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBBUD
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBBUD"
 PARMSK(1) = "SMX1"
 PARMSK(2) = "PJT"
 PARMSK(3) = "0"
 PARMSK(4) = "7"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:SMX1]STOFCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:SMX1]STOFCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTBUD","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B18_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBTAC
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBTAC"
 PARMSK(1) = "SMX1"
 PARMSK(2) = "PJT"
 PARMSK(3) = "0"
 PARMSK(4) = "7"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:SMX1]STOFCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:SMX1]STOFCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTTAC","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B19_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBBPR
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBBPR"
 PARMSK(1) = "SMX1"
 PARMSK(2) = "PJT"
 PARMSK(3) = "0"
 PARMSK(4) = "7"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:SMX1]STOFCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:SMX1]STOFCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTBPR","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog SA_PJT(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "PIM"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_PJT(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("PIM",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_SLOMOD
Onevent INIT_AREA Call D_SLOMOD(zc) From W1WT04LOM1
Return

Subprog D_SLOMOD(VALEUR)
Variable Decimal VALEUR
If varinit([M]SLOMOD,indice)=0
 VALEUR = 2
Endif
Gosub _AFF
End

$ON_ITMREF
Onevent CONTROL Call C_ITMREF(zc) From W1WT04LOM1
Onevent AFTER_CHANGE Gosub AMM_ITMREF From W1WT04LOM1
Onevent BEFORE_INPUT Call AS_ITMREF(zc) From W1WT04LOM1
Return

Subprog IB_ITMREF(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action IBPRDINF
 Call IBPRDINF(VALEUR) From PRDINFLIB
Endif
Gosub _AFF
End

Subprog AS_ITMREF(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(12972,GBOUT1) From OBJDIV
Call TEXTE(12837,GBOUT13) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_ITMREF(VALEUR)
Onkey 129 Titled GBOUT1 Call B1_ITMREF(zc) From W1WT04LOM1
Onkey 170 Titled GBOUT13 Call B13_ITMREF(zc) From W1WT04LOM1
Onkey   2 Titled GBOUTS Call S_ITMREF(zc) From W1WT04LOM1
Onkey 144 Titled GBOUTP Call P_ITMREF(zc) From W1WT04LOM1
Onkey 146 Titled GBOUTA Call SA_ITMREF(zc) From W1WT04LOM1
Gosub _AFF
End

Subprog C_ITMREF(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
If !GWEBSERV
 If !mkstat
  ## Action ITMCHOICE
  Local Char    PARMSK(250)(1..20) , SAVACT(20)
  SAVACT = GACTION : GACTION = "ITMCHOICE"
  Call S_TAB_CHAR(VALEUR,PARMSK,"ITMCHOICE","TRTSEL","") From GACTION
  GACTION = SAVACT
  If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
 Endif
Endif
If !mkstat
 ## Action VXADCUPC
 Call ADCCTRUPC(VALEUR) From VXADCUPC
 If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
 If !mkstat
  ## Action %CNTOBJ
  Call CONTSEL("ITM","",VALEUR,"",mkstat) From CONTOBJ
  If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
  If !mkstat
   ## Action STD
   Call C_ITMREF(VALEUR) From SUBSMX
   If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
  Endif
 Endif
Endif
Gosub _AFF
End

$AMM_ITMREF
Call AM_ITMREF(zc)
If !mkstat & GOBJET
 zoncou = "ITMREF" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_ITMREF(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_ITMREF(VALEUR) From SUBSMX
If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
If !mkstat & evalue("dim("+clanam([M])+"ZITMREF)")>indice
 [M]ITMREF(indice) = VALEUR
 Affzo ZITMREF(indice)
Endif
Gosub _AFF
End

Subprog S_ITMREF(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELITF
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELITF"
 PARMSK(1) = [M:SMX1]STOFCY
 PARMSK(2) = ""
 PARMSK(3) = ""
 PARMSK(4) = "234"
 PARMSK(5) = "234"
 PARMSK(6) = ""
 PARMSK(7) = ""
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELITF","STKSEL","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B1_ITMREF(VALEUR)
Variable Char    VALEUR()
Call OBJET("ITM",VALEUR,"") From GOBJET
Gosub _AFF
End

Subprog B13_ITMREF(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PRDINFA
 Call PRDINF(VALEUR) From PRDINFLIB
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog SA_ITMREF(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "ITM"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_ITMREF(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("ITM",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ZITMREF
Onevent BEFORE_AREA Gosub AV_ZITMREF From W1WT04LOM1
Return

$AV_ZITMREF
Call LECTEXTRA(zc,"ITMMASTER","DES1AXX",num$([M]ITMREF(indice)),"") From ATEXTRA
Gosub _AFF
Return

$ON_LOT
Onevent CONTROL Call C_LOT(zc) From W1WT04LOM1
Onevent AFTER_CHANGE Gosub AMM_LOT From W1WT04LOM1
Onevent BEFORE_INPUT Call AS_LOT(zc) From W1WT04LOM1
Return

Subprog AS_LOT(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(15597,GBOUTS) From OBJDIV
Onkey   2 Titled GBOUTS Call S_LOT(zc) From W1WT04LOM1
Gosub _AFF
End

Subprog C_LOT(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "LOT" : GZNUM = 2721 : Endif
If !mkstat
 ## Action STD
 Call C_LOT(VALEUR) From SUBSMX
 If mkstat : GERR = 1 : GZONE = "LOT" : GZNUM = 2721 : Endif
Endif
Gosub _AFF
End

$AMM_LOT
Call AM_LOT(zc)
If !mkstat & GOBJET
 zoncou = "LOT" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_LOT(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_LOT(VALEUR) From SUBSMX
If mkstat : GERR = 1 : GZONE = "LOT" : GZNUM = 2721 : Endif
Gosub _AFF
End

Subprog S_LOT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action STKSELLOT
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "STKSELLOT"
 PARMSK(1) = [M:SMX1]ITMREF
 PARMSK(2) = [M:SMX1]STOFCY
 PARMSK(3) = "SMX1"
 PARMSK(4) = "0"
 PARMSK(5) = "1"
 Call S_TAB_CHAR(VALEUR,PARMSK,"STKSELLOT","STKSEL","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

$ON_SLO
Onevent CONTROL Call C_SLO(zc) From W1WT04LOM1
Onevent AFTER_CHANGE Gosub AMM_SLO From W1WT04LOM1
Return

Subprog C_SLO(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "SLO" : GZNUM = 19213 : Endif
If !mkstat
 ## Action STD
 Call C_SLO(VALEUR) From SUBSMX
 If mkstat : GERR = 1 : GZONE = "SLO" : GZNUM = 19213 : Endif
Endif
Gosub _AFF
End

$AMM_SLO
Call AM_SLO(zc)
If !mkstat & GOBJET
 zoncou = "SLO" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_SLO(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_SLO(VALEUR) From SUBSMX
If mkstat : GERR = 1 : GZONE = "SLO" : GZNUM = 19213 : Endif
Gosub _AFF
End

$ON_ECCSTAOLD
Onevent INIT_AREA Call D_ECCSTAOLD(zc) From W1WT04LOM1
Return

Subprog D_ECCSTAOLD(VALEUR)
Variable Integer VALEUR
If varinit([M]ECCSTAOLD,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_ECCVALMINOLD
Return

$ON_XREFPEROLD
Onevent BEFORE_AREA Gosub AV_XREFPEROLD From W1WT04LOM1
Return

$AV_XREFPEROLD
Chgfmt [M]XREFPEROLD(indice) With "DPZ:"+GFMDAT4
Gosub _AFF
Return

$ON_SHLUOMOLD
Onevent INIT_AREA Call D_SHLUOMOLD(zc) From W1WT04LOM1
Return

Subprog D_SHLUOMOLD(VALEUR)
Variable Integer VALEUR
If varinit([M]SHLUOMOLD,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_XSHLDATOLD
Onevent BEFORE_AREA Gosub AV_XSHLDATOLD From W1WT04LOM1
Return

$AV_XSHLDATOLD
Chgfmt [M]XSHLDATOLD(indice) With "DPZ:"+GFMDAT4
Gosub _AFF
Return

$ON_DLULTIUOMOLD
Onevent INIT_AREA Call D_DLULTIUOMOLD(zc) From W1WT04LOM1
Return

Subprog D_DLULTIUOMOLD(VALEUR)
Variable Integer VALEUR
If varinit([M]DLULTIUOMOLD,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_XDLUDATOLD
Onevent BEFORE_AREA Gosub AV_XDLUDATOLD From W1WT04LOM1
Return

$AV_XDLUDATOLD
Chgfmt [M]XDLUDATOLD(indice) With "DPZ:"+GFMDAT4
Gosub _AFF
Return

$ON_SHLLTIUOMO
Onevent INIT_AREA Call D_SHLLTIUOMO(zc) From W1WT04LOM1
Return

Subprog D_SHLLTIUOMO(VALEUR)
Variable Integer VALEUR
If varinit([M]SHLLTIUOMO,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_XNEWLTIDAT
Onevent BEFORE_AREA Gosub AV_XNEWLTIDAT From W1WT04LOM1
Return

$AV_XNEWLTIDAT
Chgfmt [M]XNEWLTIDAT(indice) With "DPZ:"+GFMDAT4
Gosub _AFF
Return

$CHG_STY
Gosub CHG_STY From W2WT04LOM1
Return

$TIT_COL
Gosub TIT_COL From W2WT04LOM1
Return


