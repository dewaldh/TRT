#<AdxTL>@(#)0.0.0.0 $Revision$
# Supervisor
# Mask management WE3ALL9 

$_AFF
If GIMPORT
 Gosub AFF From GSAISIE
Else
 If GMESSAGE <>""
  Gosub ERR From GSAISIE
 Else
  Raz GERR , GZNUM
 Endif
Endif
Return

$ON_ORDMINAMT
Onevent BEFORE_AREA Gosub AV_ORDMINAMT From W2WE3ALL9
Onevent CONTROL Call C_ORDMINAMT(zc) From W2WE3ALL9
Return

$AV_ORDMINAMT
## Action INIDEV
GDEVFMT="11.2" : GDEVFMT = GDEVFMT1(max(find(GLOCALDEV,GDEVISE(1..GNBDEV)),1))
Chgfmt [M]ORDMINAMT(indice) With "N+z3:"+GDEVFMT
Gosub _AFF
Return

Subprog C_ORDMINAMT(VALEUR)
Variable Decimal VALEUR
Gosub _AFF
End

$ON_ORDMAXAMT
Onevent BEFORE_AREA Gosub AV_ORDMAXAMT From W2WE3ALL9
Onevent CONTROL Call C_ORDMAXAMT(zc) From W2WE3ALL9
Return

$AV_ORDMAXAMT
## Action INIDEV
GDEVFMT="11.2" : GDEVFMT = GDEVFMT1(max(find(GLOCALDEV,GDEVISE(1..GNBDEV)),1))
Chgfmt [M]ORDMAXAMT(indice) With "N+z3:"+GDEVFMT
Gosub _AFF
Return

Subprog C_ORDMAXAMT(VALEUR)
Variable Decimal VALEUR
Gosub _AFF
End

$ON_ORDFREFRT
Onevent BEFORE_AREA Gosub AV_ORDFREFRT From W2WE3ALL9
Onevent CONTROL Call C_ORDFREFRT(zc) From W2WE3ALL9
Return

$AV_ORDFREFRT
## Action INIDEV
GDEVFMT="11.2" : GDEVFMT = GDEVFMT1(max(find(GLOCALDEV,GDEVISE(1..GNBDEV)),1))
Chgfmt [M]ORDFREFRT(indice) With "N+z3:"+GDEVFMT
Gosub _AFF
Return

Subprog C_ORDFREFRT(VALEUR)
Variable Decimal VALEUR
Gosub _AFF
End

$ON_TOTCOST
Onevent BEFORE_AREA Gosub AV_TOTCOST From W2WE3ALL9
Return

$AV_TOTCOST
## Action INIDEV
GDEVFMT="11.2" : GDEVFMT = GDEVFMT1(max(find(GLOCALDEV,GDEVISE(1..GNBDEV)),1))
Chgfmt [M]TOTCOST(indice) With "NPz3:"+GDEVFMT
Gosub _AFF
Return

$ON_TOTCUR
Return

$ON_NBLIG
Onevent BEFORE_INPUT Call AS_NBLIG From W2WE3ALL9
Onevent CONTROL Call C_NBLIG From W2WE3ALL9
Onevent BEFORE_LINE Call AVANT_NBLIG From W2WE3ALL9
Onevent AFTER_LINE Call APRES_NBLIG From W2WE3ALL9
Onevent BEFORE_AREA Call AV_NBLIG From W2WE3ALL9
Return

Subprog IB_NBLIG
Local Decimal BASPAG
If !GWEBSERV
 ## Action STD
 Call IB_NBLIG From SUBPOI
Endif
Gosub _AFF
End

Subprog AV_NBLIG
Local Decimal BASPAG
If adxgtb=1 & !GORITITCOL & nolign=1
 Local Char BASPAG(10)
 BASPAG = "NBLIG" : Gosub TIT_COL From W4WE3ALL9
Endif
Gosub _AFF
End

Subprog AS_NBLIG
Local Decimal BASPAG
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(8046,GBOUT2) From OBJDIV
Call TEXTE(15405,GBOUT3) From OBJDIV
Call IB_NBLIG
## Action STD
Call AS_NBLIG From SUBPOI
Onkey 130 Titled GBOUT2 Call B2_NBLIG From W2WE3ALL9
Onkey 131 Titled GBOUT3 Call B3_NBLIG From W2WE3ALL9
Gosub _AFF
End

Subprog C_NBLIG
Local Decimal BASPAG
## Action STD
Call C_NBLIG From SUBPOI
If mkstat : GERR = 1 : GZONE = "NBLIG" : GZNUM = 0 : Endif
Gosub _AFF
End

Subprog B2_NBLIG
Local Decimal BASPAG
If !GWEBSERV
 ## Action SAIPECB2
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SAIPECB2"
 PARMSK(1) = num$([M:POI1]PRONUM)
 PARMSK(2) = "POI"
 PARMSK(3) = [M:POI1]REFART
 PARMSK(4) = [M:POI1]BUY
 PARMSK(5) = "3"
 Call SAISIE_NUM(BASPAG,PARMSK,"IPPICORD2","SUBPOIA","SPEPOI") From GSAISIE
 [M:POI1]REFART = PARMSK(3)
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B3_NBLIG
Local Decimal BASPAG
If !GWEBSERV
 ## Action VISUCLCPRI
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "VISUCLCPRI"
 PARMSK(1) = "POI"
 PARMSK(2) = [M:POI1]CUR(nolign-1)
 PARMSK(3) = num$(nolign-1)
 PARMSK(4) = "2"
 Call SAISIE_NUM(BASPAG,PARMSK,"IDETPRI","TRTPRICE","XWIDETPRI") From GSAISIE
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog AVANT_NBLIG
Local Decimal BASPAG
## Action STD
Call AVANT_NBLIG From SUBPOI
If mkstat : End : Endif
Gosub _AFF
End

Subprog APRES_NBLIG
Local Decimal BASPAG
## Action DIVLINNUM
Call LINNUM("SRTLIN") From TABLEAUX
If mkstat : End : Endif
## Action STD
Call APRES_NBLIG From SUBPOI
If mkstat : End : Endif
Gosub _AFF
End

$ON_NOLIG
Onevent BEFORE_AREA Gosub AV_NOLIG From W2WE3ALL9
Return

$AV_NOLIG
zc = nolign
Gosub _AFF
Return

$ON_ITMREF
Onevent CONTROL Call C_ITMREF(zc) From W2WE3ALL9
Onevent BEFORE_INPUT Call AS_ITMREF(zc) From W2WE3ALL9
Onevent AFTER_CHANGE Gosub AMM_ITMREF From W2WE3ALL9
Return

Subprog IB_ITMREF(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action IBPRDINF
 Call IBPRDINF(VALEUR) From PRDINFLIB
Endif
If !GWEBSERV
 ## Action STD
 Call IB_ITMREF From SUBPOI
Endif
Gosub _AFF
End

Subprog AS_ITMREF(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(2061,GBOUT1) From OBJDIV
Call TEXTE(8046,GBOUT2) From OBJDIV
Call TEXTE(12837,GBOUT13) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_ITMREF(VALEUR)
## Action STD
Call AS_ITMREF(VALEUR) From SUBPOI
If mkstat=2
 [M]ITMREF(INDIC) = VALEUR
 Affzo ITMREF(INDIC) : mkstat = 2
Endif
Onkey 129 Titled GBOUT1 Call B1_ITMREF(zc) From W2WE3ALL9
Onkey 130 Titled GBOUT2 Call B2_ITMREF(zc) From W2WE3ALL9
Onkey 170 Titled GBOUT13 Call B13_ITMREF(zc) From W2WE3ALL9
Onkey   2 Titled GBOUTS Call S_ITMREF(zc) From W2WE3ALL9
Onkey 144 Titled GBOUTP Call P_ITMREF(zc) From W2WE3ALL9
Onkey 146 Titled GBOUTA Call SA_ITMREF(zc) From W2WE3ALL9
Gosub _AFF
End

Subprog C_ITMREF(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
If !GWEBSERV
 If !mkstat
  ## Action ITMCHOICE
  Local Char    PARMSK(250)(1..20) , SAVACT(20)
  SAVACT = GACTION : GACTION = "ITMCHOICE"
  Call S_TAB_CHAR(VALEUR,PARMSK,"ITMCHOICE","TRTSEL","") From GACTION
  GACTION = SAVACT
  If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
 Endif
Endif
If !mkstat
 ## Action VXADCUPC
 Call ADCCTRUPC(VALEUR) From VXADCUPC
 If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
 If !mkstat
  ## Action %CNTOBJ
  Call CONTSEL("ITM","B",VALEUR,"",mkstat) From CONTOBJ
  If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
  If !mkstat
   ## Action STD
   Call C_ITMREF(VALEUR) From SUBPOI
   If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
  Endif
 Endif
Endif
Gosub _AFF
End

$AMM_ITMREF
Call AM_ITMREF(zc)
If !mkstat & GOBJET
 zoncou = "ITMREF" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_ITMREF(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_ITMREF(VALEUR) From SUBPOI
If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
If !mkstat
 ## Action INIECCSTA
 Call INIECCSTA(VALEUR,"POI1",nolign-1) From STKECR
 If mkstat : GERR = 1 : GZONE = "ITMREF" : GZNUM = 3651 : Endif
Endif
Gosub _AFF
End

Subprog S_ITMREF(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16)
PARMSK(1) = "ITM"
PARMSK(2) = "B"
Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJ","SELOBJ","") From GACTION
Gosub _AFF
End

Subprog B1_ITMREF(VALEUR)
Variable Char    VALEUR()
Call OBJET("ITM",VALEUR,"") From GOBJET
Gosub _AFF
End

Subprog B2_ITMREF(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SAIPECB2
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SAIPECB2"
 PARMSK(1) = num$([M:POI1]PRONUM)
 PARMSK(2) = "POI"
 PARMSK(3) = VALEUR
 PARMSK(4) = [M:POI1]BUY
 PARMSK(5) = "3"
 Call SAISIE_CHAR(VALEUR,PARMSK,"IPPICORD2","SUBPOIA","SPEPOI") From GSAISIE
 VALEUR = PARMSK(3)
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B13_ITMREF(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PRDINFA
 Call PRDINF(VALEUR) From PRDINFLIB
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog SA_ITMREF(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "ITM"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_ITMREF(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("ITM",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ITMDES
Onevent BEFORE_INPUT Call AS_ITMDES(zc) From W2WE3ALL9
Onevent CONTROL Call C_ITMDES(zc) From W2WE3ALL9
Return

Subprog IB_ITMDES(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action STD
 Call IB_ITMDES From SUBPOI
Endif
Gosub _AFF
End

Subprog AS_ITMDES(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(735,GBOUT1) From OBJDIV
Call IB_ITMDES(VALEUR)
## Action PASLIN
If GMODIF<>2 mkstat=2 : Endif
If mkstat=2
 [M]ITMDES(INDIC) = VALEUR
 Affzo ITMDES(INDIC) : mkstat = 2
Endif
Onkey 129 Titled GBOUT1 Call B1_ITMDES(zc) From W2WE3ALL9
Gosub _AFF
End

Subprog C_ITMDES(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "ITMDES" : GZNUM = 282 : Endif
Gosub _AFF
End

Subprog B1_ITMDES(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action GOBJETC0A
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "GOBJETC0A"
 Local Char ACTION(20), PROGSUB(GLONADC), PROGSPE(GLONADC), PROGSPV(GLONADC)
 ACTION = "AB1_ITMDES" : PROGSUB = "SUBPOI" : PROGSPE = "SPEPOI" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 Local Char    OBJCLE(30)
 OBJCLE = [M:POI1]ITMREF(nolign-1)
 Call OBJET_CHAR(OBJCLE,"ITM","") From GOBJET
 ACTION = "BB1_ITMDES" : PROGSUB = "SUBPOI" : PROGSPE = "SPEPOI" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

$ON_ITMDES1
Onevent BEFORE_INPUT Call AS_ITMDES1(zc) From W2WE3ALL9
Onevent CONTROL Call C_ITMDES1(zc) From W2WE3ALL9
Return

Subprog IB_ITMDES1(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action STD
 Call IB_ITMDES1 From SUBPOI
Endif
Gosub _AFF
End

Subprog AS_ITMDES1(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(735,GBOUT1) From OBJDIV
Call IB_ITMDES1(VALEUR)
## Action PASLIN
If GMODIF<>2 mkstat=2 : Endif
If mkstat=2
 [M]ITMDES1(INDIC) = VALEUR
 Affzo ITMDES1(INDIC) : mkstat = 2
Endif
Onkey 129 Titled GBOUT1 Call B1_ITMDES1(zc) From W2WE3ALL9
Gosub _AFF
End

Subprog C_ITMDES1(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "ITMDES1" : GZNUM = 14914 : Endif
Gosub _AFF
End

Subprog B1_ITMDES1(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action GOBJETC0A
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "GOBJETC0A"
 Local Char ACTION(20), PROGSUB(GLONADC), PROGSPE(GLONADC), PROGSPV(GLONADC)
 ACTION = "AB1_ITMDES1" : PROGSUB = "SUBPOI" : PROGSPE = "SPEPOI" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 Local Char    OBJCLE(30)
 OBJCLE = [M:POI1]ITMREF(nolign-1)
 Call OBJET_CHAR(OBJCLE,"ITM","") From GOBJET
 ACTION = "BB1_ITMDES1" : PROGSUB = "SUBPOI" : PROGSPE = "SPEPOI" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

$ON_PRHFCY
Onevent CONTROL Call C_PRHFCY(zc) From W2WE3ALL9
Onevent BEFORE_INPUT Call AS_PRHFCY(zc) From W2WE3ALL9
Onevent AFTER_CHANGE Gosub AMM_PRHFCY From W2WE3ALL9
Return

Subprog IB_PRHFCY(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action STD
 Call IB_PRHFCY From SUBPOI
Endif
Gosub _AFF
End

Subprog AS_PRHFCY(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(12817,GBOUT3) From OBJDIV
Call TEXTE(16776,GBOUT4) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_PRHFCY(VALEUR)
## Action PASLIN
If GMODIF<>2 mkstat=2 : Endif
If mkstat=2
 [M]PRHFCY(INDIC) = VALEUR
 Affzo PRHFCY(INDIC) : mkstat = 2
Endif
If !mkstat
 ## Action STD
 Call AS_PRHFCY(VALEUR) From SUBPOI
 If mkstat=2
  [M]PRHFCY(INDIC) = VALEUR
  Affzo PRHFCY(INDIC) : mkstat = 2
 Endif
 Onkey 131 Titled GBOUT3 Call B3_PRHFCY(zc) From W2WE3ALL9
 Onkey 132 Titled GBOUT4 Call B4_PRHFCY(zc) From W2WE3ALL9
 Onkey   2 Titled GBOUTS Call S_PRHFCY(zc) From W2WE3ALL9
 Onkey 144 Titled GBOUTP Call P_PRHFCY(zc) From W2WE3ALL9
 Onkey 146 Titled GBOUTA Call SA_PRHFCY(zc) From W2WE3ALL9
Endif
Gosub _AFF
End

Subprog C_PRHFCY(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "PRHFCY" : GZNUM = 1344 : Endif
If !mkstat
 ## Action ACONTFCY
 Call CONTSITE(VALEUR) From SUBAGF
 If mkstat : GERR = 1 : GZONE = "PRHFCY" : GZNUM = 1344 : Endif
 If !mkstat
  ## Action %CNTOBJ
  Call CONTSEL("FCY","",VALEUR,"",mkstat) From CONTOBJ
  If mkstat : GERR = 1 : GZONE = "PRHFCY" : GZNUM = 1344 : Endif
  If !mkstat
   ## Action STD
   Call C_PRHFCY(VALEUR) From SUBPOI
   If mkstat : GERR = 1 : GZONE = "PRHFCY" : GZNUM = 1344 : Endif
  Endif
 Endif
Endif
Gosub _AFF
End

$AMM_PRHFCY
Call AM_PRHFCY(zc)
If !mkstat & GOBJET
 zoncou = "PRHFCY" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_PRHFCY(VALEUR)
Variable Char    VALEUR()
## Action TRTPRHFCY
Local Char    PARMSK(250)(1..20) , SAVACT(20)
SAVACT = GACTION : GACTION = "TRTPRHFCY"
PARMSK(1) = [M:POI1]ITMREF(nolign-1)
Call TRAITE_CHAR(VALEUR,PARMSK,"","TRTACHCTL1","",1,"XYTRTACHCTL1") From GTRAITE
GACTION = SAVACT
If mkstat : GERR = 1 : GZONE = "PRHFCY" : GZNUM = 1344 : Endif
If !mkstat
 ## Action GOBJETC0A
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "GOBJETC0A"
 Local Char ACTION(20), PROGSUB(GLONADC), PROGSPE(GLONADC), PROGSPV(GLONADC)
 ACTION = "AAM_PRHFCY" : PROGSUB = "SUBPOI" : PROGSPE = "SPEPOI" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 Local Char    OBJCLE(30)
 OBJCLE = VALEUR
 Call OBJET_CHAR(OBJCLE,WOBJET,[M:POI1]ITMREF(nolign-1)) From GOBJET
 ACTION = "BAM_PRHFCY" : PROGSUB = "SUBPOI" : PROGSPE = "SPEPOI" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 GACTION = SAVACT
 If mkstat : GERR = 1 : GZONE = "PRHFCY" : GZNUM = 1344 : Endif
 If !mkstat
  ## Action STD
  Call AM_PRHFCY(VALEUR) From SUBPOI
  If mkstat : GERR = 1 : GZONE = "PRHFCY" : GZNUM = 1344 : Endif
 Endif
Endif
Gosub _AFF
End

Subprog S_PRHFCY(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELPRHFCY
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELPRHFCY"
 PARMSK(1) = num$([M:POI1]STOMGTCOD(nolign-1))
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPRHFCY","TRTACHSEL1","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B3_PRHFCY(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action CONSSFC
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "CONSSFC"
 Local Char ACTION(20), PROGSUB(GLONADC), PROGSPE(GLONADC), PROGSPV(GLONADC)
 ACTION = "AB3_PRHFCY" : PROGSUB = "SUBPOI" : PROGSPE = "SPEPOI" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 PARMSK(1) = "0"
 PARMSK(2) = VALEUR
 PARMSK(3) = [M:POI1]ITMREF(nolign-1)
 PARMSK(4) = ""
 Call CONSULT_CHAR(VALEUR,"SFC",PARMSK) From GCONSULT
 ACTION = "BB3_PRHFCY" : PROGSUB = "SUBPOI" : PROGSPE = "SPEPOI" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B4_PRHFCY(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELITMFCY
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELITMFCY"
 PARMSK(1) = "ITMREF=[M:POI1]ITMREF(nolign-1)"
 PARMSK(2) = ""
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELITMFCY","TRTACHSEL1","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog SA_PRHFCY(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "FCY"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_PRHFCY(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("FCY",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_FCYADD
Onevent BEFORE_INPUT Call AS_FCYADD(zc) From W2WE3ALL9
Onevent CONTROL Call C_FCYADD(zc) From W2WE3ALL9
Onevent AFTER_CHANGE Gosub AMM_FCYADD From W2WE3ALL9
Return

Subprog IB_FCYADD(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action STD
 Call IB_FCYADD From SUBPOI
Endif
Gosub _AFF
End

Subprog AS_FCYADD(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(15597,GBOUTS) From OBJDIV
Call IB_FCYADD(VALEUR)
## Action PASLIN
If GMODIF<>2 mkstat=2 : Endif
If mkstat=2
 [M]FCYADD(INDIC) = VALEUR
 Affzo FCYADD(INDIC) : mkstat = 2
Endif
If !mkstat
 ## Action STD
 Call AS_FCYADD(VALEUR) From SUBPOI
 If mkstat=2
  [M]FCYADD(INDIC) = VALEUR
  Affzo FCYADD(INDIC) : mkstat = 2
 Endif
 Onkey   2 Titled GBOUTS Call S_FCYADD(zc) From W2WE3ALL9
Endif
Gosub _AFF
End

Subprog C_FCYADD(VALEUR)
Variable Char    VALEUR()
## Action STD
Call C_FCYADD(VALEUR) From SUBPOI
If mkstat : GERR = 1 : GZONE = "FCYADD" : GZNUM = 1499 : Endif
Gosub _AFF
End

$AMM_FCYADD
Call AM_FCYADD(zc)
If !mkstat & GOBJET
 zoncou = "FCYADD" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_FCYADD(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_FCYADD(VALEUR) From SUBPOI
If mkstat : GERR = 1 : GZONE = "FCYADD" : GZNUM = 1499 : Endif
Gosub _AFF
End

Subprog S_FCYADD(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SAISELADR
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SAISELADR"
 PARMSK(1) = "3"
 PARMSK(2) = [M:POI1]PRHFCY(nolign-1)
 PARMSK(3) = [F:FCY]FCYNAM
 PARMSK(4) = GBIDC3
 Call SAISIE_CHAR(VALEUR,PARMSK,"IBPAW","TRTX3","XWIBPAW") From GSAISIE
 GACTION = SAVACT
Endif
Gosub _AFF
End

$ON_USEPLC
Onevent BEFORE_INPUT Call AS_USEPLC(zc) From W2WE3ALL9
Return

Subprog AS_USEPLC(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
## Action PASLIN
If GMODIF<>2 mkstat=2 : Endif
If mkstat=2
 [M]USEPLC(INDIC) = VALEUR
 Affzo USEPLC(INDIC) : mkstat = 2
Endif
Gosub _AFF
End

$ON_UOM
Onevent BEFORE_INPUT Call AS_UOM(zc) From W2WE3ALL9
Onevent CONTROL Call C_UOM(zc) From W2WE3ALL9
Onevent AFTER_CHANGE Gosub AMM_UOM From W2WE3ALL9
Return

Subprog AS_UOM(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
## Action PASLIN
If GMODIF<>2 mkstat=2 : Endif
If mkstat=2
 [M]UOM(INDIC) = VALEUR
 Affzo UOM(INDIC) : mkstat = 2
Endif
Onkey   2 Titled GBOUTS Call S_UOM(zc) From W2WE3ALL9
Onkey 144 Titled GBOUTP Call P_UOM(zc) From W2WE3ALL9
Onkey 146 Titled GBOUTA Call SA_UOM(zc) From W2WE3ALL9
Gosub _AFF
End

Subprog C_UOM(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "UOM" : GZNUM = 2192 : Endif
If !mkstat
 ## Action %CNTOBJ
 Call CONTSEL("TUN","",VALEUR,"",mkstat) From CONTOBJ
 If mkstat : GERR = 1 : GZONE = "UOM" : GZNUM = 2192 : Endif
 If !mkstat
  ## Action PCOUOM
  Call PCOUOM(VALEUR,[M:POI1]BPSNUM(nolign-1),[M:POI1]ITMREF(nolign-1),3,5) From TRTACHCTL1
  If mkstat : GERR = 1 : GZONE = "UOM" : GZNUM = 2192 : Endif
  If !mkstat
   ## Action STD
   Call C_UOM(VALEUR) From SUBPOI
   If mkstat : GERR = 1 : GZONE = "UOM" : GZNUM = 2192 : Endif
  Endif
 Endif
Endif
Gosub _AFF
End

$AMM_UOM
Call AM_UOM(zc)
If !mkstat & GOBJET
 zoncou = "UOM" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_UOM(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_UOM(VALEUR) From SUBPOI
If mkstat : GERR = 1 : GZONE = "UOM" : GZNUM = 2192 : Endif
Gosub _AFF
End

Subprog S_UOM(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELPUOM
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELPUOM"
 PARMSK(1) = [M:POI1]BPSNUM(nolign-1)
 PARMSK(2) = [M:POI1]ITMREF(nolign-1)
 PARMSK(3) = "3"
 PARMSK(4) = "5"
 Call S_LIS_CHAR(VALEUR,PARMSK,"SELPUOM","TRTACHSEL1","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog SA_UOM(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "TUN"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_UOM(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("TUN",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_UOMFLG
Onevent INIT_AREA Call D_UOMFLG(zc) From W2WE3ALL9
Return

Subprog D_UOMFLG(VALEUR)
Variable Integer VALEUR
If varinit([M]UOMFLG,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_QTYUOM
Onevent BEFORE_AREA Gosub AV_QTYUOM From W2WE3ALL9
Onevent BEFORE_INPUT Call AS_QTYUOM(zc) From W2WE3ALL9
Onevent CONTROL Call C_QTYUOM(zc) From W2WE3ALL9
Onevent AFTER_CHANGE Gosub AMM_QTYUOM From W2WE3ALL9
Return

Subprog IB_QTYUOM(VALEUR)
Variable Decimal VALEUR
If !GWEBSERV
 ## Action STD
 Call IB_QTYUOM From SUBPOI
Endif
Gosub _AFF
End

$AV_QTYUOM
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M:POI1]UOM(nolign-1),GUNITE(1..GNBUNT)),1))
Endif
Chgfmt [M]QTYUOM(indice) With "N+z:"+GUNTFMT
Gosub _AFF
Return

Subprog AS_QTYUOM(VALEUR)
Variable Decimal VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(12817,GBOUT3) From OBJDIV
Call TEXTE(53893,GBOUT6) From OBJDIV
Call IB_QTYUOM(VALEUR)
## Action PASLIN
If GMODIF<>2 mkstat=2 : Endif
If mkstat=2
 [M]QTYUOM(INDIC) = VALEUR
 Affzo QTYUOM(INDIC) : mkstat = 2
Endif
Onkey 131 Titled GBOUT3 Call B3_QTYUOM(zc) From W2WE3ALL9
Onkey 134 Titled GBOUT6 Call B6_QTYUOM(zc) From W2WE3ALL9
Gosub _AFF
End

Subprog C_QTYUOM(VALEUR)
Variable Decimal VALEUR
## Action %OBLIG
If VALEUR=0
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "QTYUOM" : GZNUM = 4620 : Endif
If !mkstat
 ## Action STD
 Call C_QTYUOM(VALEUR) From SUBPOI
 If mkstat : GERR = 1 : GZONE = "QTYUOM" : GZNUM = 4620 : Endif
Endif
Gosub _AFF
End

$AMM_QTYUOM
Call AM_QTYUOM(zc)
If !mkstat & GOBJET
 zoncou = "QTYUOM" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_QTYUOM(VALEUR)
Variable Decimal VALEUR
## Action STD
Call AM_QTYUOM(VALEUR) From SUBPOI
If mkstat : GERR = 1 : GZONE = "QTYUOM" : GZNUM = 4620 : Endif
Gosub _AFF
End

Subprog B3_QTYUOM(VALEUR)
Variable Decimal VALEUR
If !GWEBSERV
 ## Action CONSSFC
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "CONSSFC"
 Local Char ACTION(20), PROGSUB(GLONADC), PROGSPE(GLONADC), PROGSPV(GLONADC)
 ACTION = "AB3_QTYUOM" : PROGSUB = "SUBPOI" : PROGSPE = "SPEPOI" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 PARMSK(1) = "0"
 PARMSK(2) = [M:POI1]PRHFCY(nolign-1)
 PARMSK(3) = [M:POI1]ITMREF(nolign-1)
 PARMSK(4) = ""
 Call CONSULT_NUM(VALEUR,"SFC",PARMSK) From GCONSULT
 ACTION = "BB3_QTYUOM" : PROGSUB = "SUBPOI" : PROGSPE = "SPEPOI" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B6_QTYUOM(VALEUR)
Variable Decimal VALEUR
If !GWEBSERV
 ## Action ITMHIS
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "ITMHIS"
 PARMSK(1) = [M:POI1]ITMREF(nolign-1)
 PARMSK(2) = [M:POI1]PRHFCY(nolign-1)
 Call TRAITE_NUM(VALEUR,PARMSK,"ITMHIS","TRTITH","",1,"SPEITH") From GTRAITE
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

$ON_UOMPUUCOE
Onevent BEFORE_INPUT Call AS_UOMPUUCOE(zc) From W2WE3ALL9
Onevent AFTER_CHANGE Gosub AMM_UOMPUUCOE From W2WE3ALL9
Return

Subprog AS_UOMPUUCOE(VALEUR)
Variable Decimal VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
## Action STD
Call AS_UOMPUUCOE(VALEUR) From SUBPOI
If mkstat=2
 [M]UOMPUUCOE(INDIC) = VALEUR
 Affzo UOMPUUCOE(INDIC) : mkstat = 2
Endif
If !mkstat
 ## Action PASLIN
 If GMODIF<>2 mkstat=2 : Endif
 If mkstat=2
  [M]UOMPUUCOE(INDIC) = VALEUR
  Affzo UOMPUUCOE(INDIC) : mkstat = 2
 Endif
Endif
Gosub _AFF
End

$AMM_UOMPUUCOE
Call AM_UOMPUUCOE(zc)
If !mkstat & GOBJET
 zoncou = "UOMPUUCOE" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_UOMPUUCOE(VALEUR)
Variable Decimal VALEUR
## Action STD
Call AM_UOMPUUCOE(VALEUR) From SUBPOI
If mkstat : GERR = 1 : GZONE = "UOMPUUCOE" : GZNUM = 3377 : Endif
Gosub _AFF
End

$ON_PUU
Return

$ON_QTYPUU
Onevent BEFORE_AREA Gosub AV_QTYPUU From W2WE3ALL9
Return

$AV_QTYPUU
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M:POI1]PUU(nolign-1),GUNITE(1..GNBUNT)),1))
Endif
Gosub _AFF
Return

$ON_STU
Return

$ON_QTYSTU
Onevent BEFORE_AREA Gosub AV_QTYSTU From W2WE3ALL9
Onevent BEFORE_INPUT Call AS_QTYSTU(zc) From W2WE3ALL9
Onevent AFTER_CHANGE Gosub AMM_QTYSTU From W2WE3ALL9
Onevent CONTROL Call C_QTYSTU(zc) From W2WE3ALL9
Return

$AV_QTYSTU
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M:POI1]STU(nolign-1),GUNITE(1..GNBUNT)),1))
Endif
Chgfmt [M]QTYSTU(indice) With "N+z:"+GUNTFMT
Gosub _AFF
Return

Subprog AS_QTYSTU(VALEUR)
Variable Decimal VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
## Action STD
Call AS_QTYSTU(VALEUR) From SUBPOI
If mkstat=2
 [M]QTYSTU(INDIC) = VALEUR
 Affzo QTYSTU(INDIC) : mkstat = 2
Endif
If !mkstat
 ## Action PASLIN
 If GMODIF<>2 mkstat=2 : Endif
 If mkstat=2
  [M]QTYSTU(INDIC) = VALEUR
  Affzo QTYSTU(INDIC) : mkstat = 2
 Endif
Endif
Gosub _AFF
End

Subprog C_QTYSTU(VALEUR)
Variable Decimal VALEUR
## Action %OBLIG
If VALEUR=0
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "QTYSTU" : GZNUM = 2602 : Endif
Gosub _AFF
End

$AMM_QTYSTU
Call AM_QTYSTU(zc)
If !mkstat & GOBJET
 zoncou = "QTYSTU" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_QTYSTU(VALEUR)
Variable Decimal VALEUR
## Action STD
Call AM_QTYSTU(VALEUR) From SUBPOI
If mkstat : GERR = 1 : GZONE = "QTYSTU" : GZNUM = 2602 : Endif
Gosub _AFF
End

$ON_ITMWEI
Onevent BEFORE_AREA Gosub AV_ITMWEI From W2WE3ALL9
Return

$AV_ITMWEI
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]LINWEU(nolign-1),GUNITE(1..GNBUNT)),1))
Endif
Gosub _AFF
Return

$ON_LINWEI
Onevent BEFORE_AREA Gosub AV_LINWEI From W2WE3ALL9
Return

$AV_LINWEI
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]LINWEU(nolign-1),GUNITE(1..GNBUNT)),1))
Endif
Chgfmt [M]LINWEI(indice) With "NPz:"+GUNTFMT
Gosub _AFF
Return

$ON_LINTCTRWEI
Onevent BEFORE_AREA Gosub AV_LINTCTRWEI From W2WE3ALL9
Return

$AV_LINTCTRWEI
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]TCTRWEU,GUNITE(1..GNBUNT)),1))
Endif
Gosub _AFF
Return

$ON_LINWEU
Return

$ON_ITMVOL
Onevent BEFORE_AREA Gosub AV_ITMVOL From W2WE3ALL9
Return

$AV_ITMVOL
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]LINVOU(nolign-1),GUNITE(1..GNBUNT)),1))
Endif
Gosub _AFF
Return

$ON_LINVOL
Onevent BEFORE_AREA Gosub AV_LINVOL From W2WE3ALL9
Return

$AV_LINVOL
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]LINVOU(nolign-1),GUNITE(1..GNBUNT)),1))
Endif
Chgfmt [M]LINVOL(indice) With "NPz:"+GUNTFMT
Gosub _AFF
Return

$ON_LINTCTRVOL
Onevent BEFORE_AREA Gosub AV_LINTCTRVOL From W2WE3ALL9
Return

$AV_LINTCTRVOL
If !GWEBSERV
 ## Action FMTQTY
 GUNTFMT="15F" : GUNTFMT = GUNTFMT1(max(find([M]TCTRVOU,GUNITE(1..GNBUNT)),1))
Endif
Gosub _AFF
Return

$ON_LINVOU
Return

$ON_UPDPSDFLG
Onevent INIT_AREA Call D_UPDPSDFLG(zc) From W2WE3ALL9
Return

Subprog D_UPDPSDFLG(VALEUR)
Variable Integer VALEUR
If varinit([M]UPDPSDFLG,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_PJT
Onevent BEFORE_INPUT Call AS_PJT(zc) From W2WE3ALL9
Onevent CONTROL Call C_PJT(zc) From W2WE3ALL9
Onevent AFTER_CHANGE Gosub AMM_PJT From W2WE3ALL9
Return

Subprog IB_PJT(VALEUR)
Variable Char    VALEUR()
## Action PJTINIBUT
Call PJT_INIT_BUTTON(VALEUR,"POI1","PJT",nolign-1,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
&,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:POI1]POHFCY,""
&,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)) From TRTPJT
Gosub _AFF
End

Subprog AS_PJT(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(43841,GBOUT1) From OBJDIV
Call TEXTE(14667,GBOUT2) From OBJDIV
Call TEXTE(54273,GBOUT3) From OBJDIV
Call TEXTE(43844,GBOUT4) From OBJDIV
Call TEXTE(43868,GBOUT15) From OBJDIV
Call TEXTE(17676,GBOUT16) From OBJDIV
Call TEXTE(54274,GBOUT17) From OBJDIV
Call TEXTE(54275,GBOUT18) From OBJDIV
Call TEXTE(11781,GBOUT19) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_PJT(VALEUR)
## Action PJTBEFZON
Call PJT_BEFORE_ZONE(VALEUR,"POI1","PJT",nolign-1,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
&,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:POI1]POHFCY,""
&,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)) From TRTPJT
If mkstat=2
 [M]PJT(INDIC) = VALEUR
 Affzo PJT(INDIC) : mkstat = 2
Endif
If !mkstat
 ## Action PASLIN
 If GMODIF<>2 mkstat=2 : Endif
 If mkstat=2
  [M]PJT(INDIC) = VALEUR
  Affzo PJT(INDIC) : mkstat = 2
 Endif
 Onkey 129 Titled GBOUT1 Call B1_PJT(zc) From W2WE3ALL9
 Onkey 130 Titled GBOUT2 Call B2_PJT(zc) From W2WE3ALL9
 Onkey 131 Titled GBOUT3 Call B3_PJT(zc) From W2WE3ALL9
 Onkey 132 Titled GBOUT4 Call B4_PJT(zc) From W2WE3ALL9
 Onkey 172 Titled GBOUT15 Call B15_PJT(zc) From W2WE3ALL9
 Onkey 173 Titled GBOUT16 Call B16_PJT(zc) From W2WE3ALL9
 Onkey 174 Titled GBOUT17 Call B17_PJT(zc) From W2WE3ALL9
 Onkey 175 Titled GBOUT18 Call B18_PJT(zc) From W2WE3ALL9
 Onkey 176 Titled GBOUT19 Call B19_PJT(zc) From W2WE3ALL9
 Onkey   2 Titled GBOUTS Call S_PJT(zc) From W2WE3ALL9
 Onkey 144 Titled GBOUTP Call P_PJT(zc) From W2WE3ALL9
 Onkey 146 Titled GBOUTA Call SA_PJT(zc) From W2WE3ALL9
Endif
Gosub _AFF
End

Subprog C_PJT(VALEUR)
Variable Char    VALEUR()
## Action PJTCTL
Call PJT_CONTROL(VALEUR,"POI1","PJT",nolign-1,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
&,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:POI1]POHFCY,""
&,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)) From TRTPJT
If mkstat : GERR = 1 : GZONE = "PJT" : GZNUM = 1886 : Endif
If !mkstat
 ## Action CONTOBJN
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "CONTOBJN"
 Call S_AFF_CHAR(VALEUR,PARMSK,"CONTOBJN","CONTOBJ","") From GACTION
 GACTION = SAVACT
 If mkstat : GERR = 1 : GZONE = "PJT" : GZNUM = 1886 : Endif
Endif
Gosub _AFF
End

$AMM_PJT
Call AM_PJT(zc)
If !mkstat & GOBJET
 zoncou = "PJT" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_PJT(VALEUR)
Variable Char    VALEUR()
## Action PJTAFTMOD
Call PJT_AFTER_MODIFY(VALEUR,"POI1","PJT",nolign-1,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
&,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:POI1]POHFCY,""
&,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)) From TRTPJT
If mkstat : GERR = 1 : GZONE = "PJT" : GZNUM = 1886 : Endif
If !mkstat
 ## Action STD
 Call AM_PJT(VALEUR) From SUBPOI
 If mkstat : GERR = 1 : GZONE = "PJT" : GZNUM = 1886 : Endif
Endif
Gosub _AFF
End

Subprog S_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBUT
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBUT"
 PARMSK(1) = "POI1"
 PARMSK(2) = "PJT"
 PARMSK(3) = num$(nolign-1)
 PARMSK(4) = "6"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:POI1]POHFCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJT","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B1_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTBU1CRM
 Call PJT_BUT1_CRM(VALEUR,"POI1","PJT",nolign-1,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
& ,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:POI1]POHFCY,""
& ,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)) From TRTPJT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B2_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTBU2PRP
 Call PJT_BUT2_PRP(VALEUR,"POI1","PJT",nolign-1,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
& ,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:POI1]POHFCY,""
& ,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)) From TRTPJT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B3_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTBU3BUD
 Call PJT_BUT3_PRPBUD(VALEUR,"POI1","PJT",nolign-1,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
& ,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:POI1]POHFCY,""
& ,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)) From TRTPJT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B4_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTBU4TAC
 Call PJT_BUT4_PRPTAC(VALEUR,"POI1","PJT",nolign-1,6,[V]CST_AYES,[V]CST_AYES,[V]CST_AYES
& ,[V]CST_ANO,[V]CST_AYES,[V]CST_AYES,[V]CST_ANO,[V]CST_ANO,[V]CST_ANO,[M:POI1]POHFCY,""
& ,"","","",func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)) From TRTPJT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B15_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBCRM
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBCRM"
 PARMSK(1) = "POI1"
 PARMSK(2) = "PJT"
 PARMSK(3) = num$(nolign-1)
 PARMSK(4) = "6"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:POI1]POHFCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTCRM","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B16_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBPRP
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBPRP"
 PARMSK(1) = "POI1"
 PARMSK(2) = "PJT"
 PARMSK(3) = num$(nolign-1)
 PARMSK(4) = "6"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:POI1]POHFCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTPRP","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B17_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBBUD
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBBUD"
 PARMSK(1) = "POI1"
 PARMSK(2) = "PJT"
 PARMSK(3) = num$(nolign-1)
 PARMSK(4) = "6"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:POI1]POHFCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTBUD","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B18_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBTAC
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBTAC"
 PARMSK(1) = "POI1"
 PARMSK(2) = "PJT"
 PARMSK(3) = num$(nolign-1)
 PARMSK(4) = "6"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:POI1]POHFCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTTAC","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B19_PJT(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action PJTSELBBPR
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "PJTSELBBPR"
 PARMSK(1) = "POI1"
 PARMSK(2) = "PJT"
 PARMSK(3) = num$(nolign-1)
 PARMSK(4) = "6"
 PARMSK(5) = num$([V]CST_AYES)
 PARMSK(6) = num$([V]CST_AYES)
 PARMSK(7) = num$([V]CST_AYES)
 PARMSK(8) = num$([V]CST_ANO)
 PARMSK(9) = num$([V]CST_AYES)
 PARMSK(10) = num$([V]CST_AYES)
 PARMSK(11) = num$([V]CST_ANO)
 PARMSK(12) = num$([V]CST_ANO)
 PARMSK(13) = num$([V]CST_ANO)
 PARMSK(14) = [M:POI1]POHFCY
 PARMSK(15) = ""
 PARMSK(16) = ""
 PARMSK(17) = ""
 PARMSK(18) = ""
 PARMSK(19) = func TRTPJT.GET_CPY_FROM_FCY([M:POI1]POHFCY)
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELPJTBPR","TRTPJT","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog SA_PJT(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "PIM"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_PJT(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("PIM",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_BPSNUM
Onevent CONTROL Call C_BPSNUM(zc) From W2WE3ALL9
Onevent BEFORE_INPUT Call AS_BPSNUM(zc) From W2WE3ALL9
Onevent AFTER_AREA Call AP_BPSNUM(zc) From W2WE3ALL9
Onevent AFTER_CHANGE Gosub AMM_BPSNUM From W2WE3ALL9
Return

Subprog IB_BPSNUM(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action STD
 Call IB_BPSNUM From SUBPOI
Endif
Gosub _AFF
End

Subprog AS_BPSNUM(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(454,GBOUT1) From OBJDIV
Call TEXTE(16086,GBOUT2) From OBJDIV
Call TEXTE(1515,GBOUT3) From OBJDIV
Call TEXTE(16098,GBOUT4) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
Call IB_BPSNUM(VALEUR)
## Action PASLIN
If GMODIF<>2 mkstat=2 : Endif
If mkstat=2
 [M]BPSNUM(INDIC) = VALEUR
 Affzo BPSNUM(INDIC) : mkstat = 2
Endif
Onkey 129 Titled GBOUT1 Call B1_BPSNUM(zc) From W2WE3ALL9
Onkey 130 Titled GBOUT2 Call B2_BPSNUM(zc) From W2WE3ALL9
Onkey 131 Titled GBOUT3 Call B3_BPSNUM(zc) From W2WE3ALL9
Onkey 132 Titled GBOUT4 Call B4_BPSNUM(zc) From W2WE3ALL9
Onkey   2 Titled GBOUTS Call S_BPSNUM(zc) From W2WE3ALL9
Onkey 144 Titled GBOUTP Call P_BPSNUM(zc) From W2WE3ALL9
Onkey 146 Titled GBOUTA Call SA_BPSNUM(zc) From W2WE3ALL9
Gosub _AFF
End

Subprog C_BPSNUM(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
If !GWEBSERV
 If !mkstat
  ## Action BPSCHOICE
  Local Char    PARMSK(250)(1..20) , SAVACT(20)
  SAVACT = GACTION : GACTION = "BPSCHOICE"
  Call S_TAB_CHAR(VALEUR,PARMSK,"BPSCHOICE","TRTSEL","") From GACTION
  GACTION = SAVACT
  If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
 Endif
Endif
If !mkstat
 ## Action %CNTOBJ
 Call CONTSEL("BPS","AB",VALEUR,"",mkstat) From CONTOBJ
 If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
 If !mkstat
  ## Action CTLBPRCPY
  Call CTLBPRCPY(VALEUR,[M:POI1]POHFCY) From CONTX3
  If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
  If !mkstat
   ## Action STD
   Call C_BPSNUM(VALEUR) From SUBPOI
   If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
  Endif
 Endif
Endif
Gosub _AFF
End

Subprog AP_BPSNUM(VALEUR)
Variable Char    VALEUR()
## Action STKINIECC
Call STKINIECC([M:POI1]ITMREF(nolign-1),"","POI1",1,2,nolign-1,2,func TRTX3FNC.VALFLD_C("[M]ECCVALMAJ(nolign-1)")
&,"ECCVALMAJ","ECCVALMIN","","",1,VALEUR) From STKACT
If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
Gosub _AFF
End

$AMM_BPSNUM
Call AM_BPSNUM(zc)
If !mkstat & GOBJET
 zoncou = "BPSNUM" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_BPSNUM(VALEUR)
Variable Char    VALEUR()
## Action PAMBPSNUM
Call AM_BPSNUM(VALEUR) From TRTACHCTL1
If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
If !mkstat
 ## Action STD
 Call AM_BPSNUM(VALEUR) From SUBPOI
 If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
 If !mkstat
  ## Action SELPUOMPOI
  Local Char    PARMSK(250)(1..20) , SAVACT(20)
  SAVACT = GACTION : GACTION = "SELPUOMPOI"
  PARMSK(1) = [M:POI1]ITMREF(nolign-1)
  PARMSK(2) = "3"
  PARMSK(3) = "4"
  PARMSK(4) = [M:POI1]UOM(nolign-1)
  Call S_LIS_CHAR(VALEUR,PARMSK,"SELPUOMPOI","TRTACHSEL1","") From GACTION
  GACTION = SAVACT
  If mkstat : GERR = 1 : GZONE = "BPSNUM" : GZNUM = 3680 : Endif
 Endif
Endif
Gosub _AFF
End

Subprog S_BPSNUM(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16)
PARMSK(1) = "BPS"
PARMSK(2) = "AB"
Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJ","SELOBJ","") From GACTION
Gosub _AFF
End

Subprog B1_BPSNUM(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELBPSITM1
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELBPSITM1"
 PARMSK(1) = [M:POI1]ITMREF(nolign-1)
 PARMSK(2) = "DOUFLG<3"
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELBPSITM1","TRTACHSEL1","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B2_BPSNUM(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELBPSITM2
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELBPSITM2"
 PARMSK(1) = [M:POI1]ITMREF(nolign-1)
 PARMSK(2) = "CTMBPSFLG=2 & DOUFLG<3"
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELBPSITM2","TRTACHSEL1","") From GACTION
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B3_BPSNUM(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action GOBJET1
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "GOBJET1"
 Call OBJET_CHAR(VALEUR,"BPS","AB") From GOBJET
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B4_BPSNUM(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action VISUPLP2
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "VISUPLP2"
 PARMSK(1) = VALEUR
 PARMSK(2) = [M:POI1]ITMREF(nolign-1)
 Call SAISIE_CHAR(VALEUR,PARMSK,"IPLP2","TRTACHFEN1","XWIPLP2") From GSAISIE
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog SA_BPSNUM(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "BPS"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_BPSNUM(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("BPS",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_ECCVALMAJ
Onevent CONTROL Call C_ECCVALMAJ(zc) From W2WE3ALL9
Onevent AFTER_CHANGE Gosub AMM_ECCVALMAJ From W2WE3ALL9
Onevent BEFORE_INPUT Call AS_ECCVALMAJ(zc) From W2WE3ALL9
Return

Subprog AS_ECCVALMAJ(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(20365,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Onkey 129 Titled GBOUT1 Call B1_ECCVALMAJ(zc) From W2WE3ALL9
Onkey   2 Titled GBOUTS Call S_ECCVALMAJ(zc) From W2WE3ALL9
Gosub _AFF
End

Subprog C_ECCVALMAJ(VALEUR)
Variable Char    VALEUR()
## Action STKCTRECC
Call STKCTRECC([M:POI1]ITMREF(nolign-1),VALEUR,"","",3) From STKACT
If mkstat : GERR = 1 : GZONE = "ECCVALMAJ" : GZNUM = 44205 : Endif
Gosub _AFF
End

$AMM_ECCVALMAJ
Call AM_ECCVALMAJ(zc)
If !mkstat & GOBJET
 zoncou = "ECCVALMAJ" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_ECCVALMAJ(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_ECCVALMAJ(VALEUR) From SUBPOI
If mkstat : GERR = 1 : GZONE = "ECCVALMAJ" : GZNUM = 44205 : Endif
Gosub _AFF
End

Subprog S_ECCVALMAJ(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action STKSELMAJ
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "STKSELMAJ"
 PARMSK(1) = [M:POI1]ITMREF(nolign-1)
 PARMSK(2) = ""
 PARMSK(3) = "POI1"
 PARMSK(4) = num$(nolign-1)
 Call S_TAB_CHAR(VALEUR,PARMSK,"STKSELMAJ","STKSEL","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B1_ECCVALMAJ(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action GOBJETC0B
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "GOBJETC0B"
 Local Char ACTION(20), PROGSUB(GLONADC), PROGSPE(GLONADC), PROGSPV(GLONADC)
 ACTION = "AB1_ECCVALMAJ" : PROGSUB = "SUBPOI" : PROGSPE = "SPEPOI" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 Local Char    OBJCLE(30)
 OBJCLE = [M:POI1]ITMREF(nolign-1)
 Call OBJET_CHAR(OBJCLE,"ECS",[M:POI1]ECCVALMAJ(nolign-1)) From GOBJET
 ACTION = "BB1_ECCVALMAJ" : PROGSUB = "SUBPOI" : PROGSPE = "SPEPOI" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

$ON_ECCVALMIN
Onevent BEFORE_INPUT Call AS_ECCVALMIN(zc) From W2WE3ALL9
Onevent CONTROL Call C_ECCVALMIN(zc) From W2WE3ALL9
Return

Subprog AS_ECCVALMIN(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(44284,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
If !GWEBSERV
 ## Action STKASMIN
 Call STKASMIN([M:POI1]ECCVALMAJ(nolign-1)) From STKACT
 If mkstat=2
  [M]ECCVALMIN(INDIC) = VALEUR
  Affzo ECCVALMIN(INDIC) : mkstat = 2
 Endif
Endif
Onkey 129 Titled GBOUT1 Call B1_ECCVALMIN(zc) From W2WE3ALL9
Onkey   2 Titled GBOUTS Call S_ECCVALMIN(zc) From W2WE3ALL9
Gosub _AFF
End

Subprog C_ECCVALMIN(VALEUR)
Variable Char    VALEUR()
## Action STKCTRECC
Call STKCTRECC([M:POI1]ITMREF(nolign-1),[M:POI1]ECCVALMAJ(nolign-1),VALEUR,"",4) From STKACT
If mkstat : GERR = 1 : GZONE = "ECCVALMIN" : GZNUM = 44207 : Endif
Gosub _AFF
End

Subprog S_ECCVALMIN(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action STKSELMIN
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "STKSELMIN"
 PARMSK(1) = [M:POI1]ITMREF(nolign-1)
 PARMSK(2) = [M:POI1]ECCVALMAJ(nolign-1)
 PARMSK(3) = "POI1"
 PARMSK(4) = num$(nolign-1)
 PARMSK(5) = "4"
 Call S_TAB_CHAR(VALEUR,PARMSK,"STKSELMIN","STKSEL","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B1_ECCVALMIN(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action ECCVAL
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "ECCVAL"
 PARMSK(1) = [M:POI1]ITMREF(nolign-1)
 PARMSK(2) = "4"
 PARMSK(3) = [M:POI1]ECCVALMAJ(nolign-1)
 Call SAISIE_CHAR(VALEUR,PARMSK,"FECCVAL","ECCVAL","SPEECCVAL") From GSAISIE
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

$ON_LINSTOFCY
Onevent CONTROL Call C_LINSTOFCY(zc) From W2WE3ALL9
Onevent BEFORE_INPUT Call AS_LINSTOFCY(zc) From W2WE3ALL9
Onevent AFTER_CHANGE Gosub AMM_LINSTOFCY From W2WE3ALL9
Return

Subprog AS_LINSTOFCY(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(1427,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
## Action PASLIN
If GMODIF<>2 mkstat=2 : Endif
If mkstat=2
 [M]LINSTOFCY(INDIC) = VALEUR
 Affzo LINSTOFCY(INDIC) : mkstat = 2
Endif
If !mkstat
 ## Action STD
 Call AS_LINSTOFCY(VALEUR) From SUBPOI
 If mkstat=2
  [M]LINSTOFCY(INDIC) = VALEUR
  Affzo LINSTOFCY(INDIC) : mkstat = 2
 Endif
 Onkey 129 Titled GBOUT1 Call B1_LINSTOFCY(zc) From W2WE3ALL9
 Onkey   2 Titled GBOUTS Call S_LINSTOFCY(zc) From W2WE3ALL9
 Onkey 144 Titled GBOUTP Call P_LINSTOFCY(zc) From W2WE3ALL9
 Onkey 146 Titled GBOUTA Call SA_LINSTOFCY(zc) From W2WE3ALL9
Endif
Gosub _AFF
End

Subprog C_LINSTOFCY(VALEUR)
Variable Char    VALEUR()
## Action ACONTFCY
Call CONTSITE(VALEUR) From SUBAGF
If mkstat : GERR = 1 : GZONE = "LINSTOFCY" : GZNUM = 8560 : Endif
If !mkstat
 ## Action %CNTOBJ
 Call CONTSEL("FCY","!D",VALEUR,"",mkstat) From CONTOBJ
 If mkstat : GERR = 1 : GZONE = "LINSTOFCY" : GZNUM = 8560 : Endif
 If !mkstat
  ## Action STD
  Call C_LINSTOFCY(VALEUR) From SUBPOI
  If mkstat : GERR = 1 : GZONE = "LINSTOFCY" : GZNUM = 8560 : Endif
 Endif
Endif
Gosub _AFF
End

$AMM_LINSTOFCY
Call AM_LINSTOFCY(zc)
If !mkstat & GOBJET
 zoncou = "LINSTOFCY" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_LINSTOFCY(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_LINSTOFCY(VALEUR) From SUBPOI
If mkstat : GERR = 1 : GZONE = "LINSTOFCY" : GZNUM = 8560 : Endif
Gosub _AFF
End

Subprog S_LINSTOFCY(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELFCY
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELFCY"
 PARMSK(1) = "LEGCPY=GCPY"
 PARMSK(2) = "D"
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELFCY","SUBFCY","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B1_LINSTOFCY(VALEUR)
Variable Char    VALEUR()
Call OBJET("FCY",VALEUR,"") From GOBJET
Gosub _AFF
End

Subprog SA_LINSTOFCY(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "FCY"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_LINSTOFCY(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("FCY",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_SCOADD
Onevent BEFORE_INPUT Call AS_SCOADD(zc) From W2WE3ALL9
Onevent CONTROL Call C_SCOADD(zc) From W2WE3ALL9
Return

Subprog IB_SCOADD(VALEUR)
Variable Char    VALEUR()
## Action STD
Call IB_SCOADD From SUBPOI
Gosub _AFF
End

Subprog AS_SCOADD(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(1718,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call IB_SCOADD(VALEUR)
## Action PASLIN
If GMODIF<>2 mkstat=2 : Endif
If mkstat=2
 [M]SCOADD(INDIC) = VALEUR
 Affzo SCOADD(INDIC) : mkstat = 2
Endif
If !mkstat
 ## Action STD
 Call AS_SCOADD(VALEUR) From SUBPOI
 If mkstat=2
  [M]SCOADD(INDIC) = VALEUR
  Affzo SCOADD(INDIC) : mkstat = 2
 Endif
 Onkey 129 Titled GBOUT1 Call B1_SCOADD(zc) From W2WE3ALL9
 Onkey   2 Titled GBOUTS Call S_SCOADD(zc) From W2WE3ALL9
Endif
Gosub _AFF
End

Subprog C_SCOADD(VALEUR)
Variable Char    VALEUR()
## Action STD
Call C_SCOADD(VALEUR) From SUBPOI
If mkstat : GERR = 1 : GZONE = "SCOADD" : GZNUM = 24968 : Endif
Gosub _AFF
End

Subprog S_SCOADD(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action SELSCOADD
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SELSCOADD"
 PARMSK(1) = [M:POI1]BPSNUM(nolign-1)
 PARMSK(2) = ""
 PARMSK(3) = ""
 Call S_TAB_CHAR(VALEUR,PARMSK,"SELSCOADD","TRTACHSEL1","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

Subprog B1_SCOADD(VALEUR)
Variable Char    VALEUR()
If !GWEBSERV
 ## Action GOBJETC6A
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "GOBJETC6A"
 Local Char ACTION(20), PROGSUB(GLONADC), PROGSPE(GLONADC), PROGSPV(GLONADC)
 ACTION = "AB1_SCOADD" : PROGSUB = "SUBPOI" : PROGSPE = "SPEPOI" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 Local Char    OBJCLE(30)
 OBJCLE = VALEUR
 Call OBJET_CHAR(OBJCLE,"BPD",[M:POI1]BPSNUM(nolign-1)) From GOBJET
 ACTION = "BB1_SCOADD" : PROGSUB = "SUBPOI" : PROGSPE = "SPEPOI" : PROGSPV = ""
 Gosub ACTSUB From GOBJSUB
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

$ON_EXTRCPDAT
Onevent BEFORE_INPUT Call AS_EXTRCPDAT(zc) From W2WE3ALL9
Onevent CONTROL Call C_EXTRCPDAT(zc) From W2WE3ALL9
Onevent AFTER_CHANGE Gosub AMM_EXTRCPDAT From W2WE3ALL9
Onevent BEFORE_AREA Gosub AV_EXTRCPDAT From W2WE3ALL9
Return

Subprog IB_EXTRCPDAT(VALEUR)
Variable Date    VALEUR
If !GWEBSERV
 ## Action STD
 Call IB_EXTRCPDAT From SUBPOI
Endif
Gosub _AFF
End

$AV_EXTRCPDAT
Chgfmt [M]EXTRCPDAT(indice) With "D:"+GFMDAT
Gosub _AFF
Return

Subprog AS_EXTRCPDAT(VALEUR)
Variable Date    VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(10976,GBOUT1) From OBJDIV
Call IB_EXTRCPDAT(VALEUR)
## Action PASLIN
If GMODIF<>2 mkstat=2 : Endif
If mkstat=2
 [M]EXTRCPDAT(INDIC) = VALEUR
 Affzo EXTRCPDAT(INDIC) : mkstat = 2
Endif
If !mkstat
 ## Action STD
 Call AS_EXTRCPDAT(VALEUR) From SUBPOI
 If mkstat=2
  [M]EXTRCPDAT(INDIC) = VALEUR
  Affzo EXTRCPDAT(INDIC) : mkstat = 2
 Endif
 Onkey 129 Titled GBOUT1 Call B1_EXTRCPDAT(zc) From W2WE3ALL9
Endif
Gosub _AFF
End

Subprog C_EXTRCPDAT(VALEUR)
Variable Date    VALEUR
## Action %OBLIG
If VALEUR=[0/0/0]
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "EXTRCPDAT" : GZNUM = 5067 : Endif
If !mkstat
 ## Action CTLJOU2
 Call CTL_JOU2(VALEUR,[M:POI1]ORDDAT,[F:FCY]UVYDAY,[F:FCY]UVYCOD,1) From CONTX3
 If mkstat : GERR = 1 : GZONE = "EXTRCPDAT" : GZNUM = 5067 : Endif
Endif
Gosub _AFF
End

$AMM_EXTRCPDAT
Call AM_EXTRCPDAT(zc)
If !mkstat & GOBJET
 zoncou = "EXTRCPDAT" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_EXTRCPDAT(VALEUR)
Variable Date    VALEUR
## Action STD
Call AM_EXTRCPDAT(VALEUR) From SUBPOI
If mkstat : GERR = 1 : GZONE = "EXTRCPDAT" : GZNUM = 5067 : Endif
Gosub _AFF
End

Subprog B1_EXTRCPDAT(VALEUR)
Variable Date    VALEUR
If !GWEBSERV
 ## Action CONSSPR
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "CONSSPR"
 PARMSK(1) = "0"
 PARMSK(2) = [M:POI1]PRHFCY(nolign-1)
 PARMSK(3) = [M:POI1]ITMREF(nolign-1)
 PARMSK(4) = ""
 Call CONSULT_DAT(VALEUR,"SPR",PARMSK) From GCONSULT
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

$ON_CUR
Onevent BEFORE_INPUT Call AS_CUR(zc) From W2WE3ALL9
Onevent CONTROL Call C_CUR(zc) From W2WE3ALL9
Onevent AFTER_CHANGE Gosub AMM_CUR From W2WE3ALL9
Return

Subprog AS_CUR(VALEUR)
Variable Char    VALEUR()
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(3837,GBOUT1) From OBJDIV
Call TEXTE(15597,GBOUTS) From OBJDIV
Call TEXTE(12276,GBOUTP) From OBJDIV
Call TEXTE(16134,GBOUTA) From OBJDIV
## Action PASLIN
If GMODIF<>2 mkstat=2 : Endif
If mkstat=2
 [M]CUR(INDIC) = VALEUR
 Affzo CUR(INDIC) : mkstat = 2
Endif
Onkey 129 Titled GBOUT1 Call B1_CUR(zc) From W2WE3ALL9
Onkey   2 Titled GBOUTS Call S_CUR(zc) From W2WE3ALL9
Onkey 144 Titled GBOUTP Call P_CUR(zc) From W2WE3ALL9
Onkey 146 Titled GBOUTA Call SA_CUR(zc) From W2WE3ALL9
Gosub _AFF
End

Subprog C_CUR(VALEUR)
Variable Char    VALEUR()
## Action %OBLIG
If vireblc(VALEUR,2)=""
 mkstat = 1 : GMESSAGE = mess(10,123,1)
Endif
If mkstat : GERR = 1 : GZONE = "CUR" : GZNUM = 323 : Endif
If !mkstat
 ## Action %CNTOBJ
 Call CONTSEL("TCU","",VALEUR,"",mkstat) From CONTOBJ
 If mkstat : GERR = 1 : GZONE = "CUR" : GZNUM = 323 : Endif
 If !mkstat
  ## Action CONTDEV
  Call CONTDEV(VALEUR,[M:POI1]ORDDAT) From TRTDEV
  If mkstat : GERR = 1 : GZONE = "CUR" : GZNUM = 323 : Endif
 Endif
Endif
Gosub _AFF
End

$AMM_CUR
Call AM_CUR(zc)
If !mkstat & GOBJET
 zoncou = "CUR" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_CUR(VALEUR)
Variable Char    VALEUR()
## Action STD
Call AM_CUR(VALEUR) From SUBPOI
If mkstat : GERR = 1 : GZONE = "CUR" : GZNUM = 323 : Endif
Gosub _AFF
End

Subprog S_CUR(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16)
PARMSK(1) = "TCU"
PARMSK(2) = ""
Call S_TAB_CHAR(VALEUR,PARMSK,"SELOBJ","SELOBJ","") From GACTION
Gosub _AFF
End

Subprog B1_CUR(VALEUR)
Variable Char    VALEUR()
Call OBJET("TCU",VALEUR,"") From GOBJET
Gosub _AFF
End

Subprog SA_CUR(VALEUR)
Variable Char    VALEUR()
Local Char PARMSK(250)(1..16) , SAVACT(20)
SAVACT = GACTION : GACTION = "SELOBJAW"
PARMSK(1) = "TCU"
Call SAISIE_CHAR(VALEUR,PARMSK,"DSELOBJAW","SELOBJAW","XWDSELOBJAW") From GSAISIE
GACTION = SAVACT
Gosub _AFF
End

Subprog P_CUR(VALEUR)
Variable Char    VALEUR()
Local Char PAROBJ(250)
PAROBJ = ""
Call VISU("TCU",VALEUR,PAROBJ) From SUBAOP
Gosub _AFF
End

$ON_CHGTYP
Onevent INIT_AREA Call D_CHGTYP(zc) From W2WE3ALL9
Return

Subprog D_CHGTYP(VALEUR)
Variable Integer VALEUR
If varinit([M]CHGTYP,indice)=0
 VALEUR = 1
Endif
Gosub _AFF
End

$ON_CHGCOE
Return

$ON_GROPRI
Onevent BEFORE_AREA Gosub AV_GROPRI From W2WE3ALL9
Onevent BEFORE_INPUT Call AS_GROPRI(zc) From W2WE3ALL9
Onevent AFTER_AREA Call AP_GROPRI(zc) From W2WE3ALL9
Onevent AFTER_CHANGE Gosub AMM_GROPRI From W2WE3ALL9
Return

Subprog IB_GROPRI(VALEUR)
Variable Decimal VALEUR
If !GWEBSERV
 ## Action STD
 Call IB_GROPRI From SUBPOI
Endif
If !GWEBSERV
 ## Action INIREN
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "INIREN"
 PARMSK(1) = "POI1"
 PARMSK(2) = "6"
 PARMSK(3) = num$(nolign-1)
 PARMSK(4) = "GROPRI"
 Call S_AFF_NUM(VALEUR,PARMSK,"INIREN","TRTPRICE","") From GACTION
 GACTION = SAVACT
Endif
Gosub _AFF
End

$AV_GROPRI
If !GWEBSERV
 ## Action PARDEV
Endif
Gosub _AFF
Return

Subprog AS_GROPRI(VALEUR)
Variable Decimal VALEUR
Local Integer INDIC : INDIC = indice
Raz mkstat
Call TEXTE(13454,GBOUT1) From OBJDIV
Call TEXTE(7720,GBOUT2) From OBJDIV
Call TEXTE(16100,GBOUT3) From OBJDIV
Call TEXTE(454,GBOUT4) From OBJDIV
Call TEXTE(15405,GBOUT5) From OBJDIV
Call IB_GROPRI(VALEUR)
## Action PASLINPOI
Call PASLINPOI(0) From SUBPOI
If mkstat=2
 [M]GROPRI(INDIC) = VALEUR
 Affzo GROPRI(INDIC) : mkstat = 2
Endif
If !mkstat
 ## Action DIVREN
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "DIVREN"
 PARMSK(1) = "POI1"
 PARMSK(2) = "6"
 PARMSK(3) = num$(nolign-1)
 PARMSK(4) = "GROPRI"
 Call S_AFF_NUM(VALEUR,PARMSK,"DIVREN","TRTPRICE","") From GACTION
 GACTION = SAVACT
 If mkstat=2
  [M]GROPRI(INDIC) = VALEUR
  Affzo GROPRI(INDIC) : mkstat = 2
 Endif
 Onkey 129 Titled GBOUT1 Call B1_GROPRI(zc) From W2WE3ALL9
 Onkey 130 Titled GBOUT2 Call B2_GROPRI(zc) From W2WE3ALL9
 Onkey 131 Titled GBOUT3 Call B3_GROPRI(zc) From W2WE3ALL9
 Onkey 132 Titled GBOUT4 Call B4_GROPRI(zc) From W2WE3ALL9
 Onkey 133 Titled GBOUT5 Call B5_GROPRI(zc) From W2WE3ALL9
Endif
Gosub _AFF
End

Subprog AP_GROPRI(VALEUR)
Variable Decimal VALEUR
## Action STD
Call AP_GROPRI(VALEUR) From SUBPOI
If mkstat : GERR = 1 : GZONE = "GROPRI" : GZNUM = 2541 : Endif
Gosub _AFF
End

$AMM_GROPRI
Call AM_GROPRI(zc)
If !mkstat & GOBJET
 zoncou = "GROPRI" : Gosub APRES_MODIF From =GPROGRAMME
Endif
Return

Subprog AM_GROPRI(VALEUR)
Variable Decimal VALEUR
## Action PAMDISCRG
Call PAMDISCRG(VALEUR,"POI1",0,nolign-1,[M:POI1]CUR (nolign-1)) From TRTACHPRI1
If mkstat : GERR = 1 : GZONE = "GROPRI" : GZNUM = 2541 : Endif
Gosub _AFF
End

Subprog B1_GROPRI(VALEUR)
Variable Decimal VALEUR
If !GWEBSERV
 ## Action VISUPPV
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "VISUPPV"
 PARMSK(1) = [M:POI1]ORDDAT
 PARMSK(2) = [M:POI1]ITMREF(nolign-1)
 PARMSK(3) = [M:POI1]BPSNUM(nolign-1)
 Call SAISIE_NUM(VALEUR,PARMSK,"IPPV","FUNACHPPV","XWIPPV") From GSAISIE
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B2_GROPRI(VALEUR)
Variable Decimal VALEUR
If !GWEBSERV
 ## Action SAIPURREN
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SAIPURREN"
 PARMSK(1) = "POI1"
 PARMSK(2) = num$(nolign-1)
 Call SAISIE_NUM(VALEUR,PARMSK,"IPURREN","TRTPRICE","XWIPURREN") From GSAISIE
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B3_GROPRI(VALEUR)
Variable Decimal VALEUR
If !GWEBSERV
 ## Action SAIREMFRS
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "SAIREMFRS"
 PARMSK(1) = "POI1"
 PARMSK(2) = num$(nolign-1)
 Call SAISIE_NUM(VALEUR,PARMSK,"IPURPRICE","TRTACHPRI1","XWIPURPRICE") From GSAISIE
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B4_GROPRI(VALEUR)
Variable Decimal VALEUR
If !GWEBSERV
 ## Action STD
 Call B4_GROPRI(VALEUR) From SUBPOI
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

Subprog B5_GROPRI(VALEUR)
Variable Decimal VALEUR
If !GWEBSERV
 ## Action VISUCLCPRI
 Local Char    PARMSK(250)(1..20) , SAVACT(20)
 SAVACT = GACTION : GACTION = "VISUCLCPRI"
 PARMSK(1) = "POI"
 PARMSK(2) = [M:POI1]CUR (nolign-1)
 PARMSK(3) = num$(nolign-1)
 PARMSK(4) = "2"
 Call SAISIE_NUM(VALEUR,PARMSK,"IDETPRI","TRTPRICE","XWIDETPRI") From GSAISIE
 GACTION = SAVACT
Endif
If mkstat=99 : mkstat = 0 : Elsif mkstat=0 : mkstat = 2 : Endif
Gosub _AFF
End

$ON_NETPRI
Onevent BEFORE_AREA Gosub AV_NETPRI From W2WE3ALL9
Return

$AV_NETPRI
If !GWEBSERV
 ## Action PARDEV
Endif
Gosub _AFF
Return

$TIT_COL
Gosub TIT_COL From W4WE3ALL9
Return


