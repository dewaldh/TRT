#<AdxTL>@(#)0.0.0.0 $Revision$
$ACTION
  Case ACTION
    When 'EXEC' : Gosub EXEC
  Endcase
Return

$EXEC

Gosub LIENS
Return

#------------------------------------------------------------------------------------#
#Load content server rules based on the object.
#------------------------------------------------------------------------------------#
$LIENS
Local Char YWEBURL(250)
Local Char YCSBASE(250),YCSNODE(250),YCSNODEAPI(250),YCSUSR(50),YCSPWD(50),YOCTS(250),YCSAUTH(250),YRESULT,YTYPE
#
#If clalev([F:YCSFL]) = 0 : Local File YCSVRFR[YCSFL] : Endif
#If clalev([F:YCSL]) = 0 : Local File YCSLNK[YCSL] : Endif
#
##if no parent defined, disable create button.
#Read [F:YCSFL]YCSFL0 = GABREV
#If fstat = 0
#  If [F:YCSFL]YPOBJ = ""
#    Diszo [M]YCREFLD
#    Affzo [M]
#  Endif
#Endif
#
#
#Infbox GABREV
#
##get all the url paramaters for the CS connection
##Content server base URL
#  If func AFNC.PARAM("YCSBASE", "") <> ""
#    YCSBASE = func AFNC.PARAM("YCSBASE", "")
#  Else
#    GMESSAGE = "Content server base url not defined in the paramaters: YCSBASE"
#    GERR = 1
#    Return
#  Endif
#
#  If func AFNC.PARAM("YCSNODE", "") <> ""
#    YCSNODE = func AFNC.PARAM("YCSNODE", "")
#  Else
#    GMESSAGE = "Content server node url not defined in the paramaters: YCSNODE"
#    GERR = 1
#    Return
#  Endif
#
#  If func AFNC.PARAM("YCSWEBURL", "") <> ""
#    YWEBURL = func AFNC.PARAM("YCSWEBURL", "")
#  Else
#    GMESSAGE = "Content server component url not defined in the paramaters: YCSWEBURL"
#    GERR = 1
#    Return
#  Endif
#
# If func AFNC.PARAM("YCSNODEAPI", "") <> ""
#    YCSNODEAPI = func AFNC.PARAM("YCSNODEAPI", "")
#  Else
#    GMESSAGE = "Content server api node url not defined in the paramaters: YCSNODE"
#    GERR = 1
#    Return
#  Endif
#
#  If func AFNC.PARAM("YCSAUTHAPI", "") <> ""
#    YCSAUTH = func AFNC.PARAM("YCSAUTHAPI", "")
#  Else
#    GMESSAGE = "Content server api node url not defined in the paramaters: YCSNODE"
#    GERR = 1
#    Return
#  Endif
#
#If func AFNC.PARAM("YCSUSR", "") <> ""
#    YCSUSR = func AFNC.PARAM("YCSUSR", "")
#  Else
#    GMESSAGE = "Content server api username not defined in the paramaters: YCSUSR"
#    GERR = 1
#    Return
#  Endif
#
# If func AFNC.PARAM("YCSPWD", "") <> ""
#    YCSPWD = func AFNC.PARAM("YCSPWD", "")
#  Else
#    GMESSAGE = "Content server api password not defined in the paramaters: YCSPWD"
#    GERR = 1
#    Return
#  Endif
#
#Read [F:YCSFL]YCSFL0 = GABREV
##read succesfull
#If fstat = 0
#  Read [F:YCSL]YCSL0 = GABREV;num$(evalue([F:YCSFL]YOBJIDFLD))
#  If fstat = 0
#
#
#    YOCTS = func YCSHELPER.CSAUTH(YCSUSR,YCSPWD,YCSBASE+YCSAUTH)
#
#    #check if the node exists in cs
#    #validate that the parent id is a folder and not a file
#    YRESULT = func YCSHELPER.CSNODEINFO(YOCTS,YCSBASE+YCSNODEAPI+num$([F:YCSL]YCSNID)+"?fields=data")
#
##    YTYPE = seg$(YRESULT,1,instr(1,YRESULT,'~')-1)
#    If YRESULT = ""
#      GMESSAGE = "Unable to find the node in content server. Node ID: " + num$([F:YCSL]YCSNID) + " The link will be removed from the links table."
#      GERR = 1
#
#      Call YCSLOG(GABREV,num$(evalue([F:YCSFL]YOBJIDFLD)),[F:YCSL]YCSNID,GMESSAGE,"Read node") From YCSHELPER
#
#      #delete the content server to x3 object link.
#      #Delete [F:YCSL]
#
#      #assign default base url
#      If func AFNC.PARAM("YCSDEF", "") <> ""
#        YWEBURL = left$(YWEBURL,instr(1,YWEBURL,"~")-1) + func AFNC.PARAM("YCSDEF", "") + right$(YWEBURL,instr(1,YWEBURL,"~")+1)
##        [M]YURL = YWEBURL
#        #[M]YOBJID = YWEBURL
##        [M:YCS0]YOBJID = YWEBURL
#      Endif
#      Return
#    Endif
#
#    YWEBURL = left$(YWEBURL,instr(1,YWEBURL,"~")-1) + YCSBASE + YCSNODE + num$([F:YCSL]YCSNID) + right$(YWEBURL,instr(1,YWEBURL,"~")+1)
#
#    #set the URL to open CS at the saved node id.
##    [M:YCS0]YOBJID = YWEBURL
##     [M]YURL = YWEBURL
##     [M]YOBJID = YWEBURL
##    #disable buttons
##    Diszo [M]YCREFLD
##    Diszo [M]YLINK
##    Affzo [M]
#  Else
#    #Content server base URL
#      YWEBURL = left$(YWEBURL,instr(1,YWEBURL,"~")-1) + func AFNC.PARAM("YCSBASE", "") + right$(YWEBURL,instr(1,YWEBURL,"~")+1)
##      [M]YURL = YWEBURL
##      [M]YOBJID = YWEBURL
##      [M:YCS0]YOBJID = YWEBURL
#  Endif
#Else
#  #no object was found. display message and disable buttons.
#  GMESSAGE = "No Content server filing rules found for object type " + GABREV
#  GERR = 1
#
##Call YCSLOG(GABREV,"",0,"No Content server filing rules found for object type","Read node") From YCSHELPER
#
#  #Content server default URL
#  If func AFNC.PARAM("YCSDEF", "") <> ""
#    YWEBURL = left$(YWEBURL,instr(1,YWEBURL,"~")-1) + func AFNC.PARAM("YCSDEF", "") + right$(YWEBURL,instr(1,YWEBURL,"~")+1)
##    [M]YURL = YWEBURL
##    [M]YOBJID = YWEBURL
##    [M:YCS0]YOBJID = YWEBURL
#  Endif
#
#Endif
#
#
#Infbox YWEBURL
Infbox PARAM(1),PARAM(2)
#Callui RETVALUE="" With     "UIAction=" + chr$(1) + "OpenFile",
#&                           "UILocalDir=" + chr$(1) + "HTTP",
#&                           "UILocalFile=" + chr$(1) + "dennisdocs/otcs/cs.exe/app/nodes/2299281"


Return

