#<AdxTL>@(#)0.0.0.0 $Revision$
######################################################################################################
# FILE NAME   : SPEJOU
# DESCRIPTION : Journal setup customisations
######################################################################################################
# DATE        : 11-09-2018
# AUTHOR      : Dewald Henning
# COMPANY     : Leverage Technologies
#-----------------------------------------------------------------------------------------------------
# Epics Code  : DFCX1-22
#-----------------------------------------------------------------------------------------------------
######################################################################################################

$ACTION
Case ACTION
  When "OUVRE"   :  Gosub OUVRE
  When "LIENS"   :  Gosub LIENS
  When "STYLE"   :  Gosub STYLE
Endcase
Return

#If no data exists, LIENS and STYLE will not be invoked
$OUVRE
  If [M:JOU0]YBUSBAT = 1 Then
    Chgfmt[M:JOU0]YBUSBATTYP With "-LM:6250"
  Elsif [M:JOU0]YBUSBAT = 2
    Chgfmt[M:JOU0]YBUSBATTYP With "+LM:6250"
  Endif
  Affzo [M:JOU0]YBUSBATTYP

Return

#If screen is entered from a "Jump to" action, Style will not be invoked
$LIENS
  If [M:JOU0]YBUSBAT = 1 Then
    Chgfmt[M:JOU0]YBUSBATTYP With "-LM:6250"
  Elsif [M:JOU0]YBUSBAT = 2
    Chgfmt[M:JOU0]YBUSBATTYP With "+LM:6250"
  Endif
  Affzo [M:JOU0]YBUSBATTYP

Return

$STYLE
  If [M:JOU0]YBUSBAT = 1 Then
    Chgfmt[M:JOU0]YBUSBATTYP With "-LM:6250"
  Elsif [M:JOU0]YBUSBAT = 2
    Chgfmt[M:JOU0]YBUSBATTYP With "+LM:6250"
  Endif
  Affzo [M:JOU0]YBUSBATTYP

Return

Subprog C_YBUSBAT(VALEUR)
Variable Integer VALEUR
Infbox num$(VALEUR)
  Local Integer I
  Local Char REQUEST(250)
  If VALEUR = 1
    Chgfmt[M:JOU0]YBUSBATTYP With "-LM:6250"
    #DEFECT DFCX1-269
    #Check if linked to Entry type
    REQUEST = "Select count(DEFJOU_0) from GTYPACCENT Where DEFJOU_0 = '"+[M:JOU0]JOU+"' and YBUSBATTYP_0 ="+num$([M:JOU0]YBUSBATTYP)
    For (Integer CENT) From "5" Sql REQUEST As [YLNK]
      If CENT >= 1
        I = 0
       Else
        I = 1
      Endif
    Next
    If I = 0
      GMESSAGE = "Journal is linked to a business batch entry type"#mess(12,6254,1)
      GERR = 1
      mkstat = 2
      VALEUR = 2
    Endif
  Endif

  If VALEUR = 2
    Chgfmt[M:JOU0]YBUSBATTYP With "+LM:6250"
  Endif
  Affzo [M:JOU0]YBUSBATTYP

End

Subprog AM_YBUSBATTYP(VALEUR)
Variable Integer VALEUR
  #Check if Journal is linked to Entry type of the same Business Batch
  If [M:JOU0]YBUSBAT = 2 Then
    Call VAL_BBJOU([M:JOU0]JOU, VALEUR) From YBBSELJOU
  Endif

End

